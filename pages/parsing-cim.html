<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parsing & CIM Mapping | myfirstpro Detection Engineering</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <div class="app-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <a href="../index.html" style="display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit;">
            <div class="sidebar-logo-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            </div>
            <div class="sidebar-logo-text">
              <h1>myfirstpro</h1>
              <span>Detection Engineering</span>
            </div>
          </a>
        </div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Getting Started</div>
          <a href="../index.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg><span>Command Center</span></a>
          <a href="day1.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/></svg><span>Day 1 Checklist</span></a>
          <a href="client-comm.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg><span>Client Communication</span></a>
          <a href="professional-excellence.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg><span>Professional Excellence</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Splunk Fundamentals</div>
          <a href="splunk-fundamentals.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg><span>Splunk 101</span></a>
          <a href="splunk-es.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><span>Enterprise Security</span></a>
          <a href="data-flow.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg><span>Data Flow & Event Hub</span></a>
          <a href="detection-lifecycle.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/></svg><span>Detection Lifecycle</span></a>
          <a href="splunk-howto.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg><span>Splunk How-To Guide</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Data Sources</div>
          <a href="vendor-akamai.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><span>Akamai WAF</span></a>
          <a href="vendor-cyberark.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg><span>CyberArk Identity</span></a>
          <a href="vendor-entra.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg><span>Entra ID</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Splunk Operations</div>
          <a href="waf-onboarding.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg><span>Log Onboarding</span></a>
          <a href="parsing-cim.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg><span>Parsing & CIM</span></a>
          <a href="lookups.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg><span>Lookups Deep Dive</span></a>
          <a href="splunk-ops.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg><span>Splunk Cloud Ops</span></a>
          <a href="spl-reference.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg><span>SPL Reference</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">WAF/DDoS Project</div>
          <a href="waf-overview.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span>Project Overview</span></a>
          <a href="waf-usecases.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>Use Cases (UC1-8)</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">MFA Project</div>
          <a href="mfa-overview.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span>Project Overview</span></a>
          <a href="mfa-usecases.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>Use Cases (UC1-5)</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Response & Support</div>
          <a href="decision-trees.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="5" r="3"/><line x1="12" y1="8" x2="12" y2="14"/><circle cx="6" cy="19" r="3"/><circle cx="18" cy="19" r="3"/></svg><span>Decision Trees</span></a>
          <a href="troubleshooting.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><span>Troubleshooting</span></a>
          <a href="runbooks.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>SOC Runbooks</span></a>
        </div>
      </nav>
      <div class="sidebar-footer"><p>Detection Engineering v2.0</p></div>
    </aside>

    <main class="main-content">
      <header class="header">
        <div class="header-left">
          <button class="menu-toggle" aria-label="Toggle menu"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
          <div class="breadcrumb">
            <a href="../index.html" class="breadcrumb-item">Home</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-item current">Parsing & CIM</span>
          </div>
        </div>
        <span class="badge info">Field Mapping</span>
      </header>

      <div class="page-content">
        <div class="section">
          <h1 class="section-title">Parsing & CIM Mapping</h1>
          <p class="section-subtitle">Field extraction, normalization, and CIM compliance for each data source</p>
        </div>

        <!-- What is CIM -->
        <div class="section">
          <div class="callout info" style="margin-bottom:24px;">
            <div class="callout-content">
              <div class="callout-title">What is CIM?</div>
              <div class="callout-body">
                <strong>Common Information Model (CIM)</strong> is Splunk's standardized field naming convention. When data is CIM-compliant, you can write one detection that works across multiple data sources. Example: <code>src_ip</code> means source IP in any CIM-compliant data, regardless of vendor.
              </div>
            </div>
          </div>

          <!-- HOW CIM MAPPING WORKS -->
          <h3 style="font-size:1.125rem;margin:24px 0 16px;">üîß How CIM Mapping Works (3 Methods)</h3>
          
          <div class="card" style="padding:20px;margin-bottom:24px;background:var(--gray-50);">
            <p style="font-size:0.875rem;color:var(--gray-600);margin-bottom:16px;">
              CIM mapping transforms vendor-specific field names to Splunk's standard names. There are 3 ways to do this:
            </p>
            
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px;">
              <!-- Method 1 -->
              <div style="background:white;padding:16px;border-radius:8px;border-left:3px solid var(--success-500);">
                <h5 style="color:var(--success-700);margin-bottom:8px;">‚úÖ Method 1: Technology Add-on (TA)</h5>
                <p style="font-size:0.8125rem;color:var(--gray-600);margin-bottom:8px;"><strong>Best for:</strong> Most cases ‚Äî TAs do the mapping automatically</p>
                <p style="font-size:0.8125rem;color:var(--gray-600);"><strong>How:</strong> Install the vendor's TA from Splunkbase ‚Üí mapping happens automatically</p>
              </div>
              
              <!-- Method 2 -->
              <div style="background:white;padding:16px;border-radius:8px;border-left:3px solid var(--primary-500);">
                <h5 style="color:var(--primary-700);margin-bottom:8px;">üî® Method 2: Manual Config Files</h5>
                <p style="font-size:0.8125rem;color:var(--gray-600);margin-bottom:8px;"><strong>Best for:</strong> Custom data sources, or when TA is incomplete</p>
                <p style="font-size:0.8125rem;color:var(--gray-600);"><strong>How:</strong> Edit props.conf and transforms.conf files</p>
              </div>
              
              <!-- Method 3 -->
              <div style="background:white;padding:16px;border-radius:8px;border-left:3px solid var(--warning-500);">
                <h5 style="color:var(--warning-700);margin-bottom:8px;">‚ö° Method 3: Search-Time Extraction</h5>
                <p style="font-size:0.8125rem;color:var(--gray-600);margin-bottom:8px;"><strong>Best for:</strong> Quick fixes, testing, or when you can't modify config files</p>
                <p style="font-size:0.8125rem;color:var(--gray-600);"><strong>How:</strong> Use eval/rename in your SPL queries</p>
              </div>
            </div>
          </div>

          <!-- WHERE ARE CONFIG FILES -->
          <h3 style="font-size:1.125rem;margin:24px 0 16px;">üìÅ Where Are Config Files Located?</h3>
          
          <div class="table-container" style="margin-bottom:24px;">
            <table>
              <thead><tr><th>File</th><th>Location (Splunk Cloud)</th><th>Purpose</th></tr></thead>
              <tbody>
                <tr>
                  <td class="highlight">props.conf</td>
                  <td><code>$SPLUNK_HOME/etc/apps/[app_name]/local/props.conf</code></td>
                  <td>Field extractions, field aliases, calculated fields</td>
                </tr>
                <tr>
                  <td class="highlight">transforms.conf</td>
                  <td><code>$SPLUNK_HOME/etc/apps/[app_name]/local/transforms.conf</code></td>
                  <td>Lookup definitions, field transformations</td>
                </tr>
                <tr>
                  <td class="highlight">CIM Add-on</td>
                  <td><code>Splunk_SA_CIM</code> (installed on Search Heads)</td>
                  <td>Defines data models, enables tstats acceleration</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="callout warning" style="margin-bottom:24px;">
            <div class="callout-content">
              <div class="callout-title">‚ö†Ô∏è Splunk Cloud Note</div>
              <div class="callout-body">
                In <strong>Splunk Cloud</strong>, you cannot directly edit files on the server. Instead, you:<br>
                1. Create/edit config files locally in an app package<br>
                2. Use <strong>Settings ‚Üí Source types</strong> for field extractions<br>
                3. Use <strong>Settings ‚Üí Fields ‚Üí Calculated fields</strong> for aliases<br>
                4. Submit a support case to deploy custom apps<br>
                <br>
                <strong>OR</strong> use the UI-based methods shown in each tab below.
              </div>
            </div>
          </div>
        </div>

        <!-- TABS -->
        <div class="tabs-container">
          <div class="tabs-nav">
            <button class="tab-btn akamai active" data-tab="akamai-cim">üõ°Ô∏è Akamai WAF</button>
            <button class="tab-btn cyberark" data-tab="cyberark-cim">üîê CyberArk Identity</button>
            <button class="tab-btn entra" data-tab="entra-cim">‚òÅÔ∏è Entra ID</button>
          </div>

          <!-- ==================== AKAMAI CIM TAB ==================== -->
          <div id="akamai-cim" class="tab-content akamai-content active">
            <div class="tab-header">
              <h3>Akamai WAF Field Mapping & CIM</h3>
              <span class="badge akamai">Web Data Model</span>
            </div>

            <!-- Akamai Parsing Flow -->
            <h4 style="font-size:1rem;margin-bottom:12px;">Akamai Parsing Flow</h4>
            <div class="card" style="padding:24px;background:var(--gray-50);overflow-x:auto;margin-bottom:24px;">
              <div class="mermaid">
flowchart LR
    A[Raw JSON<br/>from Akamai] --> B[Splunk Add-on<br/>for Akamai]
    B --> C[props.conf<br/>Field Extraction]
    C --> D[transforms.conf<br/>Field Aliasing]
    D --> E[CIM-Compliant<br/>Fields]
    E --> F[Web Data Model<br/>Ready]
    
    style A fill:#ff9900,stroke:#ff6600
    style F fill:#d4edda,stroke:#28a745
              </div>
            </div>

            <!-- HOW TO CONFIGURE AKAMAI CIM -->
            <h4 style="font-size:1rem;margin:24px 0 12px;">üîß How to Configure Akamai CIM Mapping</h4>
            
            <!-- Method 1: TA -->
            <div class="card bordered-left success" style="padding:20px;margin-bottom:16px;">
              <h5 style="color:var(--success-700);margin-bottom:12px;">‚úÖ Method 1: Install Splunk Add-on for Akamai (Recommended)</h5>
              <p style="font-size:0.875rem;color:var(--gray-600);margin-bottom:12px;">The TA handles all CIM mapping automatically.</p>
              
              <div style="background:var(--gray-50);padding:16px;border-radius:8px;margin-bottom:12px;">
                <strong style="font-size:0.875rem;">Step-by-Step:</strong>
                <ol style="margin:8px 0 0 16px;font-size:0.875rem;color:var(--gray-600);">
                  <li><strong>Find the TA:</strong> Go to <a href="https://splunkbase.splunk.com" target="_blank">splunkbase.splunk.com</a> ‚Üí Search "Akamai"</li>
                  <li><strong>Download:</strong> Splunk Add-on for Akamai (TA-akamai)</li>
                  <li><strong>Install:</strong> In Splunk: <code>Apps ‚Üí Manage Apps ‚Üí Install app from file</code></li>
                  <li><strong>Restart:</strong> Restart Splunk (or wait for Cloud to apply)</li>
                  <li><strong>Verify:</strong> Run the validation query below</li>
                </ol>
              </div>
              
              <div style="font-size:0.8125rem;color:var(--gray-500);">
                <strong>What the TA does:</strong> Creates field extractions in <code>props.conf</code>, sets up field aliases in <code>transforms.conf</code>, and tags events for the Web data model.
              </div>
            </div>

            <!-- Method 2: Manual Config -->
            <div class="card bordered-left info" style="padding:20px;margin-bottom:16px;">
              <h5 style="color:var(--primary-700);margin-bottom:12px;">üî® Method 2: Manual Configuration (If TA Incomplete)</h5>
              <p style="font-size:0.875rem;color:var(--gray-600);margin-bottom:12px;">Add field aliases manually via Splunk UI or config files.</p>
              
              <!-- UI Method -->
              <div style="background:var(--gray-50);padding:16px;border-radius:8px;margin-bottom:12px;">
                <strong style="font-size:0.875rem;">Option A: Via Splunk UI (Calculated Fields)</strong>
                <ol style="margin:8px 0 0 16px;font-size:0.875rem;color:var(--gray-600);">
                  <li>Go to <strong>Settings ‚Üí Fields ‚Üí Calculated fields</strong></li>
                  <li>Click <strong>"New Calculated Field"</strong></li>
                  <li>Fill in:
                    <ul style="margin:4px 0 4px 16px;">
                      <li><strong>Source type:</strong> <code>akamai:siem</code></li>
                      <li><strong>Name:</strong> <code>src_ip</code></li>
                      <li><strong>Eval expression:</strong> <code>'attackData.clientIP'</code></li>
                    </ul>
                  </li>
                  <li>Click <strong>Save</strong></li>
                  <li>Repeat for each field mapping in the table below</li>
                </ol>
              </div>
              
              <!-- Config File Method -->
              <div style="background:var(--gray-50);padding:16px;border-radius:8px;">
                <strong style="font-size:0.875rem;">Option B: Via props.conf (Field Aliases)</strong>
                <p style="margin:8px 0;font-size:0.8125rem;color:var(--gray-600);">Add to <code>$SPLUNK_HOME/etc/apps/TA-akamai/local/props.conf</code>:</p>
                <div class="code-block" style="margin:8px 0;">
                  <div class="code-body" style="padding:12px;">
                    <pre style="margin:0;font-size:0.75rem;"><code>[akamai:siem]
# Field Aliases for CIM Web Data Model
FIELDALIAS-src_ip = attackData.clientIP AS src_ip
FIELDALIAS-dest = httpMessage.host AS dest
FIELDALIAS-uri_path = httpMessage.requestUrl AS uri_path
FIELDALIAS-http_method = httpMessage.method AS http_method
FIELDALIAS-status = httpMessage.status AS status
FIELDALIAS-signature = attackData.rules AS signature
FIELDALIAS-http_user_agent = httpMessage.useragent AS http_user_agent
FIELDALIAS-src_country = geo.country AS src_country

# Calculated field for CIM action
EVAL-action = case(attackData.action="deny", "blocked", attackData.action="alert", "allowed", 1=1, "allowed")

# Tag for Web data model
LOOKUP-action_lookup = akamai_action_lookup akamai_action AS attackData.action OUTPUT action</code></pre>
                  </div>
                </div>
              </div>
            </div>

            <!-- Method 3: Search-time -->
            <div class="card bordered-left warning" style="padding:20px;margin-bottom:24px;">
              <h5 style="color:var(--warning-700);margin-bottom:12px;">‚ö° Method 3: Search-Time Extraction (Quick Fix)</h5>
              <p style="font-size:0.875rem;color:var(--gray-600);margin-bottom:12px;">Use eval/rename in your SPL when you can't modify config files.</p>
              
              <div class="code-block" style="margin:0;">
                <div class="code-body" style="padding:12px;">
                  <pre style="margin:0;font-size:0.75rem;"><code>index=akamai sourcetype=akamai:siem earliest=-24h
| rename "attackData.clientIP" AS src_ip
| rename "httpMessage.host" AS dest
| rename "httpMessage.requestUrl" AS uri_path
| rename "httpMessage.method" AS http_method
| rename "httpMessage.status" AS status
| rename "attackData.rules" AS signature
| eval action = case('attackData.action'="deny", "blocked", 'attackData.action'="alert", "allowed", 1=1, "allowed")
| table _time src_ip dest uri_path http_method status signature action</code></pre>
                </div>
              </div>
              <p style="font-size:0.75rem;color:var(--gray-500);margin-top:8px;">‚ö†Ô∏è This only works for this specific search. For permanent mapping, use Method 1 or 2.</p>
            </div>

            <!-- Akamai Field Mapping -->
            <h4 style="font-size:1rem;margin-bottom:12px;">Akamai ‚Üí CIM Field Mapping</h4>
            <div class="table-container" style="margin-bottom:24px;">
              <table>
                <thead><tr><th>Akamai Raw Field</th><th>CIM Field</th><th>Data Model</th><th>Description</th></tr></thead>
                <tbody>
                  <tr><td class="highlight">attackData.clientIP</td><td><code>src_ip</code></td><td>Web</td><td>Source/attacker IP address</td></tr>
                  <tr><td class="highlight">httpMessage.host</td><td><code>dest</code></td><td>Web</td><td>Destination hostname</td></tr>
                  <tr><td class="highlight">httpMessage.requestUrl</td><td><code>uri_path</code></td><td>Web</td><td>Requested URI path</td></tr>
                  <tr><td class="highlight">httpMessage.method</td><td><code>http_method</code></td><td>Web</td><td>HTTP method (GET, POST, etc.)</td></tr>
                  <tr><td class="highlight">httpMessage.status</td><td><code>status</code></td><td>Web</td><td>HTTP response status code</td></tr>
                  <tr><td class="highlight">attackData.rules</td><td><code>signature</code></td><td>Web</td><td>WAF rule(s) triggered</td></tr>
                  <tr><td class="highlight">httpMessage.bytes</td><td><code>bytes_out</code></td><td>Web</td><td>Response size in bytes</td></tr>
                  <tr><td class="highlight">geo.country</td><td><code>src_country</code></td><td>Web</td><td>Source country code</td></tr>
                  <tr><td class="highlight">httpMessage.useragent</td><td><code>http_user_agent</code></td><td>Web</td><td>Client user agent string</td></tr>
                  <tr><td class="highlight">attackData.configId</td><td><code>vendor_product</code></td><td>Web</td><td>Akamai security config ID</td></tr>
                </tbody>
              </table>
            </div>

            <!-- Akamai Action Mapping -->
            <h4 style="font-size:1rem;margin-bottom:12px;">Akamai Action ‚Üí CIM Action Mapping</h4>
            <div class="table-container" style="margin-bottom:24px;">
              <table>
                <thead><tr><th>Akamai Action</th><th>CIM action</th><th>Detection Relevance</th></tr></thead>
                <tbody>
                  <tr><td class="highlight">alert</td><td><code>allowed</code></td><td>‚ö†Ô∏è Medium - Attack detected but not blocked (monitor mode)</td></tr>
                  <tr><td class="highlight">deny</td><td><code>blocked</code></td><td>üî¥ High - Attack actively blocked</td></tr>
                  <tr><td class="highlight">allow</td><td><code>allowed</code></td><td>üü¢ Low - Normal allowed traffic (usually filtered out)</td></tr>
                  <tr><td class="highlight">tarpit</td><td><code>blocked</code></td><td>üî¥ High - Rate limiting applied</td></tr>
                </tbody>
              </table>
            </div>

            <!-- Akamai Validation Query -->
            <h4 style="font-size:1rem;margin-bottom:12px;">Akamai CIM Validation Query</h4>
            <div class="code-block" style="margin-bottom:24px;">
              <div class="code-header"><span class="code-title">Verify CIM Compliance</span></div>
              <div class="code-body">
                <pre><code>``` Check if Akamai data maps to Web data model
| datamodel Web Web search
| where sourcetype="akamai:siem"
| head 10
| table _time src_ip dest http_method uri_path status action

``` If above fails, check raw field extraction
index=akamai earliest=-1h | head 5
| table _raw
``` Look for JSON structure

``` Manual CIM field check
index=akamai earliest=-1h | head 100
| stats count by src_ip, dest, http_method, action
| where isnotnull(src_ip) AND isnotnull(action)
``` All should have values</code></pre>
              </div>
            </div>

            <!-- Akamai Troubleshooting -->
            <h4 style="font-size:1rem;margin-bottom:12px;">Akamai Parsing Issues & Fixes</h4>
            <div class="table-container">
              <table>
                <thead><tr><th>Issue</th><th>Symptom</th><th>Fix</th></tr></thead>
                <tbody>
                  <tr><td class="highlight">Fields not extracted</td><td>All fields show as null</td><td>Verify TA installed, check sourcetype is <code>akamai:siem</code></td></tr>
                  <tr><td class="highlight">Wrong sourcetype</td><td>Data shows as generic JSON</td><td>Set sourcetype explicitly in HEC token or inputs.conf</td></tr>
                  <tr><td class="highlight">Not in Web datamodel</td><td>tstats returns no results</td><td>Check datamodel acceleration, verify CIM Add-on installed</td></tr>
                  <tr><td class="highlight">action field wrong</td><td>Shows raw value not CIM</td><td>Check transforms.conf for action field alias</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- ==================== CYBERARK CIM TAB ==================== -->
          <div id="cyberark-cim" class="tab-content cyberark-content">
            <div class="tab-header">
              <h3>CyberArk Identity Field Mapping & CIM</h3>
              <span class="badge cyberark">Authentication Data Model</span>
            </div>

            <!-- CyberArk Parsing Flow -->
            <h4 style="font-size:1rem;margin-bottom:12px;">CyberArk Parsing Flow</h4>
            <div class="card" style="padding:24px;background:var(--gray-50);overflow-x:auto;margin-bottom:24px;">
              <div class="mermaid">
flowchart LR
    A[Raw JSON<br/>from CyberArk] --> B[Splunk HEC<br/>Input]
    B --> C[JSON Parsing<br/>KV_MODE=json]
    C --> D[Field Aliasing<br/>props.conf]
    D --> E[CIM-Compliant<br/>Fields]
    E --> F[Authentication<br/>Data Model]
    
    style A fill:#00a3e0,stroke:#0077b3
    style F fill:#d4edda,stroke:#28a745
              </div>
            </div>

            <!-- HOW TO CONFIGURE CYBERARK CIM -->
            <h4 style="font-size:1rem;margin:24px 0 12px;">üîß How to Configure CyberArk CIM Mapping</h4>
            
            <!-- Method 1: TA -->
            <div class="card bordered-left success" style="padding:20px;margin-bottom:16px;">
              <h5 style="color:var(--success-700);margin-bottom:12px;">‚úÖ Method 1: Install CyberArk Add-on (Recommended)</h5>
              <p style="font-size:0.875rem;color:var(--gray-600);margin-bottom:12px;">The TA handles JSON parsing and CIM mapping automatically.</p>
              
              <div style="background:var(--gray-50);padding:16px;border-radius:8px;margin-bottom:12px;">
                <strong style="font-size:0.875rem;">Step-by-Step:</strong>
                <ol style="margin:8px 0 0 16px;font-size:0.875rem;color:var(--gray-600);">
                  <li><strong>Find the TA:</strong> Go to <a href="https://splunkbase.splunk.com" target="_blank">splunkbase.splunk.com</a> ‚Üí Search "CyberArk Identity"</li>
                  <li><strong>Download:</strong> Splunk Add-on for CyberArk Identity (if available) OR CyberArk EPM Add-on</li>
                  <li><strong>Install:</strong> In Splunk: <code>Apps ‚Üí Manage Apps ‚Üí Install app from file</code></li>
                  <li><strong>Configure sourcetype:</strong> Set HEC token to use <code>cyberark:identity:audit</code></li>
                  <li><strong>Verify:</strong> Run the validation query below</li>
                </ol>
              </div>
              
              <div class="callout warning" style="margin-top:12px;padding:12px;">
                <div class="callout-content">
                  <div class="callout-body" style="font-size:0.8125rem;">
                    <strong>Note:</strong> CyberArk Identity may not have a dedicated TA on Splunkbase. If not available, use Method 2 (Manual Config) below.
                  </div>
                </div>
              </div>
            </div>

            <!-- Method 2: Manual Config -->
            <div class="card bordered-left info" style="padding:20px;margin-bottom:16px;">
              <h5 style="color:var(--primary-700);margin-bottom:12px;">üî® Method 2: Manual Configuration</h5>
              <p style="font-size:0.875rem;color:var(--gray-600);margin-bottom:12px;">Configure JSON parsing and field aliases manually.</p>
              
              <!-- Step 1: Enable JSON Parsing -->
              <div style="background:var(--gray-50);padding:16px;border-radius:8px;margin-bottom:12px;">
                <strong style="font-size:0.875rem;">Step 1: Enable JSON Parsing for Sourcetype</strong>
                <ol style="margin:8px 0 0 16px;font-size:0.875rem;color:var(--gray-600);">
                  <li>Go to <strong>Settings ‚Üí Source types</strong></li>
                  <li>Click <strong>"New Source Type"</strong></li>
                  <li>Fill in:
                    <ul style="margin:4px 0 4px 16px;">
                      <li><strong>Name:</strong> <code>cyberark:identity:audit</code></li>
                      <li><strong>Category:</strong> Application</li>
                      <li><strong>Event Breaks:</strong> Auto</li>
                    </ul>
                  </li>
                  <li>Click <strong>Advanced</strong> tab</li>
                  <li>Set <strong>KV_MODE:</strong> <code>json</code></li>
                  <li>Click <strong>Save</strong></li>
                </ol>
              </div>
              
              <!-- Step 2: Create Field Aliases -->
              <div style="background:var(--gray-50);padding:16px;border-radius:8px;margin-bottom:12px;">
                <strong style="font-size:0.875rem;">Step 2: Create CIM Field Aliases (via UI)</strong>
                <ol style="margin:8px 0 0 16px;font-size:0.875rem;color:var(--gray-600);">
                  <li>Go to <strong>Settings ‚Üí Fields ‚Üí Calculated fields</strong></li>
                  <li>Click <strong>"New Calculated Field"</strong></li>
                  <li>Create each mapping:
                    <table style="margin:8px 0;font-size:0.75rem;width:100%;">
                      <tr style="background:white;"><td style="padding:4px 8px;"><strong>Source type:</strong></td><td style="padding:4px 8px;"><code>cyberark:identity:audit</code></td></tr>
                      <tr style="background:white;"><td style="padding:4px 8px;"><strong>Name:</strong></td><td style="padding:4px 8px;"><code>user</code></td></tr>
                      <tr style="background:white;"><td style="padding:4px 8px;"><strong>Eval expression:</strong></td><td style="padding:4px 8px;"><code>Username</code></td></tr>
                    </table>
                  </li>
                  <li>Click <strong>Save</strong> ‚Üí Repeat for each field in the table below</li>
                </ol>
              </div>
              
              <!-- props.conf example -->
              <div style="background:var(--gray-50);padding:16px;border-radius:8px;">
                <strong style="font-size:0.875rem;">Alternative: props.conf Configuration</strong>
                <p style="margin:8px 0;font-size:0.8125rem;color:var(--gray-600);">Create/edit <code>props.conf</code> in your app:</p>
                <div class="code-block" style="margin:8px 0;">
                  <div class="code-body" style="padding:12px;">
                    <pre style="margin:0;font-size:0.75rem;"><code>[cyberark:identity:audit]
# Enable JSON parsing
KV_MODE = json
TIME_FORMAT = %Y-%m-%dT%H:%M:%S
TIME_PREFIX = "Timestamp":"

# CIM Field Aliases for Authentication Data Model
FIELDALIAS-user = Username AS user
FIELDALIAS-src_ip = FromIPAddress AS src_ip
FIELDALIAS-app = Application AS app
FIELDALIAS-auth_method = MfaMethod AS authentication_method
FIELDALIAS-src_device = DeviceId AS src_device_id

# Calculated field for CIM action (success/failure)
EVAL-action = case(match(EventType, "(?i)approve|login$|success"), "success", match(EventType, "(?i)deny|fail|expire"), "failure", 1=1, "unknown")

# Calculated field for authentication_result
EVAL-authentication_result = case(Result="Success", "success", Result="Failure", "failure", 1=1, lower(Result))</code></pre>
                  </div>
                </div>
              </div>
            </div>

            <!-- Method 3: Search-time -->
            <div class="card bordered-left warning" style="padding:20px;margin-bottom:24px;">
              <h5 style="color:var(--warning-700);margin-bottom:12px;">‚ö° Method 3: Search-Time Extraction (Quick Fix)</h5>
              <p style="font-size:0.875rem;color:var(--gray-600);margin-bottom:12px;">Use in your SPL when config changes aren't possible.</p>
              
              <div class="code-block" style="margin:0;">
                <div class="code-body" style="padding:12px;">
                  <pre style="margin:0;font-size:0.75rem;"><code>index=cyberark sourcetype=cyberark:identity:audit earliest=-24h
| rename Username AS user
| rename FromIPAddress AS src_ip
| rename Application AS app
| rename MfaMethod AS authentication_method
| eval action = case(match(EventType, "(?i)approve|login$"), "success", match(EventType, "(?i)deny|fail"), "failure", 1=1, "unknown")
| eval authentication_result = lower(Result)
| table _time user src_ip app authentication_method action authentication_result EventType</code></pre>
                </div>
              </div>
            </div>

            <!-- CyberArk Field Mapping -->
            <h4 style="font-size:1rem;margin-bottom:12px;">CyberArk ‚Üí CIM Field Mapping</h4>
            <div class="table-container" style="margin-bottom:24px;">
              <table>
                <thead><tr><th>CyberArk Raw Field</th><th>CIM Field</th><th>Data Model</th><th>Description</th></tr></thead>
                <tbody>
                  <tr><td class="highlight">Username</td><td><code>user</code></td><td>Authentication</td><td>Username attempting auth</td></tr>
                  <tr><td class="highlight">FromIPAddress</td><td><code>src_ip</code></td><td>Authentication</td><td>Source IP of request</td></tr>
                  <tr><td class="highlight">EventType</td><td><code>action</code></td><td>Authentication</td><td>Type of auth event</td></tr>
                  <tr><td class="highlight">Result</td><td><code>authentication_result</code></td><td>Authentication</td><td>Success/failure</td></tr>
                  <tr><td class="highlight">Application</td><td><code>app</code></td><td>Authentication</td><td>Application accessed</td></tr>
                  <tr><td class="highlight">MfaMethod</td><td><code>authentication_method</code></td><td>Authentication</td><td>MFA method used</td></tr>
                  <tr><td class="highlight">DeviceId</td><td><code>src_device_id</code></td><td>Authentication</td><td>Device identifier</td></tr>
                  <tr><td class="highlight">Timestamp</td><td><code>_time</code></td><td>‚Äî</td><td>Event timestamp</td></tr>
                </tbody>
              </table>
            </div>

            <!-- CyberArk Event Type Mapping -->
            <h4 style="font-size:1rem;margin-bottom:12px;">CyberArk Event Type ‚Üí CIM Action Mapping</h4>
            <div class="table-container" style="margin-bottom:24px;">
              <table>
                <thead><tr><th>CyberArk EventType</th><th>CIM action</th><th>Detection Use</th></tr></thead>
                <tbody>
                  <tr><td class="highlight">Cloud.Core.MfaApprove</td><td><code>success</code></td><td>MFA approved - normal</td></tr>
                  <tr><td class="highlight">Cloud.Core.MfaDeny</td><td><code>failure</code></td><td>üî¥ MFA denied - key for fatigue detection</td></tr>
                  <tr><td class="highlight">Cloud.Core.MfaExpire</td><td><code>failure</code></td><td>MFA request timed out</td></tr>
                  <tr><td class="highlight">Cloud.Core.Login</td><td><code>success</code></td><td>Successful login</td></tr>
                  <tr><td class="highlight">Cloud.Core.LoginFail</td><td><code>failure</code></td><td>Failed login attempt</td></tr>
                  <tr><td class="highlight">Cloud.Core.Logout</td><td><code>success</code></td><td>User logout (informational)</td></tr>
                </tbody>
              </table>
            </div>

            <!-- CyberArk Validation Query -->
            <h4 style="font-size:1rem;margin-bottom:12px;">CyberArk CIM Validation Query</h4>
            <div class="code-block" style="margin-bottom:24px;">
              <div class="code-header"><span class="code-title">Verify CIM Compliance</span></div>
              <div class="code-body">
                <pre><code>``` Check Authentication data model
| datamodel Authentication Authentication search
| where sourcetype="cyberark:*"
| head 10
| table _time user src_ip action app authentication_method

``` Check raw field extraction
index=cyberark earliest=-1h | head 5
| table _raw
``` Should see clean JSON

``` Manual CIM field check
index=cyberark earliest=-1h | head 100
| stats count by user, src_ip, EventType
| where isnotnull(user)

``` Check MFA specific events
index=cyberark earliest=-24h 
| search EventType=*Mfa*
| stats count by EventType, Result</code></pre>
              </div>
            </div>

            <!-- CyberArk Custom Field Extraction -->
            <h4 style="font-size:1rem;margin-bottom:12px;">CyberArk Custom Extraction (If TA Missing)</h4>
            <div class="code-block" style="margin-bottom:24px;">
              <div class="code-header"><span class="code-title">props.conf for CyberArk</span></div>
              <div class="code-body">
                <pre><code>[cyberark:identity:audit]
KV_MODE = json
TIME_FORMAT = %Y-%m-%dT%H:%M:%S.%3N%Z
TIME_PREFIX = "Timestamp"\s*:\s*"
MAX_TIMESTAMP_LOOKAHEAD = 32

# Field aliases for CIM
FIELDALIAS-user = Username AS user
FIELDALIAS-src_ip = FromIPAddress AS src_ip
FIELDALIAS-app = Application AS app
FIELDALIAS-action = EventType AS action</code></pre>
              </div>
            </div>

            <!-- CyberArk Troubleshooting -->
            <h4 style="font-size:1rem;margin-bottom:12px;">CyberArk Parsing Issues & Fixes</h4>
            <div class="table-container">
              <table>
                <thead><tr><th>Issue</th><th>Symptom</th><th>Fix</th></tr></thead>
                <tbody>
                  <tr><td class="highlight">JSON not parsed</td><td>Fields inside _raw, not extracted</td><td>Add <code>KV_MODE = json</code> in props.conf</td></tr>
                  <tr><td class="highlight">Wrong timestamp</td><td>_time doesn't match event time</td><td>Configure TIME_FORMAT and TIME_PREFIX</td></tr>
                  <tr><td class="highlight">Missing MFA events</td><td>Only login events visible</td><td>Enable MFA audit in CyberArk portal</td></tr>
                  <tr><td class="highlight">No CIM mapping</td><td>CIM fields null</td><td>Add FIELDALIAS entries in props.conf</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- ==================== ENTRA ID CIM TAB ==================== -->
          <div id="entra-cim" class="tab-content entra-content">
            <div class="tab-header">
              <h3>Entra ID (Azure AD) Field Mapping & CIM</h3>
              <span class="badge" style="background:#0078d4;color:white;">Authentication Data Model</span>
            </div>

            <!-- Entra Parsing Flow -->
            <h4 style="font-size:1rem;margin-bottom:12px;">Entra ID Parsing Flow</h4>
            <div class="card" style="padding:24px;background:var(--gray-50);overflow-x:auto;margin-bottom:24px;">
              <div class="mermaid">
flowchart LR
    A[Nested JSON<br/>from Event Hub] --> B[Splunk Add-on<br/>for MS Cloud]
    B --> C[JSON Parsing<br/>+ spath]
    C --> D[Field Extraction<br/>Nested paths]
    D --> E[Field Aliasing<br/>CIM mapping]
    E --> F[Authentication<br/>Data Model]
    
    style A fill:#0078d4,stroke:#005a9e
    style F fill:#d4edda,stroke:#28a745
              </div>
            </div>

            <!-- Entra ID Special Considerations -->
            <div class="callout warning" style="margin-bottom:24px;">
              <div class="callout-content">
                <div class="callout-title">‚ö†Ô∏è Entra ID Has Deeply Nested JSON</div>
                <div class="callout-body">
                  Entra ID logs have <strong>nested JSON structures</strong> (e.g., <code>properties.status.errorCode</code>). This requires either:<br>
                  ‚Ä¢ A TA that handles nested extraction automatically<br>
                  ‚Ä¢ Manual <code>spath</code> commands in your searches<br>
                  ‚Ä¢ Calculated fields that extract nested paths
                </div>
              </div>
            </div>

            <!-- HOW TO CONFIGURE ENTRA CIM -->
            <h4 style="font-size:1rem;margin:24px 0 12px;">üîß How to Configure Entra ID CIM Mapping</h4>
            
            <!-- Method 1: TA -->
            <div class="card bordered-left success" style="padding:20px;margin-bottom:16px;">
              <h5 style="color:var(--success-700);margin-bottom:12px;">‚úÖ Method 1: Install Splunk Add-on for Microsoft Cloud Services (Recommended)</h5>
              <p style="font-size:0.875rem;color:var(--gray-600);margin-bottom:12px;">This TA handles nested JSON extraction and CIM mapping.</p>
              
              <div style="background:var(--gray-50);padding:16px;border-radius:8px;margin-bottom:12px;">
                <strong style="font-size:0.875rem;">Step-by-Step:</strong>
                <ol style="margin:8px 0 0 16px;font-size:0.875rem;color:var(--gray-600);">
                  <li><strong>Find the TA:</strong> Go to <a href="https://splunkbase.splunk.com" target="_blank">splunkbase.splunk.com</a> ‚Üí Search "Microsoft Cloud Services"</li>
                  <li><strong>Download:</strong> Splunk Add-on for Microsoft Cloud Services (TA-MS-AAD)</li>
                  <li><strong>Install:</strong> In Splunk: <code>Apps ‚Üí Manage Apps ‚Üí Install app from file</code></li>
                  <li><strong>Configure Input:</strong> Set up Azure Event Hub input in the TA</li>
                  <li><strong>Set sourcetype:</strong> Use <code>azure:aad:signin</code> for sign-in logs</li>
                  <li><strong>Verify:</strong> Run the validation query below</li>
                </ol>
              </div>
              
              <div style="font-size:0.8125rem;color:var(--gray-500);">
                <strong>What the TA does:</strong> Extracts nested <code>properties.*</code> fields, creates CIM field aliases, and tags events for the Authentication data model.
              </div>
            </div>

            <!-- Method 2: Manual Config -->
            <div class="card bordered-left info" style="padding:20px;margin-bottom:16px;">
              <h5 style="color:var(--primary-700);margin-bottom:12px;">üî® Method 2: Manual Configuration (Handle Nested JSON)</h5>
              <p style="font-size:0.875rem;color:var(--gray-600);margin-bottom:12px;">Configure extraction for deeply nested Entra ID fields.</p>
              
              <!-- Step 1: Create Sourcetype -->
              <div style="background:var(--gray-50);padding:16px;border-radius:8px;margin-bottom:12px;">
                <strong style="font-size:0.875rem;">Step 1: Create/Configure Sourcetype</strong>
                <ol style="margin:8px 0 0 16px;font-size:0.875rem;color:var(--gray-600);">
                  <li>Go to <strong>Settings ‚Üí Source types</strong></li>
                  <li>Click <strong>"New Source Type"</strong> (or edit existing)</li>
                  <li>Fill in:
                    <ul style="margin:4px 0 4px 16px;">
                      <li><strong>Name:</strong> <code>azure:aad:signin</code></li>
                      <li><strong>Category:</strong> Cloud</li>
                    </ul>
                  </li>
                  <li>Click <strong>Advanced</strong> ‚Üí Set <strong>KV_MODE:</strong> <code>json</code></li>
                  <li>Click <strong>Save</strong></li>
                </ol>
              </div>
              
              <!-- Step 2: Create Calculated Fields for Nested Paths -->
              <div style="background:var(--gray-50);padding:16px;border-radius:8px;margin-bottom:12px;">
                <strong style="font-size:0.875rem;">Step 2: Create Calculated Fields for Nested JSON</strong>
                <p style="margin:8px 0;font-size:0.8125rem;color:var(--gray-600);">Go to <strong>Settings ‚Üí Fields ‚Üí Calculated fields</strong> and create each:</p>
                
                <div class="table-container" style="margin-top:8px;">
                  <table style="font-size:0.75rem;">
                    <thead><tr><th>Name</th><th>Eval Expression</th><th>Purpose</th></tr></thead>
                    <tbody>
                      <tr><td><code>user</code></td><td><code>spath(_raw, "properties.userPrincipalName")</code></td><td>Extract username</td></tr>
                      <tr><td><code>src_ip</code></td><td><code>spath(_raw, "properties.ipAddress")</code></td><td>Extract source IP</td></tr>
                      <tr><td><code>app</code></td><td><code>spath(_raw, "properties.appDisplayName")</code></td><td>Extract app name</td></tr>
                      <tr><td><code>error_code</code></td><td><code>spath(_raw, "properties.status.errorCode")</code></td><td>Extract error code</td></tr>
                      <tr><td><code>action</code></td><td><code>if(spath(_raw,"properties.status.errorCode")=0,"success","failure")</code></td><td>CIM action</td></tr>
                      <tr><td><code>city</code></td><td><code>spath(_raw, "properties.location.city")</code></td><td>Location city</td></tr>
                      <tr><td><code>country</code></td><td><code>spath(_raw, "properties.location.countryOrRegion")</code></td><td>Location country</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>
              
              <!-- props.conf example -->
              <div style="background:var(--gray-50);padding:16px;border-radius:8px;">
                <strong style="font-size:0.875rem;">Alternative: Complete props.conf Configuration</strong>
                <p style="margin:8px 0;font-size:0.8125rem;color:var(--gray-600);">Add to your app's <code>local/props.conf</code>:</p>
                <div class="code-block" style="margin:8px 0;">
                  <div class="code-body" style="padding:12px;">
                    <pre style="margin:0;font-size:0.7rem;"><code>[azure:aad:signin]
# Enable JSON parsing
KV_MODE = json

# Time extraction from nested field
TIME_FORMAT = %Y-%m-%dT%H:%M:%S.%6N%Z
TIME_PREFIX = "createdDateTime"\s*:\s*"

# Extract nested fields for CIM Authentication data model
EVAL-user = json_extract(_raw, "properties.userPrincipalName")
EVAL-src_ip = json_extract(_raw, "properties.ipAddress")
EVAL-app = json_extract(_raw, "properties.appDisplayName")
EVAL-dest = json_extract(_raw, "properties.resourceDisplayName")
EVAL-error_code = json_extract(_raw, "properties.status.errorCode")
EVAL-action = if(json_extract(_raw, "properties.status.errorCode")="0", "success", "failure")
EVAL-authentication_method = json_extract(_raw, "properties.authenticationRequirement")
EVAL-src_city = json_extract(_raw, "properties.location.city")
EVAL-src_country = json_extract(_raw, "properties.location.countryOrRegion")

# Vendor/product identification
EVAL-vendor_product = "Microsoft Entra ID"</code></pre>
                  </div>
                </div>
              </div>
            </div>

            <!-- Method 3: Search-time -->
            <div class="card bordered-left warning" style="padding:20px;margin-bottom:24px;">
              <h5 style="color:var(--warning-700);margin-bottom:12px;">‚ö° Method 3: Search-Time Extraction with spath (Quick Fix)</h5>
              <p style="font-size:0.875rem;color:var(--gray-600);margin-bottom:12px;">Use spath to extract nested JSON at search time.</p>
              
              <div class="code-block" style="margin:0;">
                <div class="code-body" style="padding:12px;">
                  <pre style="margin:0;font-size:0.7rem;"><code>index=azure sourcetype=azure:aad:signin earliest=-24h
| spath
| eval user = 'properties.userPrincipalName'
| eval src_ip = 'properties.ipAddress'
| eval app = 'properties.appDisplayName'
| eval error_code = 'properties.status.errorCode'
| eval action = if(error_code=0, "success", "failure")
| eval city = 'properties.location.city'
| eval country = 'properties.location.countryOrRegion'
| eval auth_requirement = 'properties.authenticationRequirement'
| table _time user src_ip app action error_code city country auth_requirement</code></pre>
                </div>
              </div>
              <p style="font-size:0.75rem;color:var(--gray-500);margin-top:8px;">‚ö†Ô∏è <code>spath</code> can be slow on large datasets. For production, use Method 2 calculated fields.</p>
            </div>

            <!-- Entra Special Note -->
            <div class="callout warning" style="margin-bottom:24px;">
              <div class="callout-content">
                <div class="callout-title">Entra ID Has Deeply Nested JSON</div>
                <div class="callout-body">
                  Entra ID logs use nested JSON paths like <code>properties.userPrincipalName</code>. The Splunk Add-on handles most extraction, but you may need to use <code>spath</code> for complex fields like <code>authenticationDetails</code> arrays.
                </div>
              </div>
            </div>

            <!-- Entra Field Mapping -->
            <h4 style="font-size:1rem;margin-bottom:12px;">Entra ID ‚Üí CIM Field Mapping</h4>
            <div class="table-container" style="margin-bottom:24px;">
              <table>
                <thead><tr><th>Entra ID Raw Field</th><th>CIM Field</th><th>Data Model</th><th>Description</th></tr></thead>
                <tbody>
                  <tr><td class="highlight">properties.userPrincipalName</td><td><code>user</code></td><td>Authentication</td><td>User email/UPN</td></tr>
                  <tr><td class="highlight">properties.ipAddress</td><td><code>src_ip</code></td><td>Authentication</td><td>Source IP address</td></tr>
                  <tr><td class="highlight">properties.appDisplayName</td><td><code>app</code></td><td>Authentication</td><td>Application accessed</td></tr>
                  <tr><td class="highlight">properties.status.errorCode</td><td><code>signature_id</code></td><td>Authentication</td><td>Result code (0=success)</td></tr>
                  <tr><td class="highlight">properties.location.city</td><td><code>src_city</code></td><td>Authentication</td><td>Source city</td></tr>
                  <tr><td class="highlight">properties.location.countryOrRegion</td><td><code>src_country</code></td><td>Authentication</td><td>Source country</td></tr>
                  <tr><td class="highlight">properties.deviceDetail.deviceId</td><td><code>src_device_id</code></td><td>Authentication</td><td>Device identifier</td></tr>
                  <tr><td class="highlight">properties.authenticationRequirement</td><td><code>authentication_method</code></td><td>Authentication</td><td>singleFactor/multiFactor</td></tr>
                </tbody>
              </table>
            </div>

            <!-- Entra Error Code Mapping -->
            <h4 style="font-size:1rem;margin-bottom:12px;">Entra ID Error Codes ‚Üí CIM Action</h4>
            <div class="table-container" style="margin-bottom:24px;">
              <table>
                <thead><tr><th>Error Code</th><th>Meaning</th><th>CIM action</th><th>Detection Use</th></tr></thead>
                <tbody>
                  <tr><td class="highlight">0</td><td>Success</td><td><code>success</code></td><td>Normal login</td></tr>
                  <tr><td class="highlight">50074</td><td>Strong auth required</td><td><code>failure</code></td><td>MFA challenge triggered</td></tr>
                  <tr><td class="highlight">50076</td><td>MFA required (CA policy)</td><td><code>failure</code></td><td>Conditional Access enforcement</td></tr>
                  <tr><td class="highlight">50126</td><td>Invalid credentials</td><td><code>failure</code></td><td>Wrong password</td></tr>
                  <tr><td class="highlight">50053</td><td>Account locked</td><td><code>failure</code></td><td>üî¥ Brute force indicator</td></tr>
                  <tr><td class="highlight">50057</td><td>Account disabled</td><td><code>failure</code></td><td>Disabled account attempt</td></tr>
                  <tr><td class="highlight">530003</td><td>Device not compliant</td><td><code>failure</code></td><td>Device compliance failure</td></tr>
                </tbody>
              </table>
            </div>

            <!-- Entra Validation Query -->
            <h4 style="font-size:1rem;margin-bottom:12px;">Entra ID CIM Validation Query</h4>
            <div class="code-block" style="margin-bottom:24px;">
              <div class="code-header"><span class="code-title">Verify CIM Compliance</span></div>
              <div class="code-body">
                <pre><code>``` Check Authentication data model for Entra
| datamodel Authentication Authentication search
| where sourcetype="azure:aad:signin"
| head 10
| table _time user src_ip app action

``` Check raw nested JSON extraction
index=azure sourcetype=azure:aad:signin earliest=-1h | head 5
| spath
| table properties.userPrincipalName properties.ipAddress properties.status.errorCode

``` Extract MFA requirement field
index=azure sourcetype=azure:aad:signin earliest=-24h 
| spath properties.authenticationRequirement
| stats count by properties.authenticationRequirement
``` Should see: singleFactorAuthentication, multiFactorAuthentication

``` Extract auth details array (MFA methods)
index=azure sourcetype=azure:aad:signin earliest=-24h 
| spath properties.authenticationDetails{}
| mvexpand properties.authenticationDetails{}
| spath input=properties.authenticationDetails{} path=authenticationMethod
| stats count by authenticationMethod

``` Check for error codes distribution
index=azure sourcetype=azure:aad:signin earliest=-24h 
| spath properties.status.errorCode
| stats count by properties.status.errorCode
| sort - count</code></pre>
              </div>
            </div>

            <!-- Entra Custom Extraction -->
            <h4 style="font-size:1rem;margin-bottom:12px;">Entra ID Custom Field Extraction</h4>
            <div class="code-block" style="margin-bottom:24px;">
              <div class="code-header"><span class="code-title">Search-Time Extraction for Nested Fields</span></div>
              <div class="code-body">
                <pre><code>``` Use eval with spath for complex extractions
index=azure sourcetype=azure:aad:signin earliest=-24h
| spath
| eval user = 'properties.userPrincipalName'
| eval src_ip = 'properties.ipAddress'
| eval app = 'properties.appDisplayName'
| eval error_code = 'properties.status.errorCode'
| eval city = 'properties.location.city'
| eval country = 'properties.location.countryOrRegion'
| eval auth_requirement = 'properties.authenticationRequirement'
| eval action = if(error_code=0, "success", "failure")
| table _time user src_ip app action error_code city country auth_requirement</code></pre>
              </div>
            </div>

            <!-- Entra Troubleshooting -->
            <h4 style="font-size:1rem;margin-bottom:12px;">Entra ID Parsing Issues & Fixes</h4>
            <div class="table-container">
              <table>
                <thead><tr><th>Issue</th><th>Symptom</th><th>Fix</th></tr></thead>
                <tbody>
                  <tr><td class="highlight">Fields not extracted</td><td>properties.* fields missing</td><td>Use <code>spath</code> command or check TA config</td></tr>
                  <tr><td class="highlight">Nested arrays not expanded</td><td>authenticationDetails shows as JSON string</td><td>Use <code>spath</code> + <code>mvexpand</code> for array fields</td></tr>
                  <tr><td class="highlight">CIM fields empty</td><td>Data model returns no results</td><td>Verify field aliases in props.conf, check CIM Add-on</td></tr>
                  <tr><td class="highlight">Slow searches</td><td>Nested JSON parsing timeout</td><td>Create calculated fields in props.conf for frequently used paths</td></tr>
                  <tr><td class="highlight">Missing location data</td><td>city/country null</td><td>Location may not be available for all sign-ins (internal network, proxy)</td></tr>
                </tbody>
              </table>
            </div>
          </div>

        </div><!-- End tabs-container -->

      </div>
    </main>
  </div>
  <script src="../js/app.js"></script>
  <script>mermaid.initialize({startOnLoad:true, theme:'neutral'});</script>
</body>
</html>
