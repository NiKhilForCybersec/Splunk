<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CyberArk Identity | myfirstpro Detection Engineering</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <div class="app-container">
                        <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <a href="../index.html" style="display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit;">
            <div class="sidebar-logo-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            </div>
            <div class="sidebar-logo-text">
              <h1>myfirstpro</h1>
              <span>Detection Engineering</span>
            </div>
          </a>
        </div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Getting Started</div>
          <a href="../index.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg><span>Command Center</span></a>
          <a href="day1.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/></svg><span>Day 1 Checklist</span></a>
          <a href="client-comm.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg><span>Client Communication</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Data Sources</div>
          <a href="vendor-akamai.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><span>Akamai WAF</span></a>
          <a href="vendor-cyberark.html" class="nav-item active"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg><span>CyberArk Identity</span></a>
          <a href="vendor-entra.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg><span>Entra ID</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Splunk Operations</div>
          <a href="waf-onboarding.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg><span>Log Onboarding</span></a>
          <a href="parsing-cim.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg><span>Parsing & CIM</span></a>
          <a href="lookups.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg><span>Lookups Deep Dive</span></a>
          <a href="splunk-ops.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg><span>Splunk Cloud Ops</span></a>
          <a href="spl-reference.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg><span>SPL Reference</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">WAF/DDoS Project</div>
          <a href="waf-overview.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span>Project Overview</span></a>
          <a href="waf-usecases.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>Use Cases (UC1-8)</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">MFA Project</div>
          <a href="mfa-overview.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span>Project Overview</span></a>
          <a href="mfa-usecases.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>Use Cases (UC1-5)</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Response & Support</div>
          <a href="decision-trees.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="5" r="3"/><line x1="12" y1="8" x2="12" y2="14"/><circle cx="6" cy="19" r="3"/><circle cx="18" cy="19" r="3"/></svg><span>Decision Trees</span></a>
          <a href="troubleshooting.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><span>Troubleshooting</span></a>
          <a href="runbooks.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>SOC Runbooks</span></a>
        </div>
      </nav>
      <div class="sidebar-footer"><p>Detection Engineering v2.0</p></div>
    </aside>

    <main class="main-content">
      <header class="header">
        <div class="header-left">
          <button class="menu-toggle" aria-label="Toggle menu">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
          </button>
          <div class="breadcrumb">
            <a href="../index.html" class="breadcrumb-item">Home</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-item">Vendors</span>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-item current">CyberArk</span>
          </div>
        </div>
        <span class="badge cyberark">PRIMARY MFA</span>
      </header>

      <div class="page-content">
        <div class="section">
          <h1 class="section-title">CyberArk Identity</h1>
          <p class="section-subtitle">Primary MFA source for privileged users at myfirstpro</p>
        </div>


        <!-- CyberArk Authentication Flow -->
        <div class="section">
          <h2 class="subsection-title">CyberArk Authentication Flow</h2>
          <div class="card" style="padding:24px;background:var(--gray-50);overflow-x:auto;">
            <div class="mermaid">
flowchart LR
    A[User Login] --> B[Entra ID SSO]
    B --> C{Privileged<br/>User?}
    C -->|Yes| D[CyberArk MFA]
    C -->|No| E[Entra MFA]
    D --> F[Identity Audit Log]
    E --> G[Sign-in Log]
    F --> H[Splunk]
    G --> H
    H --> I[MFA Detections]
    
    style D fill:#6f2da8,stroke:#5a2587,color:#fff
    style I fill:#65a637,stroke:#4a7c28,color:#fff
            </div>
          </div>
        </div>


        <!-- Critical Notice -->
        <div class="callout critical">
          <svg class="callout-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/></svg>
          <div class="callout-content">
            <div class="callout-title">CyberArk is PRIMARY for Privileged User MFA</div>
            <div class="callout-body">
              Query CyberArk logs <strong>FIRST</strong> for MFA fatigue detection on privileged accounts. Entra ID is secondary for standard users.<br>
              <strong>Index:</strong> <code>cyberark</code> | <strong>Sourcetype:</strong> <code>cyberark:identity:audit</code>
            </div>
          </div>
        </div>

        <!-- Key Event Types -->
        <div class="section">
          <h2 class="subsection-title">MFA-Related Event Types</h2>
          <div class="table-container">
            <table>
              <thead>
                <tr><th>EventType</th><th>Description</th><th>Detection Use</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td class="highlight"><code>Cloud.Core.MfaAuthentication</code></td>
                  <td>MFA challenge response (success/failure)</td>
                  <td>Primary for fatigue detection</td>
                </tr>
                <tr>
                  <td class="highlight"><code>Cloud.Core.MfaDenied</code></td>
                  <td>User explicitly denied MFA push</td>
                  <td>Key indicator for push bombing</td>
                </tr>
                <tr>
                  <td class="highlight"><code>Cloud.Core.MfaTimeout</code></td>
                  <td>MFA challenge timed out</td>
                  <td>May indicate fatigue or absence</td>
                </tr>
                <tr>
                  <td><code>Cloud.Core.MfaChallenge</code></td>
                  <td>MFA challenge initiated</td>
                  <td>Volume tracking</td>
                </tr>
                <tr>
                  <td><code>Cloud.Core.Login</code></td>
                  <td>User login attempt</td>
                  <td>Auth tracking</td>
                </tr>
                <tr>
                  <td><code>Cloud.Core.Logout</code></td>
                  <td>User logout</td>
                  <td>Session tracking</td>
                </tr>
                <tr>
                  <td><code>Cloud.Saas.AppLaunch</code></td>
                  <td>Application access via SSO</td>
                  <td>Activity monitoring</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Field Schema -->
        <div class="section">
          <h2 class="subsection-title">CyberArk Identity Log Schema</h2>
          <div class="table-container">
            <table>
              <thead>
                <tr><th>Field</th><th>Type</th><th>Description</th><th>CIM Mapping</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td class="highlight"><code>ActorId</code></td>
                  <td>string</td>
                  <td>User email/identifier</td>
                  <td><code>user</code></td>
                </tr>
                <tr>
                  <td class="highlight"><code>Result</code></td>
                  <td>string</td>
                  <td>Success, Failure, Denied, Timeout</td>
                  <td><code>action</code></td>
                </tr>
                <tr>
                  <td class="highlight"><code>ResultReason</code></td>
                  <td>string</td>
                  <td>Failure reason details</td>
                  <td><code>reason</code></td>
                </tr>
                <tr>
                  <td class="highlight"><code>ClientIP</code></td>
                  <td>string</td>
                  <td>Source IP address</td>
                  <td><code>src</code></td>
                </tr>
                <tr>
                  <td><code>EventType</code></td>
                  <td>string</td>
                  <td>Event category</td>
                  <td>-</td>
                </tr>
                <tr>
                  <td><code>EventTime</code></td>
                  <td>datetime</td>
                  <td>Event timestamp</td>
                  <td><code>_time</code></td>
                </tr>
                <tr>
                  <td><code>AuthMethod</code></td>
                  <td>string</td>
                  <td>MFA method used</td>
                  <td><code>authentication_method</code></td>
                </tr>
                <tr>
                  <td><code>Country</code></td>
                  <td>string</td>
                  <td>Source country</td>
                  <td><code>src_country</code></td>
                </tr>
                <tr>
                  <td><code>City</code></td>
                  <td>string</td>
                  <td>Source city</td>
                  <td><code>src_city</code></td>
                </tr>
                <tr>
                  <td><code>DeviceId</code></td>
                  <td>string</td>
                  <td>Device identifier</td>
                  <td><code>dest</code></td>
                </tr>
                <tr>
                  <td><code>TargetId</code></td>
                  <td>string</td>
                  <td>Target application</td>
                  <td><code>app</code></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Result Values -->
        <div class="section">
          <h2 class="subsection-title">Result Values</h2>
          <div class="grid grid-4">
            <div class="card bordered-left success">
              <h4><code>Success</code></h4>
              <p style="font-size:0.8125rem;color:var(--gray-600);">MFA approved successfully</p>
            </div>
            <div class="card bordered-left error">
              <h4><code>Failure</code></h4>
              <p style="font-size:0.8125rem;color:var(--gray-600);">Authentication failed</p>
            </div>
            <div class="card bordered-left critical">
              <h4><code>Denied</code></h4>
              <p style="font-size:0.8125rem;color:var(--gray-600);">User explicitly denied push</p>
            </div>
            <div class="card bordered-left warning">
              <h4><code>Timeout</code></h4>
              <p style="font-size:0.8125rem;color:var(--gray-600);">Challenge expired</p>
            </div>
          </div>
        </div>

        <!-- MFA Fatigue Detection SPL -->
        <div class="section">
          <h2 class="subsection-title">MFA-UC1: MFA Fatigue Detection (CyberArk)</h2>
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">MFA Fatigue / Push Bombing Detection</span>
              <span class="code-lang">SPL</span>
            </div>
            <div class="code-body">
              <pre><code>index=cyberark sourcetype=cyberark:identity:audit earliest=-15m
    EventType IN ("Cloud.Core.MfaAuthentication", "Cloud.Core.MfaDenied", "Cloud.Core.MfaTimeout")
| spath
| eval user = ActorId
| eval mfa_denied = if(Result IN ("Failure", "Denied", "Timeout"), 1, 0)
| eval mfa_success = if(Result == "Success", 1, 0)

``` Enrich with privileged user lookup
| lookup privileged_users.csv userPrincipalName as user OUTPUT is_privileged role department

``` Focus on privileged users only
| where is_privileged = "true"

``` Aggregate by user in 10-minute windows
| bin _time span=10m
| stats 
    sum(mfa_denied) as total_denials 
    sum(mfa_success) as total_successes
    values(ClientIP) as source_ips
    values(City) as cities
    values(Country) as countries
    values(AuthMethod) as auth_methods
    latest(role) as role
    BY _time user

``` Alert threshold: 5+ denials in 10 minutes
| where total_denials >= 5

``` CRITICAL if denials followed by success (likely compromise)
| eval severity = case(
    total_denials >= 5 AND total_successes >= 1, "CRITICAL",
    total_denials >= 10, "CRITICAL",
    total_denials >= 5, "HIGH",
    1=1, "MEDIUM"
)

| eval alert_message = case(
    severity="CRITICAL" AND total_successes >= 1, 
        "MFA FATIGUE SUCCESS - Account likely compromised",
    severity="CRITICAL", 
        "Heavy push bombing attack in progress",
    1=1, 
        "MFA fatigue attack detected"
)

| table _time user role total_denials total_successes source_ips cities severity alert_message</code></pre>
            </div>
          </div>
        </div>

        <!-- Validation Queries -->
        <div class="section">
          <h2 class="subsection-title">Validation Queries</h2>

          <div class="code-block">
            <div class="code-header">
              <span class="code-title">Check CyberArk Data Presence</span>
            </div>
            <div class="code-body">
              <pre><code>index=cyberark sourcetype=cyberark:identity:audit earliest=-1h
| stats count as total_events 
        dc(ActorId) as unique_users
        dc(EventType) as event_types
        latest(_time) as last_event
| eval last_event = strftime(last_event, "%Y-%m-%d %H:%M:%S")
| eval status = if(total_events > 0, "✅ Data flowing", "❌ No data")</code></pre>
            </div>
          </div>

          <div class="code-block">
            <div class="code-header">
              <span class="code-title">MFA Event Distribution</span>
            </div>
            <div class="code-body">
              <pre><code>index=cyberark sourcetype=cyberark:identity:audit earliest=-24h
    EventType IN ("Cloud.Core.MfaAuthentication", "Cloud.Core.MfaDenied", "Cloud.Core.MfaTimeout")
| stats count BY EventType Result
| sort EventType Result</code></pre>
            </div>
          </div>

          <div class="code-block">
            <div class="code-header">
              <span class="code-title">Top Users by MFA Denials</span>
            </div>
            <div class="code-body">
              <pre><code>index=cyberark sourcetype=cyberark:identity:audit earliest=-7d
    EventType IN ("Cloud.Core.MfaDenied", "Cloud.Core.MfaTimeout")
| stats count as denials BY ActorId
| sort - denials
| head 20</code></pre>
            </div>
          </div>
        </div>

        <!-- props.conf -->
        <div class="section">
          <h2 class="subsection-title">props.conf Configuration</h2>
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">CyberArk Field Aliases and Normalizations</span>
            </div>
            <div class="code-body">
              <pre><code>[cyberark:identity:audit]
# Timestamp
TIME_FORMAT = %Y-%m-%dT%H:%M:%S.%3N%Z
TIME_PREFIX = \"EventTime\":\"
MAX_TIMESTAMP_LOOKAHEAD = 50
TZ = UTC

# Parsing
KV_MODE = json
TRUNCATE = 0
SHOULD_LINEMERGE = false

# CIM Field Aliases
FIELDALIAS-user = ActorId AS user
FIELDALIAS-src = ClientIP AS src
FIELDALIAS-app = TargetId AS app
FIELDALIAS-src_city = City AS src_city
FIELDALIAS-src_country = Country AS src_country
FIELDALIAS-authentication_method = AuthMethod AS authentication_method

# Calculated Fields
EVAL-action = case(
    Result=="Success", "success",
    Result IN ("Failure", "Denied", "Timeout"), "failure",
    1=1, lower(Result)
)
EVAL-reason = ResultReason
EVAL-vendor = "CyberArk"
EVAL-product = "Identity"</code></pre>
            </div>
          </div>
        </div>

        <!-- Integration with Entra ID -->
        <div class="section">
          <h2 class="subsection-title">CyberArk + Entra ID Correlation</h2>
          <div class="callout info">
            <svg class="callout-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
            <div class="callout-content">
              <div class="callout-title">Federation Pattern</div>
              <div class="callout-body">CyberArk is federated with Entra ID at myfirstpro. Privileged users authenticate via Entra ID SSO, but MFA is handled by CyberArk. This means you may see login events in both systems.</div>
            </div>
          </div>

          <div class="code-block">
            <div class="code-header">
              <span class="code-title">Combined MFA Detection (Both Sources)</span>
            </div>
            <div class="code-body">
              <pre><code>``` Query both CyberArk and Entra ID, normalize, and combine
(index=cyberark sourcetype=cyberark:identity:audit EventType IN ("Cloud.Core.MfaAuthentication", "Cloud.Core.MfaDenied")) 
OR 
(index=azure sourcetype=azure:aad:signin)
earliest=-30m

| spath

``` Normalize fields across both sources
| eval user = lower(coalesce(ActorId, 'properties.userPrincipalName'))
| eval source_system = case(
    sourcetype=="cyberark:identity:audit", "CyberArk",
    sourcetype=="azure:aad:signin", "EntraID",
    1=1, "Unknown"
)
| eval mfa_denied = case(
    sourcetype=="cyberark:identity:audit" AND Result IN ("Failure", "Denied", "Timeout"), 1,
    sourcetype=="azure:aad:signin" AND 'properties.status.errorCode'==500121, 1,
    1=1, 0
)
| eval mfa_success = case(
    sourcetype=="cyberark:identity:audit" AND Result=="Success", 1,
    sourcetype=="azure:aad:signin" AND 'properties.status.errorCode'==0, 1,
    1=1, 0
)

``` Lookup privileged users
| lookup privileged_users.csv userPrincipalName as user OUTPUT is_privileged role
| where is_privileged = "true"

``` Aggregate across all sources
| bin _time span=10m
| stats sum(mfa_denied) as total_denials
        sum(mfa_success) as total_successes
        values(source_system) as systems_involved
        dc(ClientIP) as unique_ips
        BY _time user role

| where total_denials >= 5

| eval severity = if(total_successes >= 1, "CRITICAL", "HIGH")
| table _time user role total_denials total_successes systems_involved severity</code></pre>
            </div>
          </div>
        </div>

      
        <!-- EDGE CASES & DECISIONS -->
        <div class="section" style="margin-top:48px;border-top:2px solid var(--gray-200);padding-top:32px;">
          <h2 class="subsection-title" style="color:var(--warning-600);">⚠️ MFA Edge Cases & Decisions</h2>
          
          <div class="table-container">
            <table>
              <thead><tr><th>Scenario</th><th>Challenge</th><th>How to Handle</th></tr></thead>
              <tbody>
                <tr><td class="highlight">Service accounts with MFA</td><td>Automation can't do MFA</td><td>Document exclusions with business justification</td></tr>
                <tr><td class="highlight">Shared admin accounts</td><td>Can't attribute to individual</td><td>Flag as risk, recommend individual accounts</td></tr>
                <tr><td class="highlight">VPN MFA vs App MFA</td><td>Different systems, different logs</td><td>Understand which MFA where in auth chain</td></tr>
                <tr><td class="highlight">Federated identity</td><td>Multiple IdPs (Okta → Entra → CyberArk)</td><td>Map federation chain, correlate events</td></tr>
                <tr><td class="highlight">Legacy apps (no MFA)</td><td>Auth without MFA - blind spot</td><td>Document as risk exception</td></tr>
                <tr><td class="highlight">Contractors/vendors</td><td>Different access patterns</td><td>Separate baseline or flag for review</td></tr>
                <tr><td class="highlight">New hire first login</td><td>Triggers "new device" alerts</td><td>7-day grace period for new accounts</td></tr>
                <tr><td class="highlight">Terminated user activity</td><td>Should be impossible</td><td>CRITICAL alert, correlate with HR list</td></tr>
                <tr><td class="highlight">Password reset flow</td><td>Legitimate MFA events</td><td>Understand normal flow, exclude if needed</td></tr>
                <tr><td class="highlight">MFA method change</td><td>Could be attacker persistence</td><td>Alert on method changes for privileged users</td></tr>
              </tbody>
            </table>
          </div>

          <div class="callout warning" style="margin-top:16px;">
            <div class="callout-content">
              <div class="callout-title">Privileged User List - Ask These Questions</div>
              <div class="callout-body">
                1. <strong>Where is the authoritative list?</strong> (AD group? IAM tool? Spreadsheet?)<br>
                2. <strong>How often is it updated?</strong> (Real-time? Daily? Manual?)<br>
                3. <strong>What makes someone "privileged"?</strong> (Role? Group? System access?)<br>
                4. <strong>Are there tiers?</strong> (Domain Admin vs Server Admin vs Help Desk)<br>
                5. <strong>Are contractors included?</strong><br>
                6. <strong>Who approves changes to the list?</strong>
              </div>
            </div>
          </div>

          <h3 style="font-size:1rem;margin:24px 0 12px;">Field Changes After Upgrades</h3>
          <div class="callout critical">
            <div class="callout-content">
              <div class="callout-title">Watch Out!</div>
              <div class="callout-body">
                CyberArk upgrades may change field names. Handle both old and new:<br>
                <code>| eval user = coalesce(ActorId, UserName, userId, "unknown")</code><br>
                <code>| eval src_ip = coalesce(ClientIP, clientIp, SourceIP)</code>
              </div>
            </div>
          </div>
        </div>

      </div>
    </main>
  </div>
  <script src="../js/app.js"></script>
  <script>mermaid.initialize({startOnLoad:true, theme:'neutral'});</script>
</body>
</html>
