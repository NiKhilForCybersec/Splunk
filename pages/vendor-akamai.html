<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Akamai WAF | myfirstpro Detection Engineering</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <div class="app-container">
                                                    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <a href="../index.html" style="display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit;">
            <div class="sidebar-logo-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            </div>
            <div class="sidebar-logo-text">
              <h1>Splunk Reference</h1>
              <span>Log & Detection Engineering</span>
            </div>
          </a>
        </div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Getting Started</div>
          <a href="../index.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg><span>Command Center</span></a>
          <a href="day1.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/></svg><span>Day 1 Checklist</span></a>
          <a href="professional-excellence.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg><span>Professional Excellence</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Client Delivery</div>
          <a href="client-delivery.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg><span>Delivery Playbook</span></a>
          <a href="detection-template.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>Use Case Template</span></a>
          <a href="rba-design.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/></svg><span>RBA Design Guide</span></a>
          <a href="cim-mapping.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg><span>CIM Mapping Guide</span></a>
          <a href="es-mechanics.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg><span>ES Mechanics</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Splunk Platform</div>
          <a href="splunk-fundamentals.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg><span>Splunk 101</span></a>
          <a href="splunk-architecture.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg><span>Architecture</span></a>
          <a href="splunk-apps.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg><span>Apps & Add-ons</span></a>
          <a href="splunk-es.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><span>Enterprise Security</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Log Engineering</div>
          <a href="log-onboarding.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg><span>Log Onboarding</span></a>
          <a href="data-inputs.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg><span>Data Inputs</span></a>
          <a href="data-flow.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg><span>Data Flow</span></a>
          <a href="parsing-cim.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg><span>Parsing & CIM</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">SPL Mastery</div>
          <a href="splunk-howto.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg><span>SPL How-To</span></a>
          <a href="spl-reference.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg><span>SPL Reference</span></a>
          <a href="lookups.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg><span>Lookups</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Detection Development</div>
          <a href="correlation-searches.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><span>Correlation Searches</span></a>
          <a href="detection-lifecycle.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/></svg><span>Detection Lifecycle</span></a>
          <a href="decision-trees.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="5" r="3"/><line x1="12" y1="8" x2="12" y2="14"/><circle cx="6" cy="19" r="3"/><circle cx="18" cy="19" r="3"/></svg><span>Decision Trees</span></a>
          <a href="troubleshooting.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg><span>Troubleshooting</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Data Sources</div>
          <a href="vendor-akamai.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><span>Akamai WAF</span></a>
          <a href="vendor-entra.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg><span>Entra ID</span></a>
          <a href="vendor-cyberark.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg><span>CyberArk</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Active Projects</div>
          <a href="waf-overview.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span>WAF/DDoS Project</span></a>
          <a href="waf-usecases.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>WAF Use Cases</span></a>
          <a href="mfa-overview.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg><span>MFA Project</span></a>
          <a href="mfa-usecases.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>MFA Use Cases</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Operations</div>
          <a href="splunk-ops.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/></svg><span>Splunk Cloud Admin</span></a>
          <a href="client-comm.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg><span>Client Comms</span></a>
          <a href="runbooks.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>Runbooks</span></a>
          <a href="cheat-sheets.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="3" x2="9" y2="21"/></svg><span>Cheat Sheets</span></a>
        </div>
      </nav>
      <div class="sidebar-footer"><p>Log & Detection Engineering v3.0</p></div>
    </aside>

    <main class="main-content">
      <header class="header">
        <div class="header-left">
          <button class="menu-toggle" aria-label="Toggle menu">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
          </button>
          <div class="breadcrumb">
            <a href="../index.html" class="breadcrumb-item">Home</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-item">Vendors</span>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-item current">Akamai WAF</span>
          </div>
        </div>
        <span class="badge akamai">WAF Vendor</span>
      </header>

      <div class="page-content">
        <div class="section">
          <h1 class="section-title">Akamai WAF Data Reference</h1>
          <p class="section-subtitle">Complete reference for Akamai SIEM integration with Splunk</p>
        </div>


        <!-- Akamai Data Flow -->
        <div class="section">
          <h2 class="subsection-title">Akamai Data Flow</h2>
          <div class="card" style="padding:24px;background:var(--gray-50);overflow-x:auto;">
            <div class="mermaid">
flowchart LR
    A[Web Traffic] --> B[Akamai Edge]
    B --> C{WAF Rules}
    C -->|Block| D[SIEM API]
    C -->|Allow| E[Origin Server]
    D --> F[Splunk HEC]
    F --> G[index=akamai]
    G --> H[Detection Rules]
    
    style B fill:#0096d6,stroke:#007ab8,color:#fff
    style G fill:#65a637,stroke:#4a7c28,color:#fff
            </div>
          </div>
        </div>


        <!-- Key Info -->
        <div class="callout info">
          <svg class="callout-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
          <div class="callout-content">
            <div class="callout-title">Splunk Configuration</div>
            <div class="callout-body">
              <strong>Index:</strong> <code>akamai</code> | 
              <strong>Sourcetype:</strong> <code>akamai:siem</code> | 
              <strong>Add-on:</strong> TA-akamai (Splunk Add-on for Akamai)<br>
              <span style="font-size:0.8rem;color:var(--gray-500);">Note: Official Akamai SIEM Integration app uses <code>akamaisiem</code> (no colon). Verify with: <code>| metadata type=sourcetypes index=akamai</code></span>
            </div>
          </div>
        </div>

        <!-- ==================== RAW LOG JOURNEY ==================== -->
        <div class="section">
          <h2 class="subsection-title">üìú Raw Log Journey: Source ‚Üí Splunk ‚Üí Detection</h2>
          <p style="color:var(--gray-600);margin-bottom:24px;">See exactly how Akamai logs transform at each stage</p>

          <!-- STAGE 1: Raw from Akamai -->
          <div class="card" style="padding:20px;margin-bottom:16px;border-left:4px solid #ff9900;">
            <h4 style="color:#ff9900;margin-bottom:12px;">üì§ Stage 1: Raw JSON from Akamai SIEM API</h4>
            <p style="font-size:0.8125rem;color:var(--gray-600);margin-bottom:12px;">This is what Akamai sends via the SIEM Integration API:</p>
            <div class="code-block">
              <div class="code-header"><span class="code-title">Raw Akamai SIEM Event (JSON)</span></div>
              <div class="code-body">
                <pre style="font-size:0.75rem;"><code>{
  "type": "akamai_siem",
  "format": "json",
  "version": "1.0",
  "attackData": {
    "configId": "12345",
    "policyId": "qik1_12345",
    "clientIP": "203.0.113.42",
    "rules": [
      {
        "ruleId": "950001",
        "ruleTag": "SQLI",
        "ruleAction": "deny",
        "ruleMessage": "SQL Injection Attack Detected",
        "ruleData": "' OR '1'='1"
      }
    ],
    "ruleVersions": ["2023.12.1"],
    "apiId": "API_12345",
    "apiKey": "attack_key_001"
  },
  "httpMessage": {
    "requestId": "1a2b3c4d",
    "start": "2025-01-30T10:15:30Z",
    "protocol": "HTTP/1.1",
    "method": "POST",
    "host": "api.myfirstpro.com",
    "port": 443,
    "path": "/api/v1/login",
    "query": "redirect=/admin",
    "requestHeaders": {
      "User-Agent": "Mozilla/5.0 (Windows NT 10.0)",
      "Content-Type": "application/x-www-form-urlencoded",
      "Host": "api.myfirstpro.com"
    },
    "status": 403,
    "bytes": 1234,
    "responseHeaders": {
      "Content-Type": "text/html"
    }
  },
  "geo": {
    "continent": "EU",
    "country": "RU",
    "city": "Moscow",
    "regionCode": "MOW",
    "asn": "12345",
    "network": "Example ISP"
  }
}</code></pre>
              </div>
            </div>
          </div>

          <!-- STAGE 2: In Splunk _raw -->
          <div class="card" style="padding:20px;margin-bottom:16px;border-left:4px solid #65a637;">
            <h4 style="color:#65a637;margin-bottom:12px;">üì• Stage 2: Arrives in Splunk (_raw field)</h4>
            <p style="font-size:0.8125rem;color:var(--gray-600);margin-bottom:12px;">When the event hits Splunk via HEC, it's stored as a single JSON string in _raw:</p>
            <div class="code-block">
              <div class="code-header"><span class="code-title">Splunk _raw (Before TA Processing)</span></div>
              <div class="code-body">
                <pre style="font-size:0.75rem;"><code>index=akamai sourcetype=akamai:siem earliest=-5m | head 1 | table _raw

_raw:
{"type":"akamai_siem","format":"json","version":"1.0","attackData":{"configId":"12345","policyId":"qik1_12345","clientIP":"203.0.113.42","rules":[{"ruleId":"950001","ruleTag":"SQLI","ruleAction":"deny","ruleMessage":"SQL Injection Attack Detected","ruleData":"' OR '1'='1"}]...}</code></pre>
              </div>
            </div>
            <div class="callout warning" style="margin-top:12px;padding:12px;">
              <div class="callout-content">
                <div class="callout-body" style="font-size:0.8125rem;">
                  <strong>Without TA:</strong> All data is in _raw as one long JSON string. You'd need to use <code>spath</code> to extract every field manually!
                </div>
              </div>
            </div>
          </div>

          <!-- STAGE 3: After TA Extraction -->
          <div class="card" style="padding:20px;margin-bottom:16px;border-left:4px solid var(--primary-500);">
            <h4 style="color:var(--primary-700);margin-bottom:12px;">‚öôÔ∏è Stage 3: After TA-akamai Field Extraction</h4>
            <p style="font-size:0.8125rem;color:var(--gray-600);margin-bottom:12px;">The Splunk Add-on for Akamai automatically extracts JSON into searchable fields:</p>
            <div class="code-block">
              <div class="code-header"><span class="code-title">Extracted Fields (Automatic)</span></div>
              <div class="code-body">
                <pre style="font-size:0.75rem;"><code>index=akamai sourcetype=akamai:siem earliest=-5m | head 1 | table *

EXTRACTED FIELDS:
_time                    = 2025-01-30 10:15:30
attackData.clientIP      = 203.0.113.42
attackData.configId      = 12345
attackData.rules{}.ruleId      = 950001
attackData.rules{}.ruleTag     = SQLI
attackData.rules{}.ruleAction  = deny
attackData.rules{}.ruleMessage = SQL Injection Attack Detected
httpMessage.method       = POST
httpMessage.host         = api.myfirstpro.com
httpMessage.path         = /api/v1/login
httpMessage.status       = 403
httpMessage.bytes        = 1234
geo.country              = RU
geo.city                 = Moscow</code></pre>
              </div>
            </div>
          </div>

          <!-- STAGE 4: CIM Mapped -->
          <div class="card" style="padding:20px;margin-bottom:16px;border-left:4px solid var(--success-500);">
            <h4 style="color:var(--success-700);margin-bottom:12px;">‚úÖ Stage 4: CIM-Mapped Fields (Detection Ready)</h4>
            <p style="font-size:0.8125rem;color:var(--gray-600);margin-bottom:12px;">The TA also creates CIM-compliant field aliases for the Web data model:</p>
            <div class="code-block">
              <div class="code-header"><span class="code-title">CIM Fields (Ready for Detections)</span></div>
              <div class="code-body">
                <pre style="font-size:0.75rem;"><code>index=akamai sourcetype=akamai:siem earliest=-5m | head 1 
| table _time src_ip dest http_method uri_path status action signature src_country

CIM FIELDS:
_time        = 2025-01-30 10:15:30
src_ip       = 203.0.113.42          ‚Üê attackData.clientIP
dest         = api.myfirstpro.com    ‚Üê httpMessage.host
http_method  = POST                   ‚Üê httpMessage.method
uri_path     = /api/v1/login         ‚Üê httpMessage.path
status       = 403                    ‚Üê httpMessage.status
action       = blocked                ‚Üê mapped from ruleAction="deny"
signature    = SQLI                   ‚Üê attackData.rules{}.ruleTag
src_country  = RU                     ‚Üê geo.country</code></pre>
              </div>
            </div>
          </div>

          <!-- Visual Summary -->
          <div class="card" style="padding:24px;background:var(--gray-50);margin-bottom:24px;">
            <h4 style="margin-bottom:16px;">üîÑ Field Transformation Summary</h4>
            <div class="table-container">
              <table style="font-size:0.8125rem;">
                <thead><tr><th>Stage</th><th>Source Field</th><th>‚Üí</th><th>Splunk Field</th><th>‚Üí</th><th>CIM Field</th></tr></thead>
                <tbody>
                  <tr><td>IP</td><td><code>attackData.clientIP</code></td><td>‚Üí</td><td><code>attackData.clientIP</code></td><td>‚Üí</td><td><code>src_ip</code></td></tr>
                  <tr><td>Host</td><td><code>httpMessage.host</code></td><td>‚Üí</td><td><code>httpMessage.host</code></td><td>‚Üí</td><td><code>dest</code></td></tr>
                  <tr><td>Path</td><td><code>httpMessage.path</code></td><td>‚Üí</td><td><code>httpMessage.path</code></td><td>‚Üí</td><td><code>uri_path</code></td></tr>
                  <tr><td>Method</td><td><code>httpMessage.method</code></td><td>‚Üí</td><td><code>httpMessage.method</code></td><td>‚Üí</td><td><code>http_method</code></td></tr>
                  <tr><td>Action</td><td><code>rules[].ruleAction</code></td><td>‚Üí</td><td><code>attackData.rules{}.ruleAction</code></td><td>‚Üí</td><td><code>action</code> (blocked/allowed)</td></tr>
                  <tr><td>Attack Type</td><td><code>rules[].ruleTag</code></td><td>‚Üí</td><td><code>attackData.rules{}.ruleTag</code></td><td>‚Üí</td><td><code>signature</code></td></tr>
                  <tr><td>Country</td><td><code>geo.country</code></td><td>‚Üí</td><td><code>geo.country</code></td><td>‚Üí</td><td><code>src_country</code></td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Sample Detection Using CIM -->
          <div class="card bordered-left success" style="padding:20px;">
            <h4 style="color:var(--success-700);margin-bottom:12px;">üéØ Now You Can Write Detections!</h4>
            <p style="font-size:0.8125rem;color:var(--gray-600);margin-bottom:12px;">With CIM fields, detection queries are clean and readable:</p>
            <div class="code-block">
              <div class="code-header"><span class="code-title">Detection: SQLi Attack from High-Risk Country</span></div>
              <div class="code-body">
                <pre style="font-size:0.75rem;"><code>index=akamai sourcetype=akamai:siem earliest=-15m
| where action="blocked" AND signature="SQLI"
| lookup country_risk.csv country AS src_country OUTPUT risk_level
| where risk_level="high"
| stats count as attacks dc(uri_path) as endpoints BY src_ip src_country
| where attacks > 5
| eval severity = if(attacks > 20, "CRITICAL", "HIGH")
| table _time src_ip src_country attacks endpoints severity</code></pre>
              </div>
            </div>
          </div>
        </div>

        <!-- Log Schema -->
        <div class="section">
          <h2 class="subsection-title">Akamai SIEM Log Schema</h2>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Field Path</th>
                  <th>Type</th>
                  <th>Description</th>
                  <th>CIM Mapping</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="highlight"><code>attackData.clientIP</code></td>
                  <td>string</td>
                  <td>Client/attacker IP address</td>
                  <td><code>src</code></td>
                </tr>
                <tr>
                  <td class="highlight"><code>attackData.rules{}.ruleId</code></td>
                  <td>string</td>
                  <td>WAF rule that triggered</td>
                  <td><code>signature_id</code></td>
                </tr>
                <tr>
                  <td class="highlight"><code>attackData.rules{}.ruleAction</code></td>
                  <td>string</td>
                  <td>Action taken (deny, alert, etc.)</td>
                  <td><code>action</code></td>
                </tr>
                <tr>
                  <td class="highlight"><code>attackData.rules{}.ruleTag</code></td>
                  <td>string</td>
                  <td>Attack category (SQLI, XSS, etc.)</td>
                  <td><code>category</code></td>
                </tr>
                <tr>
                  <td class="highlight"><code>httpMessage.requestHeaders.Host</code></td>
                  <td>string</td>
                  <td>Target hostname</td>
                  <td><code>dest</code></td>
                </tr>
                <tr>
                  <td class="highlight"><code>httpMessage.path</code></td>
                  <td>string</td>
                  <td>URI path requested</td>
                  <td><code>uri_path</code></td>
                </tr>
                <tr>
                  <td class="highlight"><code>httpMessage.method</code></td>
                  <td>string</td>
                  <td>HTTP method (GET, POST, etc.)</td>
                  <td><code>http_method</code></td>
                </tr>
                <tr>
                  <td class="highlight"><code>httpMessage.status</code></td>
                  <td>integer</td>
                  <td>HTTP response status code</td>
                  <td><code>status</code></td>
                </tr>
                <tr>
                  <td><code>geo.country</code></td>
                  <td>string</td>
                  <td>Client country code</td>
                  <td><code>src_country</code></td>
                </tr>
                <tr>
                  <td><code>geo.city</code></td>
                  <td>string</td>
                  <td>Client city</td>
                  <td><code>src_city</code></td>
                </tr>
                <tr>
                  <td><code>httpMessage.requestHeaders.User-Agent</code></td>
                  <td>string</td>
                  <td>User agent string</td>
                  <td><code>http_user_agent</code></td>
                </tr>
                <tr>
                  <td><code>attackData.clientReputation</code></td>
                  <td>string</td>
                  <td>Client reputation score</td>
                  <td>-</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Action Values -->
        <div class="section">
          <h2 class="subsection-title">ruleAction Values</h2>
          <div class="grid grid-3">
            <div class="card bordered-left error">
              <h4><code>deny</code></h4>
              <p style="font-size:0.8125rem;color:var(--gray-600);">Request blocked by WAF rule. Primary indicator for attack detection.</p>
            </div>
            <div class="card bordered-left warning">
              <h4><code>alert</code></h4>
              <p style="font-size:0.8125rem;color:var(--gray-600);">Request logged but allowed. Monitor-only mode.</p>
            </div>
            <div class="card bordered-left info">
              <h4><code>allow</code></h4>
              <p style="font-size:0.8125rem;color:var(--gray-600);">Request allowed. Typically from allowlisted sources.</p>
            </div>
          </div>
        </div>

        <!-- Common ruleTag Values -->
        <div class="section">
          <h2 class="subsection-title">Common ruleTag Values (Attack Categories)</h2>
          <div class="table-container">
            <table>
              <thead>
                <tr><th>ruleTag</th><th>Attack Type</th><th>MITRE ATT&CK</th></tr>
              </thead>
              <tbody>
                <tr><td class="highlight"><code>SQLI</code></td><td>SQL Injection</td><td>T1190</td></tr>
                <tr><td class="highlight"><code>XSS</code></td><td>Cross-Site Scripting</td><td>T1059.007</td></tr>
                <tr><td class="highlight"><code>CMD</code></td><td>Command Injection</td><td>T1059</td></tr>
                <tr><td class="highlight"><code>LFI</code></td><td>Local File Inclusion</td><td>T1190</td></tr>
                <tr><td class="highlight"><code>RFI</code></td><td>Remote File Inclusion</td><td>T1190</td></tr>
                <tr><td><code>PROTOCOL</code></td><td>Protocol Violation</td><td>T1190</td></tr>
                <tr><td><code>POLICY</code></td><td>Policy Violation</td><td>T1190</td></tr>
                <tr><td><code>BOT</code></td><td>Bot Detection</td><td>T1595</td></tr>
                <tr><td><code>RATE</code></td><td>Rate Limit Exceeded</td><td>T1498</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- props.conf -->
        <div class="section">
          <h2 class="subsection-title">props.conf Configuration</h2>
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">myfirstpro_akamai_configs/default/props.conf</span>
              <span class="code-lang">INI</span>
            </div>
            <div class="code-body">
              <pre><code>[akamai:siem]
# Timestamp - Akamai uses epoch milliseconds
TIME_FORMAT = %s%3N
TIME_PREFIX = \"httpMessage\":\{\"start\":\"
MAX_TIMESTAMP_LOOKAHEAD = 20
TZ = UTC

# JSON parsing
KV_MODE = json
TRUNCATE = 0
SHOULD_LINEMERGE = false

# CIM Field Aliases
FIELDALIAS-src = attackData.clientIP AS src
FIELDALIAS-dest = httpMessage.requestHeaders.Host AS dest
FIELDALIAS-uri_path = httpMessage.path AS uri_path
FIELDALIAS-http_method = httpMessage.method AS http_method
FIELDALIAS-status = httpMessage.status AS status
FIELDALIAS-src_country = geo.country AS src_country
FIELDALIAS-src_city = geo.city AS src_city

# Calculated Fields
EVAL-vendor = "Akamai"
EVAL-product = "Kona Site Defender"
EVAL-action = case(
    'attackData.rules{}.ruleAction'=="deny", "blocked",
    'attackData.rules{}.ruleAction'=="alert", "allowed",
    1=1, lower('attackData.rules{}.ruleAction')
)
EVAL-signature_id = mvindex('attackData.rules{}.ruleId', 0)
EVAL-signature = mvindex('attackData.rules{}.ruleMessage', 0)
EVAL-category = mvindex('attackData.rules{}.ruleTag', 0)</code></pre>
            </div>
          </div>
        </div>

        <!-- Sample Queries -->
        <div class="section">
          <h2 class="subsection-title">Essential SPL Queries</h2>

          <div class="code-block">
            <div class="code-header">
              <span class="code-title">Check Data Presence</span>
            </div>
            <div class="code-body">
              <pre><code>index=akamai sourcetype=akamai:siem earliest=-1h
| stats count as total_events
        dc(attackData.clientIP) as unique_sources
        dc(httpMessage.requestHeaders.Host) as unique_hosts
        latest(_time) as last_event
| eval last_event = strftime(last_event, "%Y-%m-%d %H:%M:%S")</code></pre>
            </div>
          </div>

          <div class="code-block">
            <div class="code-header">
              <span class="code-title">Top Blocked IPs</span>
            </div>
            <div class="code-body">
              <pre><code>index=akamai sourcetype=akamai:siem earliest=-24h
| spath path=attackData.rules{}.ruleAction output=action
| where action="deny"
| stats count as blocks 
        dc(httpMessage.path) as unique_paths
        values(attackData.rules{}.ruleTag) as attack_types
        BY attackData.clientIP geo.country
| sort - blocks
| head 20</code></pre>
            </div>
          </div>

          <div class="code-block">
            <div class="code-header">
              <span class="code-title">Attack Category Breakdown</span>
            </div>
            <div class="code-body">
              <pre><code>index=akamai sourcetype=akamai:siem earliest=-7d
| spath path=attackData.rules{}.ruleAction output=action
| where action="deny"
| spath path=attackData.rules{}.ruleTag output=category
| stats count as attacks dc(attackData.clientIP) as unique_attackers BY category
| sort - attacks</code></pre>
            </div>
          </div>

          <div class="code-block">
            <div class="code-header">
              <span class="code-title">WAF-UC1: Block Volume Anomaly Detection</span>
            </div>
            <div class="code-body">
              <pre><code>index=akamai sourcetype=akamai:siem earliest=-10m
| spath path=attackData.rules{}.ruleAction output=action
| where action="deny"
| bin _time span=5m
| stats count as block_count 
        dc(attackData.clientIP) as unique_ips 
        values(httpMessage.requestHeaders.Host) as hosts
        BY _time
| eventstats avg(block_count) as baseline stdev(block_count) as stdev
| eval threshold = baseline + (2 * stdev)
| eval threshold = if(threshold < 50, 50, threshold)
| where block_count > threshold
| eval deviation = round((block_count - baseline) / stdev, 2)
| eval severity = case(
    deviation >= 5, "CRITICAL",
    deviation >= 3, "HIGH",
    1=1, "MEDIUM"
)
| table _time block_count baseline threshold deviation unique_ips hosts severity</code></pre>
            </div>
          </div>
        </div>

        <!-- Akamai SIEM Integration Steps -->
        <div class="section">
          <h2 class="subsection-title">Akamai SIEM Integration Steps</h2>
          <div class="timeline">
            <div class="timeline-item">
              <div class="timeline-content">
                <h4 class="timeline-title">Step 1: Install TA-akamai in Splunk</h4>
                <p class="timeline-body">Apps ‚Üí Find More Apps ‚Üí Search "Akamai" ‚Üí Install "Splunk Add-on for Akamai SIEM"</p>
              </div>
            </div>
            <div class="timeline-item">
              <div class="timeline-content">
                <h4 class="timeline-title">Step 2: Configure Akamai API Credentials</h4>
                <p class="timeline-body">In Akamai Control Center: Identity & Access ‚Üí API Users ‚Üí Create API Client with SIEM scope</p>
              </div>
            </div>
            <div class="timeline-item">
              <div class="timeline-content">
                <h4 class="timeline-title">Step 3: Add Credentials to Splunk</h4>
                <p class="timeline-body">TA-akamai ‚Üí Configuration ‚Üí Add Account ‚Üí Enter Client ID, Client Secret, Access Token, Host</p>
              </div>
            </div>
            <div class="timeline-item">
              <div class="timeline-content">
                <h4 class="timeline-title">Step 4: Create SIEM Input</h4>
                <p class="timeline-body">TA-akamai ‚Üí Inputs ‚Üí Create New ‚Üí Select config, set index=akamai, interval=60</p>
              </div>
            </div>
            <div class="timeline-item">
              <div class="timeline-content">
                <h4 class="timeline-title">Step 5: Validate Data</h4>
                <p class="timeline-body">Run: <code>index=akamai sourcetype=akamai:siem | head 10</code></p>
              </div>
            </div>
          </div>
        </div>

      
        <!-- EDGE CASES & DECISIONS -->
        <div class="section" style="margin-top:48px;border-top:2px solid var(--gray-200);padding-top:32px;">
          <h2 class="subsection-title" style="color:var(--warning-600);">‚ö†Ô∏è Edge Cases & Decisions</h2>
          
          <h3 style="font-size:1rem;margin-bottom:12px;">Which WAF Logs Have Security Value?</h3>
          <div class="table-container">
            <table>
              <thead><tr><th>Log Type</th><th>Security Value</th><th>Volume</th><th>Ingest?</th></tr></thead>
              <tbody>
                <tr><td class="highlight">Blocked requests (deny)</td><td><span class="badge critical">HIGH</span></td><td>Low-Med</td><td><span class="badge success">‚úì Always</span></td></tr>
                <tr><td class="highlight">Alert-only (monitor mode)</td><td><span class="badge error">HIGH</span></td><td>Medium</td><td><span class="badge success">‚úì Yes</span></td></tr>
                <tr><td class="highlight">Rate limited</td><td><span class="badge error">HIGH</span></td><td>Low</td><td><span class="badge success">‚úì Yes - DDoS</span></td></tr>
                <tr><td class="highlight">Bot detected</td><td><span class="badge warning">MEDIUM</span></td><td>Medium</td><td><span class="badge success">‚úì Yes</span></td></tr>
                <tr><td class="highlight">All allowed requests</td><td><span class="badge info">LOW</span></td><td>Very High</td><td><span class="badge warning">‚ö† Only for baseline</span></td></tr>
                <tr><td class="highlight">Health checks</td><td>NONE</td><td>High</td><td><span class="badge error">‚úó Filter out</span></td></tr>
                <tr><td class="highlight">Static assets (css/js)</td><td><span class="badge info">LOW</span></td><td>Very High</td><td><span class="badge error">‚úó Filter out</span></td></tr>
              </tbody>
            </table>
          </div>

          <h3 style="font-size:1rem;margin:24px 0 12px;">WAF-Specific Edge Cases</h3>
          <div class="table-container">
            <table>
              <thead><tr><th>Scenario</th><th>Challenge</th><th>How to Handle</th></tr></thead>
              <tbody>
                <tr><td class="highlight">WAF in Monitor-only mode</td><td>Attacks logged but not blocked</td><td>Ask about blocking policy, adjust alert severity</td></tr>
                <tr><td class="highlight">Traffic spike (Black Friday)</td><td>Legitimate high volume</td><td>Scheduled threshold increase, event calendar</td></tr>
                <tr><td class="highlight">Legitimate bots (Google)</td><td>Triggers bot detection</td><td>Bot whitelist by user-agent or IP</td></tr>
                <tr><td class="highlight">API vs Web traffic</td><td>Very different patterns</td><td>Separate baselines by endpoint type</td></tr>
                <tr><td class="highlight">CDN caching</td><td>Not all requests reach WAF</td><td>Understand what's logged vs cached</td></tr>
                <tr><td class="highlight">Multiple WAF vendors</td><td>Akamai + Cloudflare</td><td>Correlate across sources, understand topology</td></tr>
                <tr><td class="highlight">Rule ID changes after upgrade</td><td>Detections break</td><td>Use rule categories, not specific IDs</td></tr>
              </tbody>
            </table>
          </div>

          <div class="callout info" style="margin-top:16px;">
            <div class="callout-content">
              <div class="callout-title">Volume Estimation</div>
              <div class="callout-body">
                Before full onboarding, estimate volume:<br>
                <code>index=akamai earliest=-1h | eval gb=len(_raw)/1024/1024/1024 | stats sum(gb) as hourly_gb | eval daily_gb=hourly_gb*24</code>
              </div>
            </div>
          </div>
        </div>

      
        <!-- SITE FOOTER -->
        <footer style="margin-top:48px;padding:24px;background:var(--gray-100);border-radius:8px;text-align:center;font-size:0.85rem;color:var(--gray-600);">
          <div style="margin-bottom:8px;">
            <strong>Splunk Detection Engineering Reference</strong> | Version 2.0 | Last Updated: February 2, 2026
          </div>
          <div>
            Internal Use Only | Detection Engineering Team
          </div>
        </footer>

      </div>
    </main>
  </div>
  <script src="../js/app.js"></script>
  <script>mermaid.initialize({startOnLoad:true, theme:'neutral'});</script>
</body>
</html>
