<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Decision Trees & Workflows | myfirstpro Detection Engineering</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <style>
    .tree-tabs{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:24px;border-bottom:2px solid var(--gray-200);padding-bottom:16px;}
    .tree-tab{padding:10px 16px;border-radius:6px 6px 0 0;cursor:pointer;font-size:0.8125rem;font-weight:500;background:var(--gray-100);color:var(--gray-600);border:1px solid var(--gray-200);border-bottom:none;transition:all 0.2s;}
    .tree-tab:hover{background:var(--gray-200);}
    .tree-tab.active{background:var(--primary-500);color:white;border-color:var(--primary-500);}
    .tree-content{display:none;}
    .tree-content.active{display:block;}
    .tree-container{background:white;border-radius:12px;padding:32px;min-height:500px;border:1px solid var(--gray-200);overflow-x:auto;}
    .tree-header{margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid var(--gray-100);}
    .tree-header h3{font-size:1.25rem;color:var(--gray-900);margin-bottom:8px;}
    .tree-header p{font-size:0.875rem;color:var(--gray-600);line-height:1.6;}
    .diagram-box{min-height:400px;display:flex;justify-content:center;align-items:flex-start;padding:20px 0;}
    .quick-ref{margin-top:24px;padding:16px;background:var(--primary-50);border-radius:8px;border-left:4px solid var(--primary-500);}
    .quick-ref h4{font-size:0.875rem;color:var(--primary-700);margin-bottom:8px;}
    .quick-ref ul{font-size:0.8125rem;color:var(--gray-600);margin:0;padding-left:20px;line-height:1.8;}
    .legend-box{margin-top:24px;padding:16px;background:var(--gray-50);border-radius:8px;}
    .legend-box h4{font-size:0.875rem;color:var(--gray-700);margin-bottom:12px;}
    .legend-items{display:flex;flex-wrap:wrap;gap:16px;}
    .legend-item{display:flex;align-items:center;gap:8px;font-size:0.8125rem;}
    .legend-color{width:16px;height:16px;border-radius:4px;}
  </style>
</head>
<body>
  <div class="app-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <a href="../index.html" style="display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit;">
            <div class="sidebar-logo-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            </div>
            <div class="sidebar-logo-text">
              <h1>myfirstpro</h1>
              <span>Detection Engineering</span>
            </div>
          </a>
        </div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Getting Started</div>
          <a href="../index.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg><span>Command Center</span></a>
          <a href="day1.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/></svg><span>Day 1 Checklist</span></a>
          <a href="client-comm.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg><span>Client Communication</span></a>
          <a href="professional-excellence.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg><span>Professional Excellence</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Splunk Fundamentals</div>
          <a href="splunk-fundamentals.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg><span>Splunk 101</span></a>
          <a href="splunk-es.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><span>Enterprise Security</span></a>
          <a href="data-flow.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg><span>Data Flow & Event Hub</span></a>
          <a href="detection-lifecycle.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/></svg><span>Detection Lifecycle</span></a>
          <a href="splunk-howto.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg><span>Splunk How-To Guide</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Data Sources</div>
          <a href="vendor-akamai.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><span>Akamai WAF</span></a>
          <a href="vendor-cyberark.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg><span>CyberArk Identity</span></a>
          <a href="vendor-entra.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg><span>Entra ID</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Splunk Operations</div>
          <a href="waf-onboarding.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg><span>Log Onboarding</span></a>
          <a href="parsing-cim.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg><span>Parsing & CIM</span></a>
          <a href="lookups.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg><span>Lookups Deep Dive</span></a>
          <a href="splunk-ops.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg><span>Splunk Cloud Ops</span></a>
          <a href="spl-reference.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg><span>SPL Reference</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">WAF/DDoS Project</div>
          <a href="waf-overview.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span>Project Overview</span></a>
          <a href="waf-usecases.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>Use Cases UC1-12</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">MFA Project</div>
          <a href="mfa-overview.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span>Project Overview</span></a>
          <a href="mfa-usecases.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>Use Cases UC1-8</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Response & Support</div>
          <a href="decision-trees.html" class="nav-item active"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="5" r="3"/><line x1="12" y1="8" x2="12" y2="14"/><circle cx="6" cy="19" r="3"/><circle cx="18" cy="19" r="3"/></svg><span>Decision Trees</span></a>
          <a href="troubleshooting.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><span>Troubleshooting</span></a>
          <a href="runbooks.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>SOC Runbooks</span></a>
        </div>
      </nav>
      <div class="sidebar-footer"><p>Detection Engineering v2.0</p></div>
    </aside>

    <main class="main-content">
      <header class="header">
        <div class="header-left">
          <button class="menu-toggle" aria-label="Toggle menu">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
          </button>
          <div class="breadcrumb">
            <a href="../index.html" class="breadcrumb-item">Home</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-item current">Decision Trees</span>
          </div>
        </div>
        <span class="badge primary">11 Visual Guides</span>
      </header>

      <div class="page-content">
        <div class="section">
          <h1 class="section-title">Decision Trees & Workflows</h1>
          <p class="section-subtitle">Visual guides for detection engineering decisions, triage processes, and operational workflows.</p>
        </div>

        <div class="section">
          <div class="tree-tabs">
            <div class="tree-tab active" onclick="showTree('dev')">Detection Dev</div>
            <div class="tree-tab" onclick="showTree('triage')">Alert Triage</div>
            <div class="tree-tab" onclick="showTree('validation')">Data Validation</div>
            <div class="tree-tab" onclick="showTree('incident')">Incident Response</div>
            <div class="tree-tab" onclick="showTree('notable')">Notable Lifecycle</div>
            <div class="tree-tab" onclick="showTree('tuning')">Tuning Process</div>
            <div class="tree-tab" onclick="showTree('escalation')">Escalation</div>
            <div class="tree-tab" onclick="showTree('pattern')">Pattern Selection</div>
            <div class="tree-tab" onclick="showTree('architecture')">Architecture</div>
            <div class="tree-tab" onclick="showTree('waf')">WAF Response</div>
            <div class="tree-tab" onclick="showTree('mfa')">MFA Response</div>
          </div>

          <!-- DETECTION DEVELOPMENT -->
          <div id="dev" class="tree-content active">
            <div class="tree-container">
              <div class="tree-header">
                <h3>Detection Development Lifecycle</h3>
                <p>Complete workflow from use case request to production deployment.</p>
              </div>
              <div class="diagram-box">
                <pre class="mermaid">
flowchart TD
    A[Receive Request] --> B{Clear Reqs?}
    B -->|No| C[Clarify]
    C --> B
    B -->|Yes| D[Document Spec]
    D --> E[ID Data Sources]
    E --> F{Data Available?}
    F -->|No| G[Request Onboard]
    G --> F
    F -->|Yes| H[Validate Fields]
    H --> I{Fields OK?}
    I -->|No| J[Fix Parsing]
    J --> H
    I -->|Yes| K[Build SPL]
    K --> L[Test Query]
    L --> M{Results OK?}
    M -->|No| N[Refine Logic]
    N --> L
    M -->|Yes| O[Add Thresholds]
    O --> P[Run 7-Day Test]
    P --> Q{FP Rate OK?}
    Q -->|No| R[Tune]
    R --> P
    Q -->|Yes| S[Create Correlation]
    S --> T[Configure Notable]
    T --> U[Enable Production]
    U --> V[Monitor 48h]
    V --> W{Working?}
    W -->|No| X[Hotfix]
    X --> V
    W -->|Yes| Y[COMPLETE]
    style A fill:#e0f2fe
    style Y fill:#dcfce7
                </pre>
              </div>
              <div class="quick-ref">
                <h4>Key Points</h4>
                <ul>
                  <li>Never start without documented requirements</li>
                  <li>Validate data before development</li>
                  <li>Target less than 10 FPs per day before deployment</li>
                  <li>48-hour monitoring period is mandatory</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- ALERT TRIAGE -->
          <div id="triage" class="tree-content">
            <div class="tree-container">
              <div class="tree-header">
                <h3>Alert Triage Workflow</h3>
                <p>SOC analyst process for triaging incoming alerts.</p>
              </div>
              <div class="diagram-box">
                <pre class="mermaid">
flowchart TD
    A[New Alert] --> B[Open Incident Review]
    B --> C[Review Details]
    C --> D{Duplicate?}
    D -->|Yes| E[Link Existing]
    E --> F[Close Dup]
    D -->|No| G{Context OK?}
    G -->|No| H[Run Drilldowns]
    H --> G
    G -->|Yes| I{True Positive?}
    I -->|FP| J[Document Reason]
    J --> K{Recurring?}
    K -->|Yes| L[Create Tuning Ticket]
    K -->|No| M[Close as FP]
    I -->|Investigate| N[Escalate Tier 2]
    I -->|TP| O{Severity?}
    O -->|Low/Med| P[Create Ticket]
    P --> Q[Follow Runbook]
    Q --> R[Document Close]
    O -->|High/Crit| S[IMMEDIATE ESCALATION]
    S --> T[Page On-Call]
    T --> U[Incident Response]
    style A fill:#fef3c7
    style S fill:#fee2e2
    style F fill:#dcfce7
    style M fill:#dcfce7
    style R fill:#dcfce7
                </pre>
              </div>
              <div class="legend-box">
                <h4>Disposition Codes</h4>
                <div class="legend-items">
                  <div class="legend-item"><div class="legend-color" style="background:#dc2626;"></div>True Positive Confirmed</div>
                  <div class="legend-item"><div class="legend-color" style="background:#f97316;"></div>True Positive Benign</div>
                  <div class="legend-item"><div class="legend-color" style="background:#eab308;"></div>False Positive Tuning</div>
                  <div class="legend-item"><div class="legend-color" style="background:#22c55e;"></div>False Positive Expected</div>
                </div>
              </div>
            </div>
          </div>

          <!-- DATA VALIDATION -->
          <div id="validation" class="tree-content">
            <div class="tree-container">
              <div class="tree-header">
                <h3>Data Validation Workflow</h3>
                <p>Verify data quality before building detections.</p>
              </div>
              <div class="diagram-box">
                <pre class="mermaid">
flowchart TD
    A[Start Validation] --> B[Run Health Check]
    B --> C{Events in 60m?}
    C -->|No| D[DATA NOT FLOWING]
    D --> E[Check HEC]
    E --> F[Check Source]
    F --> G{Resolved?}
    G -->|No| H[Escalate Admin]
    G -->|Yes| B
    C -->|Yes| I{Volume Normal?}
    I -->|Low| J[Possible Data Loss]
    J --> K[Compare to Source]
    I -->|OK| L[Check Fields]
    L --> M{Fields Present?}
    M -->|No| N[PARSING ISSUE]
    N --> O[Fix props.conf]
    M -->|Yes| P{Values Valid?}
    P -->|No| Q[Mapping Issue]
    Q --> R[Create Ticket]
    P -->|Yes| S[Check Timestamps]
    S --> T{Time Accurate?}
    T -->|No| U[Timezone Issue]
    T -->|Yes| V[VALIDATED]
    V --> W[Document Results]
    style D fill:#fee2e2
    style N fill:#fee2e2
    style J fill:#fef3c7
    style Q fill:#fef3c7
    style U fill:#fef3c7
    style V fill:#dcfce7
                </pre>
              </div>
              <div class="quick-ref">
                <h4>Validation Checklist</h4>
                <ul>
                  <li>Events flowing within last 60 minutes</li>
                  <li>Event count matches expected volume</li>
                  <li>All required fields extracted</li>
                  <li>Field values match expected format</li>
                  <li>Timestamps accurate within 5 minutes</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- INCIDENT RESPONSE -->
          <div id="incident" class="tree-content">
            <div class="tree-container">
              <div class="tree-header">
                <h3>Incident Response Decision Tree</h3>
                <p>High-level IR workflow for security incidents.</p>
              </div>
              <div class="diagram-box">
                <pre class="mermaid">
flowchart TD
    A[Incident Detected] --> B{Type?}
    B -->|Account| C[Disable Account]
    C --> C1[Reset Creds]
    C1 --> C2[Review Activity]
    C2 --> C3[Check Persistence]
    B -->|Malware| D[Isolate System]
    D --> D1[Preserve Evidence]
    D1 --> D2[ID Malware]
    D2 --> D3[Determine Scope]
    B -->|Data Exfil| E[ID Data Accessed]
    E --> E1{PII/PHI?}
    E1 -->|Yes| E2[Legal Notification]
    E1 -->|No| E3[Internal Investigation]
    B -->|Active Attack| F[BLOCK ATTACKER]
    F --> F1[Preserve Artifacts]
    F1 --> F2[Page IR Lead]
    F2 --> F3[War Room]
    C3 --> G[Document]
    D3 --> G
    E2 --> G
    E3 --> G
    F3 --> G
    G --> H[Post-Mortem]
    H --> I[Update Detections]
    I --> J[Close Incident]
    style A fill:#fee2e2
    style F fill:#fee2e2
    style J fill:#dcfce7
                </pre>
              </div>
            </div>
          </div>

          <!-- NOTABLE LIFECYCLE -->
          <div id="notable" class="tree-content">
            <div class="tree-container">
              <div class="tree-header">
                <h3>Notable Event Lifecycle</h3>
                <p>Complete lifecycle in Splunk Enterprise Security.</p>
              </div>
              <div class="diagram-box">
                <pre class="mermaid">
flowchart LR
    subgraph Creation
        A1[Search Runs] --> A2[Threshold Met]
        A2 --> A3[Notable Created]
        A3 --> A4[Status NEW]
    end
    subgraph Assignment
        A4 --> B1[Incident Review]
        B1 --> B2[Analyst Claims]
        B2 --> B3[Status IN PROGRESS]
    end
    subgraph Investigation
        B3 --> C1[Run Drilldowns]
        C1 --> C2[Gather Context]
        C2 --> C3[Make Decision]
    end
    subgraph Resolution
        C3 --> D1{Disposition}
        D1 -->|TP| D2[Remediate]
        D1 -->|FP| D3[Tune]
        D1 -->|Benign| D4[Document]
        D2 --> D5[Status RESOLVED]
        D3 --> D5
        D4 --> D5
    end
    subgraph Closure
        D5 --> E1[Add Comments]
        E1 --> E2[Status CLOSED]
    end
    style A4 fill:#fef3c7
    style B3 fill:#e0f2fe
    style D5 fill:#dbeafe
    style E2 fill:#dcfce7
                </pre>
              </div>
              <div class="legend-box">
                <h4>Status Flow</h4>
                <div class="legend-items">
                  <div class="legend-item"><div class="legend-color" style="background:#d97706;"></div>New</div>
                  <div class="legend-item"><div class="legend-color" style="background:#0284c7;"></div>In Progress</div>
                  <div class="legend-item"><div class="legend-color" style="background:#8b5cf6;"></div>Pending</div>
                  <div class="legend-item"><div class="legend-color" style="background:#3b82f6;"></div>Resolved</div>
                  <div class="legend-item"><div class="legend-color" style="background:#16a34a;"></div>Closed</div>
                </div>
              </div>
            </div>
          </div>

          <!-- TUNING -->
          <div id="tuning" class="tree-content">
            <div class="tree-container">
              <div class="tree-header">
                <h3>Detection Tuning Process</h3>
                <p>Systematic approach to tuning based on FP patterns.</p>
              </div>
              <div class="diagram-box">
                <pre class="mermaid">
flowchart TD
    A[FP Pattern Found] --> B{Single or Recurring?}
    B -->|Single| C[Document Exception]
    C --> D[Close as FP]
    B -->|Recurring| E[Analyze Pattern]
    E --> F{Root Cause?}
    F -->|Legit Activity| G[Add to Allowlist]
    G --> H[Create Lookup]
    F -->|Threshold Issue| I[Adjust Threshold]
    I --> J{Direction?}
    J -->|Fewer Alerts| K[Increase Value]
    J -->|More Coverage| L[Decrease Value]
    F -->|Missing Context| M[Add Filter]
    M --> N[Add WHERE Clause]
    F -->|Time Pattern| O[Add Time Filter]
    H --> P[Validate Tuning]
    K --> P
    L --> P
    N --> P
    O --> P
    P --> Q{FP Rate OK?}
    Q -->|No| R[Refine More]
    R --> E
    Q -->|Yes| S[Deploy]
    S --> T[Monitor 7 Days]
    T --> U{Success?}
    U -->|No| V[Rollback]
    V --> E
    U -->|Yes| W[Document Changes]
    style A fill:#fef3c7
    style W fill:#dcfce7
    style V fill:#fee2e2
                </pre>
              </div>
              <div class="quick-ref">
                <h4>Tuning Best Practices</h4>
                <ul>
                  <li>Document every tuning change with ticket</li>
                  <li>Test against 7 days of historical data</li>
                  <li>Monitor for 7 days post-tuning</li>
                  <li>Never tune away real attacks to eliminate FPs</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- ESCALATION -->
          <div id="escalation" class="tree-content">
            <div class="tree-container">
              <div class="tree-header">
                <h3>Escalation Decision Tree</h3>
                <p>When and how to escalate based on severity.</p>
              </div>
              <div class="diagram-box">
                <pre class="mermaid">
flowchart TD
    A[Incident Detected] --> B{Severity?}
    B -->|Info| C[Log and Monitor]
    C --> D[No Escalation]
    B -->|Low| E[Standard Ticket]
    E --> F[Tier 1 Handles]
    F --> G{Resolved in 4h?}
    G -->|Yes| H[Close]
    G -->|No| I[Escalate Tier 2]
    B -->|Medium| J[Priority Ticket]
    J --> K[Tier 2 Assigned]
    K --> L{Resolved in 2h?}
    L -->|Yes| M[Close]
    L -->|No| N[Escalate Tier 3]
    B -->|High| O[IMMEDIATE]
    O --> P[Page Tier 3]
    P --> Q[15min SLA]
    Q --> R{Active Threat?}
    R -->|Yes| S[Escalate IR Lead]
    R -->|No| T[Tier 3 Investigates]
    B -->|Critical| U[CRITICAL INCIDENT]
    U --> V[Page IR Lead NOW]
    V --> W[Page CISO 30min]
    W --> X[War Room]
    S --> Y[Containment]
    T --> Y
    X --> Y
    style U fill:#fee2e2
    style O fill:#fef3c7
    style D fill:#dcfce7
    style H fill:#dcfce7
    style M fill:#dcfce7
                </pre>
              </div>
              <div class="legend-box">
                <h4>Escalation Contacts</h4>
                <div class="legend-items">
                  <div class="legend-item"><div class="legend-color" style="background:#22c55e;"></div>Tier 1 SOC 24x7</div>
                  <div class="legend-item"><div class="legend-color" style="background:#3b82f6;"></div>Tier 2 Senior On-Call</div>
                  <div class="legend-item"><div class="legend-color" style="background:#8b5cf6;"></div>Tier 3 Engineers</div>
                  <div class="legend-item"><div class="legend-color" style="background:#dc2626;"></div>IR Lead</div>
                </div>
              </div>
            </div>
          </div>

          <!-- PATTERN -->
          <div id="pattern" class="tree-content">
            <div class="tree-container">
              <div class="tree-header">
                <h3>Detection Pattern Selection</h3>
                <p>Choose the right detection pattern for your use case.</p>
              </div>
              <div class="diagram-box">
                <pre class="mermaid">
flowchart TD
    A[New Use Case] --> B{Detecting What?}
    B -->|Volume Anomaly| C[Threshold Based]
    B -->|Specific Behavior| D[Sequence Based]
    B -->|Deviation| E[Baseline Based]
    B -->|Known Patterns| F[Signature Based]
    C --> G{Static or Dynamic?}
    G -->|Fixed| H[count GT X]
    G -->|Relative| I[count GT avg plus 2 stdev]
    D --> J{Complexity?}
    J -->|A then B| K[streamstats]
    J -->|Chain| L[transaction]
    J -->|Time Window| M[bin plus stats]
    E --> N{Baseline Type?}
    N -->|User| O[Per-user Lookup]
    N -->|System| P[Global Average]
    N -->|Time| Q[Hour/Day Pattern]
    F --> R{Source?}
    R -->|Vendor| S[Native Fields]
    R -->|Intel| T[Lookup Enrichment]
    R -->|Custom| U[Regex Match]
    style C fill:#cce5ff
    style D fill:#d4edda
    style E fill:#fff3cd
    style F fill:#e2e3e5
                </pre>
              </div>
              <div class="quick-ref">
                <h4>Pattern Selection Guide</h4>
                <ul>
                  <li><strong>Threshold:</strong> DDoS, brute force, scanning</li>
                  <li><strong>Sequence:</strong> Multi-stage attacks, kill chain</li>
                  <li><strong>Baseline:</strong> Insider threats, unusual behavior</li>
                  <li><strong>Signature:</strong> Known malware, exploits</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- ARCHITECTURE -->
          <div id="architecture" class="tree-content">
            <div class="tree-container">
              <div class="tree-header">
                <h3>Data Flow Architecture</h3>
                <p>End-to-end data flow from sources to response.</p>
              </div>
              <div class="diagram-box">
                <pre class="mermaid">
flowchart LR
    subgraph Sources
        S1[Akamai WAF]
        S2[CyberArk]
        S3[Entra ID]
    end
    subgraph Integration
        I1[SIEM API]
        I2[Connector]
        I3[Graph API]
    end
    subgraph Splunk
        HEC[HEC Endpoint]
        IDX[(Indexes)]
        SH[Search Head]
        DET[Correlation]
        NOT[Notables]
    end
    subgraph Response
        R1[Email]
        R2[Slack]
        R3[SOAR]
        R4[ServiceNow]
    end
    S1 --> I1 --> HEC
    S2 --> I2 --> HEC
    S3 --> I3 --> HEC
    HEC --> IDX --> SH --> DET --> NOT
    NOT --> R1
    NOT --> R2
    NOT --> R3
    NOT --> R4
    style HEC fill:#65a637
    style DET fill:#cce5ff
    style NOT fill:#fee2e2
                </pre>
              </div>
            </div>
          </div>

          <!-- WAF RESPONSE -->
          <div id="waf" class="tree-content">
            <div class="tree-container">
              <div class="tree-header">
                <h3>WAF Alert Response Workflow</h3>
                <p>Specific workflow for responding to WAF alerts.</p>
              </div>
              <div class="diagram-box">
                <pre class="mermaid">
flowchart TD
    A[WAF Alert] --> B{Type?}
    B -->|Volume| C[Check Trend]
    B -->|Single IP| D[Analyze IP]
    B -->|Injection| E[Review Payloads]
    B -->|Auth| F[Check Cred Stuffing]
    C --> G{Spike GT 5 sigma?}
    G -->|Yes| H[ACTIVE ATTACK]
    G -->|No| I[Monitor]
    D --> J[IP Reputation]
    J --> K{Known Bad?}
    K -->|Yes| L[Verify Blocking]
    K -->|No| M{Corporate NAT?}
    M -->|Yes| N[FP - NAT]
    M -->|No| O[New Threat]
    E --> P{Blocked?}
    P -->|Yes| Q[Check Bypass]
    P -->|No| R[CHECK BACKEND]
    R --> S{500 Errors?}
    S -->|Yes| T[Possible Compromise]
    S -->|No| U[WAF Effective]
    F --> V{Multi-user?}
    V -->|Yes| W[Campaign]
    V -->|No| X[Brute Force]
    W --> Y[Alert Identity Team]
    H --> Z[Escalate Tier 2]
    T --> Z
    L --> AA[Document Close]
    Q --> AA
    U --> AA
    N --> AA
    style A fill:#e0f2fe
    style H fill:#fee2e2
    style T fill:#fee2e2
    style AA fill:#dcfce7
                </pre>
              </div>
              <div class="quick-ref">
                <h4>WAF Quick Actions</h4>
                <ul>
                  <li><strong>Volume spike:</strong> Check if legitimate traffic</li>
                  <li><strong>Single IP:</strong> Verify blocking, geo-block if persistent</li>
                  <li><strong>Injection:</strong> Always check backend for 500 errors</li>
                  <li><strong>Auth attacks:</strong> Coordinate with identity team</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- MFA RESPONSE -->
          <div id="mfa" class="tree-content">
            <div class="tree-container">
              <div class="tree-header">
                <h3>MFA Alert Response Workflow</h3>
                <p>Specific workflow for MFA-related security alerts.</p>
              </div>
              <div class="diagram-box">
                <pre class="mermaid">
flowchart TD
    A[MFA Alert] --> B{Type?}
    B -->|Fatigue| C[Check Denial Count]
    B -->|Impossible Travel| D[Verify Locations]
    B -->|New Device| E[Check Registration]
    B -->|Dormant| F[Verify Account Status]
    C --> G{GT 5 Denials?}
    G -->|Yes| H{Then Success?}
    H -->|Yes| I[BREACH LIKELY]
    H -->|No| J[Attack Ongoing]
    G -->|No| K[Monitor]
    I --> L[CALL USER NOW]
    L --> M{Approved?}
    M -->|No| N[DISABLE ACCOUNT]
    M -->|Yes| O[Verify Activity]
    D --> P{Speed GT 800 kmh?}
    P -->|Yes| Q{VPN Exit?}
    Q -->|Yes| R[FP - VPN]
    Q -->|No| S[Credential Theft]
    P -->|No| T[Normal Travel]
    E --> U{User Requested?}
    U -->|Yes| V[Legitimate]
    U -->|No| W[Persistence Attempt]
    F --> X{Privileged?}
    X -->|Yes| Y[HIGH PRIORITY]
    X -->|No| Z[Standard Investigation]
    style A fill:#e0f2fe
    style I fill:#fee2e2
    style N fill:#fee2e2
    style S fill:#fee2e2
    style W fill:#fee2e2
    style R fill:#dcfce7
    style T fill:#dcfce7
    style V fill:#dcfce7
                </pre>
              </div>
              <div class="quick-ref">
                <h4>MFA Quick Actions</h4>
                <ul>
                  <li><strong>Fatigue + Success:</strong> CALL user immediately via phone</li>
                  <li><strong>Impossible Travel:</strong> Check VPN usage first</li>
                  <li><strong>New Device:</strong> Verify with user before closing</li>
                  <li><strong>Dormant Account:</strong> Prioritize privileged accounts</li>
                </ul>
              </div>
            </div>
          </div>

        </div>
      </div>
    </main>
  </div>
  
  <script src="../js/app.js"></script>
  <script>
    // Initialize mermaid
    mermaid.initialize({
      startOnLoad: false,
      theme: 'neutral',
      flowchart: {
        curve: 'basis',
        nodeSpacing: 30,
        rankSpacing: 30
      }
    });

    // Render initial diagram
    document.addEventListener('DOMContentLoaded', function() {
      renderDiagram('dev');
    });

    function renderDiagram(id) {
      const container = document.getElementById(id);
      const diagramBox = container.querySelector('.diagram-box');
      const mermaidEl = diagramBox.querySelector('.mermaid');
      
      if (mermaidEl && !mermaidEl.getAttribute('data-processed')) {
        mermaid.run({ nodes: [mermaidEl] });
      }
    }

    function showTree(id) {
      // Hide all
      document.querySelectorAll('.tree-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tree-tab').forEach(el => el.classList.remove('active'));
      
      // Show selected
      document.getElementById(id).classList.add('active');
      event.target.classList.add('active');
      
      // Render diagram
      setTimeout(() => renderDiagram(id), 50);
    }
  </script>
</body>
</html>
