<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detection Lifecycle | myfirstpro Detection Engineering</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <div class="app-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <a href="../index.html" style="display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit;">
            <div class="sidebar-logo-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            </div>
            <div class="sidebar-logo-text">
              <h1>myfirstpro</h1>
              <span>Detection Engineering</span>
            </div>
          </a>
        </div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Getting Started</div>
          <a href="../index.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg><span>Command Center</span></a>
          <a href="day1.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/></svg><span>Day 1 Checklist</span></a>
          <a href="client-comm.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg><span>Client Communication</span></a>
          <a href="professional-excellence.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg><span>Professional Excellence</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Splunk Fundamentals</div>
          <a href="splunk-fundamentals.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg><span>Splunk 101</span></a>
          <a href="splunk-es.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><span>Enterprise Security</span></a>
          <a href="data-flow.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg><span>Data Flow & Event Hub</span></a>
          <a href="detection-lifecycle.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/></svg><span>Detection Lifecycle</span></a>
          <a href="splunk-howto.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg><span>Splunk How-To Guide</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Data Sources</div>
          <a href="vendor-akamai.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><span>Akamai WAF</span></a>
          <a href="vendor-cyberark.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg><span>CyberArk Identity</span></a>
          <a href="vendor-entra.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg><span>Entra ID</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Splunk Operations</div>
          <a href="waf-onboarding.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg><span>Log Onboarding</span></a>
          <a href="parsing-cim.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg><span>Parsing & CIM</span></a>
          <a href="lookups.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg><span>Lookups Deep Dive</span></a>
          <a href="splunk-ops.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg><span>Splunk Cloud Ops</span></a>
          <a href="spl-reference.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg><span>SPL Reference</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">WAF/DDoS Project</div>
          <a href="waf-overview.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span>Project Overview</span></a>
          <a href="waf-usecases.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>Use Cases (UC1-12)</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">MFA Project</div>
          <a href="mfa-overview.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span>Project Overview</span></a>
          <a href="mfa-usecases.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>Use Cases (UC1-8)</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Response & Support</div>
          <a href="decision-trees.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="5" r="3"/><line x1="12" y1="8" x2="12" y2="14"/><circle cx="6" cy="19" r="3"/><circle cx="18" cy="19" r="3"/></svg><span>Decision Trees</span></a>
          <a href="troubleshooting.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><span>Troubleshooting</span></a>
          <a href="runbooks.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>SOC Runbooks</span></a>
        </div>
      </nav>
      <div class="sidebar-footer"><p>Detection Engineering v2.0</p></div>
    </aside>

    <main class="main-content">
      <header class="header">
        <div class="header-left">
          <button class="menu-toggle" aria-label="Toggle menu"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button>
          <div class="breadcrumb">
            <a href="../index.html" class="breadcrumb-item">Home</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-item current">Detection Lifecycle</span>
          </div>
        </div>
        <span class="badge critical">MUST KNOW</span>
      </header>

      <div class="page-content">
        <div class="section">
          <h1 class="section-title">Detection Deployment Lifecycle</h1>
          <p class="section-subtitle">Complete step-by-step guide: From writing SPL to production alerting — every click explained</p>
        </div>

        <div class="callout critical" style="margin-bottom:24px;">
          <div class="callout-content">
            <div class="callout-title">Why This Matters</div>
            <div class="callout-body">
              <strong>Never deploy a detection straight to production.</strong> Each phase validates the detection works correctly before the SOC sees it. Skipping phases = false positives = angry SOC = your credibility destroyed.
            </div>
          </div>
        </div>

        <!-- Overview Diagram -->
        <div class="section">
          <h2 class="subsection-title">The Four Phases</h2>
          <div class="card" style="padding:24px;background:var(--gray-50);overflow-x:auto;margin-bottom:24px;">
            <div class="mermaid">
flowchart LR
    subgraph P1["Phase 1: Development"]
        A[Write SPL] --> B[Test on<br/>historical data]
        B --> C[Save as<br/>Report]
    end
    subgraph P2["Phase 2: Silent Mode"]
        D[Schedule<br/>search] --> E[Output to<br/>lookup/index]
        E --> F[Monitor<br/>7 days]
    end
    subgraph P3["Phase 3: Limited"]
        G[Add alert<br/>action] --> H[CRITICAL<br/>only]
        H --> I[Security<br/>team only]
    end
    subgraph P4["Phase 4: Production"]
        J[All<br/>severities] --> K[SOC<br/>distribution]
        K --> L[Incident<br/>Review]
    end
    
    C --> D
    F --> G
    I --> J
    
    style A fill:#e3f2fd
    style F fill:#fff3e0
    style I fill:#fff8e1
    style L fill:#e8f5e9
            </div>
          </div>
        </div>

        <!-- ============================================================ -->
        <!-- PHASE 1: DEVELOPMENT -->
        <!-- ============================================================ -->
        <div class="section" style="margin-top:48px;border-top:3px solid #2196f3;padding-top:32px;">
          <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px;">
            <div style="width:48px;height:48px;background:#e3f2fd;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;color:#1976d2;">1</div>
            <div>
              <h2 style="font-size:1.5rem;margin:0;color:#1976d2;">Phase 1: Development</h2>
              <p style="margin:4px 0 0;color:var(--gray-600);">Write, test, and save your detection as a report</p>
            </div>
          </div>

          <!-- Step 1.1 -->
          <div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid #2196f3;">
            <h3 style="font-size:1.125rem;margin-bottom:16px;">Step 1.1: Open the Search Interface</h3>
            
            <div class="table-container">
              <table>
                <thead><tr><th style="width:40px;">#</th><th>Action</th><th>What You'll See</th></tr></thead>
                <tbody>
                  <tr>
                    <td class="highlight">1</td>
                    <td>Log into Splunk Cloud (URL will be like <code>https://sobeys.splunkcloud.com</code>)</td>
                    <td>Splunk home page with app tiles</td>
                  </tr>
                  <tr>
                    <td class="highlight">2</td>
                    <td>Click <strong>"Search & Reporting"</strong> app (or "Enterprise Security" if using ES)</td>
                    <td>Search bar at top, time picker on right</td>
                  </tr>
                  <tr>
                    <td class="highlight">3</td>
                    <td>Make sure time picker is set to a reasonable range (e.g., "Last 24 hours")</td>
                    <td>Dropdown shows selected time range</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Step 1.2 -->
          <div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid #2196f3;">
            <h3 style="font-size:1.125rem;margin-bottom:16px;">Step 1.2: Write and Test Your SPL</h3>
            
            <div class="code-block" style="margin-bottom:16px;">
              <div class="code-header"><span class="code-title">Example: WAF Block Volume Anomaly Detection</span></div>
              <div class="code-body">
                <pre><code>index=akamai action=deny earliest=-1h
| stats count as block_count by src_ip
| where block_count > 100
| eval severity = case(
    block_count > 500, "critical",
    block_count > 200, "high",
    block_count > 100, "medium"
)
| table _time src_ip block_count severity</code></pre>
              </div>
            </div>

            <div class="table-container">
              <table>
                <thead><tr><th style="width:40px;">#</th><th>Action</th><th>Why</th></tr></thead>
                <tbody>
                  <tr>
                    <td class="highlight">1</td>
                    <td>Paste your SPL into the search bar</td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">2</td>
                    <td>Click the green <strong>Search</strong> button (or press Enter)</td>
                    <td>Runs the search</td>
                  </tr>
                  <tr>
                    <td class="highlight">3</td>
                    <td>Look at the results — do they make sense?</td>
                    <td>Validate logic is correct</td>
                  </tr>
                  <tr>
                    <td class="highlight">4</td>
                    <td>Change time range to "Last 7 days" and run again</td>
                    <td>See how many results over a week (estimate alert volume)</td>
                  </tr>
                  <tr>
                    <td class="highlight">5</td>
                    <td>Adjust thresholds (e.g., change 100 to 200) and re-run until results look reasonable</td>
                    <td>Tune to reduce false positives</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="callout warning" style="margin-top:16px;">
              <div class="callout-content">
                <div class="callout-title">How Many Results is "Reasonable"?</div>
                <div class="callout-body">
                  For a scheduled detection running every 5 minutes:<br>
                  • <strong>0-5 results/day</strong> = Good for high-severity detection<br>
                  • <strong>5-20 results/day</strong> = Acceptable for medium severity<br>
                  • <strong>50+ results/day</strong> = Too noisy — tune thresholds higher
                </div>
              </div>
            </div>
          </div>

          <!-- Step 1.3 -->
          <div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid #2196f3;">
            <h3 style="font-size:1.125rem;margin-bottom:16px;">Step 1.3: Save as Report (NOT Alert Yet)</h3>
            
            <div class="table-container">
              <table>
                <thead><tr><th style="width:40px;">#</th><th>Action</th><th>What to Enter</th></tr></thead>
                <tbody>
                  <tr>
                    <td class="highlight">1</td>
                    <td>Click <strong>"Save As"</strong> button (top right of search bar)</td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">2</td>
                    <td>Select <strong>"Report"</strong> from dropdown</td>
                    <td>NOT "Alert" — we're not alerting yet</td>
                  </tr>
                  <tr>
                    <td class="highlight">3</td>
                    <td>Enter <strong>Title</strong></td>
                    <td><code>WAF-UC1 Block Volume Anomaly [DEV]</code><br><em>(Add [DEV] to show it's in development)</em></td>
                  </tr>
                  <tr>
                    <td class="highlight">4</td>
                    <td>Enter <strong>Description</strong></td>
                    <td><code>Detects IPs with >100 blocks/hour. Threshold: 100 (medium), 200 (high), 500 (critical)</code></td>
                  </tr>
                  <tr>
                    <td class="highlight">5</td>
                    <td>Set <strong>Content</strong> to "Statistics Table"</td>
                    <td>Shows the table output</td>
                  </tr>
                  <tr>
                    <td class="highlight">6</td>
                    <td>Click <strong>"Save"</strong></td>
                    <td>Report is now saved</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="callout success" style="margin-top:16px;">
              <div class="callout-content">
                <div class="callout-title">✅ Phase 1 Complete</div>
                <div class="callout-body">
                  Your detection is saved as a report. You can find it later in:<br>
                  <strong>Settings → Searches, reports, and alerts</strong><br>
                  Or: <strong>Search & Reporting → Reports</strong> (left sidebar)
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ============================================================ -->
        <!-- PHASE 2: SILENT MODE -->
        <!-- ============================================================ -->
        <div class="section" style="margin-top:48px;border-top:3px solid #ff9800;padding-top:32px;">
          <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px;">
            <div style="width:48px;height:48px;background:#fff3e0;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;color:#f57c00;">2</div>
            <div>
              <h2 style="font-size:1.5rem;margin:0;color:#f57c00;">Phase 2: Silent Mode</h2>
              <p style="margin:4px 0 0;color:var(--gray-600);">Schedule the search to run automatically, but output to a lookup instead of alerting</p>
            </div>
          </div>

          <div class="callout info" style="margin-bottom:24px;">
            <div class="callout-content">
              <div class="callout-title">What is "Silent Mode"?</div>
              <div class="callout-body">
                <strong>Silent Mode = Scheduled search + Output to lookup (or summary index) + NO alert actions</strong><br><br>
                The search runs every 5 minutes, but instead of sending alerts, it writes results to a lookup file. You review the lookup manually to see what WOULD have alerted. This lets you measure false positive rate without bothering the SOC.
              </div>
            </div>
          </div>

          <!-- Step 2.1 -->
          <div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid #ff9800;">
            <h3 style="font-size:1.125rem;margin-bottom:16px;">Step 2.1: Create the Lookup File (One-Time Setup)</h3>
            
            <p style="margin-bottom:16px;color:var(--gray-600);">First, create an empty lookup file to store silent mode results:</p>

            <div class="table-container">
              <table>
                <thead><tr><th style="width:40px;">#</th><th>Action</th><th>What to Enter</th></tr></thead>
                <tbody>
                  <tr>
                    <td class="highlight">1</td>
                    <td>Go to <strong>Settings</strong> (top menu) → <strong>Lookups</strong></td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">2</td>
                    <td>Click <strong>"Lookup table files"</strong></td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">3</td>
                    <td>Click <strong>"New Lookup Table File"</strong></td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">4</td>
                    <td>Select <strong>Destination app</strong></td>
                    <td><code>search</code> (or your detection app)</td>
                  </tr>
                  <tr>
                    <td class="highlight">5</td>
                    <td>Upload a CSV file with just headers, OR use the search below to create it</td>
                    <td>See below</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="code-block" style="margin-top:16px;">
              <div class="code-header"><span class="code-title">Alternative: Create Lookup via Search</span></div>
              <div class="code-body">
                <pre><code>| makeresults 
| eval _time=now(), src_ip="init", block_count=0, severity="init"
| outputlookup waf_uc1_silent_mode.csv</code></pre>
              </div>
            </div>
            <p style="font-size:0.875rem;color:var(--gray-600);margin-top:8px;">
              Run this once to create the lookup file. It creates a dummy row that you can delete later.
            </p>
          </div>

          <!-- Step 2.2 -->
          <div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid #ff9800;">
            <h3 style="font-size:1.125rem;margin-bottom:16px;">Step 2.2: Modify SPL to Output to Lookup</h3>
            
            <p style="margin-bottom:16px;color:var(--gray-600);">Add <code>| outputlookup append=t</code> to the end of your SPL:</p>

            <div class="code-block" style="margin-bottom:16px;">
              <div class="code-header"><span class="code-title">Modified SPL for Silent Mode</span></div>
              <div class="code-body">
                <pre><code>index=akamai action=deny earliest=-5m
| stats count as block_count by src_ip
| where block_count > 100
| eval severity = case(
    block_count > 500, "critical",
    block_count > 200, "high",
    block_count > 100, "medium"
)
| eval _time = now()
| eval detection_name = "WAF-UC1"
| table _time detection_name src_ip block_count severity
| outputlookup append=t waf_uc1_silent_mode.csv</code></pre>
              </div>
            </div>

            <div class="callout warning" style="margin-top:16px;">
              <div class="callout-content">
                <div class="callout-title">Key Changes for Silent Mode</div>
                <div class="callout-body">
                  1. <code>earliest=-5m</code> — Changed from -1h to -5m (matches schedule interval)<br>
                  2. <code>| eval _time = now()</code> — Adds timestamp when detection fired<br>
                  3. <code>| eval detection_name = "WAF-UC1"</code> — Labels which detection this is<br>
                  4. <code>| outputlookup append=t filename.csv</code> — Appends results to lookup file
                </div>
              </div>
            </div>
          </div>

          <!-- Step 2.3 -->
          <div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid #ff9800;">
            <h3 style="font-size:1.125rem;margin-bottom:16px;">Step 2.3: Schedule the Search</h3>
            
            <div class="table-container">
              <table>
                <thead><tr><th style="width:40px;">#</th><th>Action</th><th>What to Enter / Select</th></tr></thead>
                <tbody>
                  <tr>
                    <td class="highlight">1</td>
                    <td>With your modified SPL in the search bar, click <strong>"Save As"</strong></td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">2</td>
                    <td>Select <strong>"Report"</strong></td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">3</td>
                    <td>Enter Title</td>
                    <td><code>WAF-UC1 Block Volume Anomaly [SILENT]</code></td>
                  </tr>
                  <tr>
                    <td class="highlight">4</td>
                    <td>Click <strong>"Save"</strong></td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">5</td>
                    <td>In the dialog that appears, click <strong>"Schedule"</strong></td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">6</td>
                    <td>Check <strong>"Schedule Report"</strong> checkbox</td>
                    <td>Enables scheduling</td>
                  </tr>
                  <tr>
                    <td class="highlight">7</td>
                    <td>Set <strong>Schedule</strong> to "Run every 5 minutes"</td>
                    <td>Or select "Cron" and enter: <code>*/5 * * * *</code></td>
                  </tr>
                  <tr>
                    <td class="highlight">8</td>
                    <td>Set <strong>Time Range</strong> to "Last 5 minutes"</td>
                    <td>Matches the schedule — searches exactly 5 min of data</td>
                  </tr>
                  <tr>
                    <td class="highlight">9</td>
                    <td><strong>DO NOT</strong> add any alert actions</td>
                    <td>Leave "Alert Actions" empty — this is silent mode!</td>
                  </tr>
                  <tr>
                    <td class="highlight">10</td>
                    <td>Click <strong>"Save"</strong></td>
                    <td>Scheduled search is now running</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Step 2.4 -->
          <div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid #ff9800;">
            <h3 style="font-size:1.125rem;margin-bottom:16px;">Step 2.4: Monitor Silent Mode Results (Daily)</h3>
            
            <p style="margin-bottom:16px;color:var(--gray-600);">Every day for 7 days, check what would have alerted:</p>

            <div class="code-block" style="margin-bottom:16px;">
              <div class="code-header"><span class="code-title">Review Silent Mode Results</span></div>
              <div class="code-body">
                <pre><code>``` View all silent mode results
| inputlookup waf_uc1_silent_mode.csv
| sort - _time
| head 100

``` Count results per day (estimate alert volume)
| inputlookup waf_uc1_silent_mode.csv
| eval day = strftime(_time, "%Y-%m-%d")
| stats count by day severity
| sort day

``` Find potential false positives (same IP repeatedly)
| inputlookup waf_uc1_silent_mode.csv
| stats count by src_ip
| where count > 5
| sort - count</code></pre>
              </div>
            </div>

            <div class="table-container" style="margin-top:16px;">
              <table>
                <thead><tr><th>Metric</th><th>Good</th><th>Needs Tuning</th><th>Action if Bad</th></tr></thead>
                <tbody>
                  <tr>
                    <td class="highlight">Results per day</td>
                    <td>0-10</td>
                    <td>&gt; 20</td>
                    <td>Increase threshold</td>
                  </tr>
                  <tr>
                    <td class="highlight">Same IP appearing repeatedly</td>
                    <td>Occasional</td>
                    <td>Same IP every day</td>
                    <td>Add to allowlist or investigate</td>
                  </tr>
                  <tr>
                    <td class="highlight">Critical severity count</td>
                    <td>0-2/day</td>
                    <td>&gt; 5/day</td>
                    <td>Increase critical threshold</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="callout success" style="margin-top:16px;">
              <div class="callout-content">
                <div class="callout-title">✅ Phase 2 Complete Criteria</div>
                <div class="callout-body">
                  Move to Phase 3 when:<br>
                  • Ran for minimum 7 days<br>
                  • False positive rate acceptable (&lt;20%)<br>
                  • Alert volume manageable (&lt;10/day for high severity)<br>
                  • Documented any tuning changes made
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ============================================================ -->
        <!-- PHASE 3: LIMITED ALERTING -->
        <!-- ============================================================ -->
        <div class="section" style="margin-top:48px;border-top:3px solid #ffc107;padding-top:32px;">
          <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px;">
            <div style="width:48px;height:48px;background:#fff8e1;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;color:#ffa000;">3</div>
            <div>
              <h2 style="font-size:1.5rem;margin:0;color:#ffa000;">Phase 3: Limited Alerting</h2>
              <p style="margin:4px 0 0;color:var(--gray-600);">Enable alerts for CRITICAL severity only, send to security team (not full SOC)</p>
            </div>
          </div>

          <!-- Step 3.1 -->
          <div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid #ffc107;">
            <h3 style="font-size:1.125rem;margin-bottom:16px;">Step 3.1: Convert Report to Alert</h3>
            
            <div class="table-container">
              <table>
                <thead><tr><th style="width:40px;">#</th><th>Action</th><th>Details</th></tr></thead>
                <tbody>
                  <tr>
                    <td class="highlight">1</td>
                    <td>Go to <strong>Settings → Searches, reports, and alerts</strong></td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">2</td>
                    <td>Find your report: <code>WAF-UC1 Block Volume Anomaly [SILENT]</code></td>
                    <td>Use search filter</td>
                  </tr>
                  <tr>
                    <td class="highlight">3</td>
                    <td>Click <strong>"Edit"</strong> → <strong>"Edit Search"</strong></td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">4</td>
                    <td>Modify SPL to filter for CRITICAL only (for now)</td>
                    <td>See below</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="code-block" style="margin-top:16px;">
              <div class="code-header"><span class="code-title">Modified SPL: Critical Only</span></div>
              <div class="code-body">
                <pre><code>index=akamai action=deny earliest=-5m
| stats count as block_count by src_ip
| where block_count > 500
| eval severity = "critical"
| eval detection_name = "WAF-UC1"
| table _time detection_name src_ip block_count severity</code></pre>
              </div>
            </div>
            <p style="font-size:0.875rem;color:var(--gray-600);margin-top:8px;">
              <strong>Note:</strong> Changed threshold to &gt;500 (critical only). Removed outputlookup (we're alerting now).
            </p>
          </div>

          <!-- Step 3.2 -->
          <div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid #ffc107;">
            <h3 style="font-size:1.125rem;margin-bottom:16px;">Step 3.2: Add Email Alert Action</h3>
            
            <div class="table-container">
              <table>
                <thead><tr><th style="width:40px;">#</th><th>Action</th><th>What to Enter</th></tr></thead>
                <tbody>
                  <tr>
                    <td class="highlight">1</td>
                    <td>In the report edit screen, click <strong>"Edit"</strong> → <strong>"Edit Alert"</strong></td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">2</td>
                    <td>Under <strong>"Trigger Actions"</strong>, click <strong>"+ Add Actions"</strong></td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">3</td>
                    <td>Select <strong>"Send email"</strong></td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">4</td>
                    <td>Enter <strong>To</strong></td>
                    <td>Your email + security team lead<br><em>NOT full SOC distribution list</em></td>
                  </tr>
                  <tr>
                    <td class="highlight">5</td>
                    <td>Enter <strong>Subject</strong></td>
                    <td><code>[CRITICAL] WAF-UC1: High Block Volume from $result.src_ip$</code></td>
                  </tr>
                  <tr>
                    <td class="highlight">6</td>
                    <td>Enter <strong>Message</strong></td>
                    <td>See template below</td>
                  </tr>
                  <tr>
                    <td class="highlight">7</td>
                    <td>Check <strong>"Include results as CSV"</strong></td>
                    <td>Attaches data to email</td>
                  </tr>
                  <tr>
                    <td class="highlight">8</td>
                    <td>Click <strong>"Save"</strong></td>
                    <td>—</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="code-block" style="margin-top:16px;">
              <div class="code-header"><span class="code-title">Email Message Template</span></div>
              <div class="code-body">
                <pre><code>Detection: WAF-UC1 Block Volume Anomaly
Severity: CRITICAL
Time: $result._time$

Source IP: $result.src_ip$
Block Count: $result.block_count$

This IP has been blocked more than 500 times in the last 5 minutes, indicating a potential attack.

NEXT STEPS:
1. Verify this is not a false positive (check if IP is legitimate)
2. Check Akamai console for attack details
3. Consider adding to permanent block list if confirmed malicious

Search: index=akamai src_ip=$result.src_ip$ earliest=-1h</code></pre>
              </div>
            </div>
          </div>

          <!-- Step 3.3 -->
          <div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid #ffc107;">
            <h3 style="font-size:1.125rem;margin-bottom:16px;">Step 3.3: Configure Throttling (Prevent Alert Storm)</h3>
            
            <div class="table-container">
              <table>
                <thead><tr><th style="width:40px;">#</th><th>Action</th><th>What to Enter</th></tr></thead>
                <tbody>
                  <tr>
                    <td class="highlight">1</td>
                    <td>In Alert settings, find <strong>"Throttle"</strong> section</td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">2</td>
                    <td>Check <strong>"Throttle"</strong> checkbox</td>
                    <td>Enables throttling</td>
                  </tr>
                  <tr>
                    <td class="highlight">3</td>
                    <td>Set <strong>"Suppress triggering for"</strong></td>
                    <td><code>1</code> hour</td>
                  </tr>
                  <tr>
                    <td class="highlight">4</td>
                    <td>Set <strong>"Group by"</strong></td>
                    <td><code>src_ip</code></td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="callout warning" style="margin-top:16px;">
              <div class="callout-content">
                <div class="callout-title">What Throttling Does</div>
                <div class="callout-body">
                  <strong>Without throttling:</strong> If src_ip 1.2.3.4 triggers every 5 minutes, you get 12 alerts/hour.<br>
                  <strong>With throttling (1 hour, by src_ip):</strong> You get 1 alert, then no more for that IP for 1 hour.<br><br>
                  This prevents alert fatigue while still catching new attackers.
                </div>
              </div>
            </div>
          </div>

          <!-- Step 3.4 -->
          <div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid #ffc107;">
            <h3 style="font-size:1.125rem;margin-bottom:16px;">Step 3.4: Monitor Limited Alerting (1 Week)</h3>
            
            <p style="margin-bottom:16px;color:var(--gray-600);">Track metrics to validate before full rollout:</p>

            <div class="code-block" style="margin-bottom:16px;">
              <div class="code-header"><span class="code-title">Check Alert History</span></div>
              <div class="code-body">
                <pre><code>``` View triggered alerts
index=_internal sourcetype=scheduler savedsearch_name="WAF-UC1*" status=success
| stats count by savedsearch_name
| sort - count

``` Check if alerts are being throttled
index=_internal sourcetype=scheduler savedsearch_name="WAF-UC1*" 
| stats count by status</code></pre>
              </div>
            </div>

            <div class="callout success" style="margin-top:16px;">
              <div class="callout-content">
                <div class="callout-title">✅ Phase 3 Complete Criteria</div>
                <div class="callout-body">
                  Move to Phase 4 when:<br>
                  • Ran for minimum 7 days in limited mode<br>
                  • Security team reviewed alerts and confirmed no issues<br>
                  • False positive rate documented and acceptable<br>
                  • SOC runbook written and approved
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ============================================================ -->
        <!-- PHASE 4: FULL PRODUCTION -->
        <!-- ============================================================ -->
        <div class="section" style="margin-top:48px;border-top:3px solid #4caf50;padding-top:32px;">
          <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px;">
            <div style="width:48px;height:48px;background:#e8f5e9;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;font-weight:700;color:#388e3c;">4</div>
            <div>
              <h2 style="font-size:1.5rem;margin:0;color:#388e3c;">Phase 4: Full Production</h2>
              <p style="margin:4px 0 0;color:var(--gray-600);">Enable all severity levels, add to SOC workflow (Incident Review if using ES)</p>
            </div>
          </div>

          <!-- Step 4.1 -->
          <div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid #4caf50;">
            <h3 style="font-size:1.125rem;margin-bottom:16px;">Step 4.1: Update to All Severity Levels</h3>
            
            <div class="code-block" style="margin-bottom:16px;">
              <div class="code-header"><span class="code-title">Full Production SPL</span></div>
              <div class="code-body">
                <pre><code>index=akamai action=deny earliest=-5m
| stats count as block_count by src_ip
| where block_count > 100
| eval severity = case(
    block_count > 500, "critical",
    block_count > 200, "high",
    block_count > 100, "medium"
)
| eval detection_name = "WAF-UC1"
| table _time detection_name src_ip block_count severity</code></pre>
              </div>
            </div>
            <p style="font-size:0.875rem;color:var(--gray-600);margin-top:8px;">
              Back to original thresholds — now all severities will alert.
            </p>
          </div>

          <!-- Step 4.2 Option A -->
          <div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid #4caf50;">
            <h3 style="font-size:1.125rem;margin-bottom:16px;">Step 4.2a: If Using Enterprise Security (ES) — Create Correlation Search</h3>
            
            <div class="table-container">
              <table>
                <thead><tr><th style="width:40px;">#</th><th>Action</th><th>Details</th></tr></thead>
                <tbody>
                  <tr>
                    <td class="highlight">1</td>
                    <td>Go to <strong>Enterprise Security → Configure → Content → Content Management</strong></td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">2</td>
                    <td>Click <strong>"Create New Content"</strong> → <strong>"Correlation Search"</strong></td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">3</td>
                    <td>Enter search name</td>
                    <td><code>WAF-UC1 Block Volume Anomaly</code></td>
                  </tr>
                  <tr>
                    <td class="highlight">4</td>
                    <td>Paste your SPL</td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">5</td>
                    <td>Set schedule (every 5 minutes)</td>
                    <td>—</td>
                  </tr>
                  <tr>
                    <td class="highlight">6</td>
                    <td>Configure Notable Event settings</td>
                    <td>See below</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <h4 style="font-size:0.9375rem;margin:24px 0 12px;">Notable Event Settings:</h4>
            <div class="table-container">
              <table>
                <thead><tr><th>Setting</th><th>Value</th></tr></thead>
                <tbody>
                  <tr><td class="highlight">Title</td><td><code>WAF Block Volume Anomaly: $result.src_ip$</code></td></tr>
                  <tr><td class="highlight">Description</td><td><code>IP $result.src_ip$ blocked $result.block_count$ times in 5 minutes</code></td></tr>
                  <tr><td class="highlight">Security Domain</td><td><code>threat</code></td></tr>
                  <tr><td class="highlight">Severity</td><td><code>$result.severity$</code></td></tr>
                  <tr><td class="highlight">Drilldown Search</td><td><code>index=akamai src_ip=$result.src_ip$ earliest=-1h</code></td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Step 4.2 Option B -->
          <div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid #4caf50;">
            <h3 style="font-size:1.125rem;margin-bottom:16px;">Step 4.2b: If NOT Using ES — Configure Full Alert</h3>
            
            <div class="table-container">
              <table>
                <thead><tr><th style="width:40px;">#</th><th>Action</th><th>Details</th></tr></thead>
                <tbody>
                  <tr>
                    <td class="highlight">1</td>
                    <td>Edit your existing alert</td>
                    <td>Settings → Searches, reports, and alerts</td>
                  </tr>
                  <tr>
                    <td class="highlight">2</td>
                    <td>Update SPL to full production version</td>
                    <td>All severity levels</td>
                  </tr>
                  <tr>
                    <td class="highlight">3</td>
                    <td>Update email recipients</td>
                    <td>Add full SOC distribution list</td>
                  </tr>
                  <tr>
                    <td class="highlight">4</td>
                    <td>Add webhook action (if using ticketing system)</td>
                    <td>Configure ServiceNow/Jira integration</td>
                  </tr>
                  <tr>
                    <td class="highlight">5</td>
                    <td>Rename alert</td>
                    <td><code>WAF-UC1 Block Volume Anomaly [PROD]</code></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Step 4.3 -->
          <div class="card" style="padding:24px;margin-bottom:16px;border-left:4px solid #4caf50;">
            <h3 style="font-size:1.125rem;margin-bottom:16px;">Step 4.3: Notify SOC and Provide Runbook</h3>
            
            <p style="margin-bottom:16px;color:var(--gray-600);">Before going live, ensure SOC is prepared:</p>

            <div class="checklist">
              <label class="checklist-item"><input type="checkbox"><span>SOC runbook written and shared (see <a href="runbooks.html">Runbooks page</a>)</span></label>
              <label class="checklist-item"><input type="checkbox"><span>Email sent to SOC lead announcing new detection</span></label>
              <label class="checklist-item"><input type="checkbox"><span>Brief meeting/training scheduled if needed</span></label>
              <label class="checklist-item"><input type="checkbox"><span>Escalation path documented (who to contact for questions)</span></label>
            </div>

            <div class="callout success" style="margin-top:24px;">
              <div class="callout-content">
                <div class="callout-title">✅ Phase 4 Complete — Detection is LIVE</div>
                <div class="callout-body">
                  Your detection is now in production. Continue to monitor:<br>
                  • Weekly: Check alert volume, false positive feedback<br>
                  • Monthly: Review with SOC, adjust thresholds if needed<br>
                  • Quarterly: Full effectiveness review
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Reference -->
        <div class="section" style="margin-top:48px;border-top:2px solid var(--gray-200);padding-top:32px;">
          <h2 class="subsection-title">Quick Reference: Where to Find Things in Splunk</h2>
          
          <div class="table-container">
            <table>
              <thead><tr><th>Task</th><th>Navigation Path</th></tr></thead>
              <tbody>
                <tr><td class="highlight">Create/edit reports & alerts</td><td><strong>Settings → Searches, reports, and alerts</strong></td></tr>
                <tr><td class="highlight">View scheduled search status</td><td><strong>Settings → Searches, reports, and alerts → Edit → View recent jobs</strong></td></tr>
                <tr><td class="highlight">Create lookup file</td><td><strong>Settings → Lookups → Lookup table files → New</strong></td></tr>
                <tr><td class="highlight">ES Correlation Searches</td><td><strong>Enterprise Security → Configure → Content → Content Management</strong></td></tr>
                <tr><td class="highlight">ES Incident Review</td><td><strong>Enterprise Security → Incident Review</strong></td></tr>
                <tr><td class="highlight">Check if search ran</td><td><strong>Activity → Scheduled Reports → (click report name)</strong></td></tr>
              </tbody>
            </table>
          </div>
        </div>

      </div>
    </main>
  </div>
  <script src="../js/app.js"></script>
  <script>mermaid.initialize({startOnLoad:true, theme:'neutral'});</script>
</body>
</html>
