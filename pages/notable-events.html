<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Notable Events (ES) | Sobeys Detection Engineering</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({startOnLoad:true, theme:'neutral'});</script>
</head>
<body>
  <div class="app-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <div class="sidebar-logo-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          </div>
          <div class="sidebar-logo-text">
            <h1>Sobeys Detection</h1>
            <span>Engineering Command Center</span>
          </div>
        </div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Operations</div>
          <a href="splunk-operations.html" class="nav-item">Splunk Ops</a>
          <a href="notable-events.html" class="nav-item active">Notable Events</a>
          <a href="data-models.html" class="nav-item">CIM Data Models</a>
          <a href="troubleshooting.html" class="nav-item">Troubleshooting</a>
          <a href="runbooks.html" class="nav-item">Runbooks</a>
        </div>
      </nav>
    </aside>

    <main class="main-content">
      <header class="header">
        <div class="header-left">
          <div class="breadcrumb">
            <a href="../index.html" class="breadcrumb-item">Home</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-item current">Notable Events</span>
          </div>
        </div>
        <span class="badge splunk">Splunk ES</span>
      </header>

      <div class="page-content">
        <div class="section">
          <h1 class="section-title">Notable Events Configuration</h1>
          <p class="section-subtitle">Splunk Enterprise Security integration for detection alerting</p>
        </div>

        <!-- What are Notables -->
        <div class="section">
          <h2 class="subsection-title">What are Notable Events?</h2>
          <div class="card">
            <div class="mermaid">
flowchart LR
    A[Correlation Search<br/>Scheduled SPL] -->|Matches| B[Notable Event<br/>Created]
    B --> C[Incident Review<br/>SOC Dashboard]
    C --> D{Analyst Triage}
    D -->|True Positive| E[Incident Workflow]
    D -->|False Positive| F[Tuning/Suppression]
    
    style B fill:#65a637,color:#fff
            </div>
          </div>
          <p style="margin-top:12px">Notable Events are the primary alert mechanism in Splunk Enterprise Security. When a correlation search finds suspicious activity, it creates a Notable that appears in the Incident Review dashboard for SOC analysts.</p>
        </div>

        <!-- Notable Event Fields -->
        <div class="section">
          <h2 class="subsection-title">Required Notable Event Fields</h2>
          <div class="table-container">
            <table>
              <thead><tr><th>Field</th><th>Description</th><th>Example</th></tr></thead>
              <tbody>
                <tr><td><code>rule_name</code></td><td>Name of the correlation rule</td><td>WAF Block Volume Anomaly</td></tr>
                <tr><td><code>rule_title</code></td><td>Display title</td><td>WAF-UC1: Abnormal Block Volume</td></tr>
                <tr><td><code>rule_description</code></td><td>What the detection found</td><td>Block count 3.2σ above baseline</td></tr>
                <tr><td><code>security_domain</code></td><td>Domain classification</td><td>network, identity, endpoint</td></tr>
                <tr><td><code>severity</code></td><td>Alert severity</td><td>critical, high, medium, low, info</td></tr>
                <tr><td><code>src</code></td><td>Source IP/host</td><td>203.0.113.50</td></tr>
                <tr><td><code>dest</code></td><td>Destination IP/host</td><td>www.sobeys.com</td></tr>
                <tr><td><code>user</code></td><td>Associated user</td><td>john.doe@sobeys.com</td></tr>
                <tr><td><code>drilldown_search</code></td><td>Investigation query</td><td>index=akamai src=$src$</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- savedsearches.conf Template -->
        <div class="section">
          <h2 class="subsection-title">savedsearches.conf Template</h2>
          <div class="code-block">
            <div class="code-header"><span class="code-title">Notable Event Configuration</span></div>
            <div class="code-body"><pre><code>[WAF-UC1 Block Volume Anomaly]
description = Detects statistical anomalies in WAF block volume
search = index=akamai sourcetype=akamai:siem \
| spath path=attackData.rules{}.ruleAction output=action \
| where action="deny" \
| bin _time span=5m \
| stats count as block_count dc(attackData.clientIP) as unique_ips BY _time \
| eventstats avg(block_count) as baseline stdev(block_count) as stdev \
| eval threshold = baseline + (2 * stdev) \
| where block_count > threshold AND block_count > 10 \
| eval deviation = round((block_count - baseline) / stdev, 2)

# Scheduling
cron_schedule = */5 * * * *
dispatch.earliest_time = -10m
dispatch.latest_time = now
enableSched = 1

# Alert Settings
alert.severity = 3
alert.suppress = 1
alert.suppress.period = 15m
alert.suppress.fields = hosts
counttype = number of events
quantity = 0
relation = greater than

# Notable Event Action
action.notable = 1
action.notable.param.rule_title = WAF Block Volume Anomaly
action.notable.param.rule_description = Detected $deviation$σ deviation in WAF block volume ($block_count$ blocks vs baseline $baseline$)
action.notable.param.security_domain = network
action.notable.param.severity = medium
action.notable.param.drilldown_name = View WAF Events
action.notable.param.drilldown_search = index=akamai sourcetype=akamai:siem earliest=-1h | stats count by attackData.clientIP | sort -count</code></pre></div>
          </div>
        </div>

        <!-- MFA Notable Example -->
        <div class="section">
          <h2 class="subsection-title">MFA-UC1 Notable Configuration</h2>
          <div class="code-block">
            <div class="code-header"><span class="code-title">MFA Fatigue Attack Notable</span></div>
            <div class="code-body"><pre><code>[MFA-UC1 Fatigue Attack Privileged]
description = Detects MFA push bombing against privileged users
search = index=cyberark sourcetype=cyberark:identity:audit \
    EventType IN ("Cloud.Core.MfaDenied", "Cloud.Core.MfaTimeout", "Cloud.Core.MfaAuthentication") \
| spath \
| eval user = ActorId \
| eval mfa_denied = if(Result IN ("Failure", "Denied", "Timeout"), 1, 0) \
| eval mfa_success = if(Result=="Success", 1, 0) \
| lookup privileged_users.csv userPrincipalName AS user OUTPUT is_privileged role \
| where is_privileged="true" \
| bin _time span=10m \
| stats sum(mfa_denied) as denials sum(mfa_success) as successes values(ClientIP) as source_ips BY user role _time \
| where denials >= 5

cron_schedule = */5 * * * *
dispatch.earliest_time = -15m
dispatch.latest_time = now
enableSched = 1

# CRITICAL if success after denials
alert.severity = 5

action.notable = 1
action.notable.param.rule_title = MFA Fatigue Attack - Privileged User
action.notable.param.rule_description = User $user$ ($role$) received $denials$ MFA denials. Successes: $successes$. INVESTIGATE IMMEDIATELY.
action.notable.param.security_domain = identity
action.notable.param.severity = critical
action.notable.param.drilldown_search = index=cyberark ActorId="$user$" earliest=-1h | table _time EventType Result ClientIP</code></pre></div>
          </div>
        </div>

        <!-- Severity Mapping -->
        <div class="section">
          <h2 class="subsection-title">Severity Mapping</h2>
          <div class="table-container">
            <table>
              <thead><tr><th>ES Severity</th><th>Value</th><th>Use Cases</th><th>SLA</th></tr></thead>
              <tbody>
                <tr><td><span class="badge critical">Critical</span></td><td>5</td><td>MFA-UC1 (success after denials), ADV-UC1, ADV-UC2</td><td>5 min triage</td></tr>
                <tr><td><span class="badge error">High</span></td><td>4</td><td>MFA-UC1 (denials only), WAF-UC2, WAF-UC4</td><td>15 min triage</td></tr>
                <tr><td><span class="badge warning">Medium</span></td><td>3</td><td>WAF-UC1, MFA-UC3</td><td>1 hr triage</td></tr>
                <tr><td><span class="badge info">Low</span></td><td>2</td><td>Informational detections</td><td>4 hr triage</td></tr>
                <tr><td><span class="badge default">Info</span></td><td>1</td><td>Baseline tracking only</td><td>Review weekly</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Suppression -->
        <div class="section">
          <h2 class="subsection-title">Alert Suppression</h2>
          <div class="callout warning">
            <div class="callout-content">
              <div class="callout-title">Prevent Alert Fatigue</div>
              <div class="callout-body">Use suppression to avoid flooding SOC with duplicate alerts for the same incident. Suppress on the key identifying field (user, src_ip, etc.) for an appropriate time window.</div>
            </div>
          </div>
          <div class="table-container">
            <table>
              <thead><tr><th>Detection</th><th>Suppress Field</th><th>Period</th><th>Rationale</th></tr></thead>
              <tbody>
                <tr><td>WAF-UC1</td><td>hosts</td><td>15 min</td><td>One alert per target per 15 min</td></tr>
                <tr><td>WAF-UC2</td><td>src</td><td>30 min</td><td>One alert per attacker IP</td></tr>
                <tr><td>MFA-UC1</td><td>user</td><td>10 min</td><td>One alert per user per window</td></tr>
                <tr><td>MFA-UC4</td><td>user</td><td>4 hr</td><td>Travel patterns need time to resolve</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Adaptive Response -->
        <div class="section">
          <h2 class="subsection-title">Adaptive Response Actions</h2>
          <div class="grid grid-2">
            <div class="card bordered-left primary">
              <h4>Standard Actions</h4>
              <ul style="font-size:0.875rem;margin-left:16px">
                <li>Create Notable Event</li>
                <li>Send Email to SOC</li>
                <li>Post to Slack #soc-alerts</li>
                <li>Create ServiceNow ticket</li>
              </ul>
            </div>
            <div class="card bordered-left error">
              <h4>Critical Actions (MFA Compromise)</h4>
              <ul style="font-size:0.875rem;margin-left:16px">
                <li>Page on-call analyst</li>
                <li>Auto-disable account (if SOAR enabled)</li>
                <li>Create P1 incident ticket</li>
                <li>Notify CISO/Security Lead</li>
              </ul>
            </div>
          </div>
        </div>

      </div>
    </main>
  </div>
  <script src="../js/app.js"></script>
</body>
</html>
