<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WAF-UC13: Rare HTTP Methods Detection | Splunk Reference</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../css/styles.css">
  <style>
    .impl-step{margin:24px 0;padding:20px;background:var(--gray-50);border-radius:8px;border-left:4px solid var(--primary-500);}
    .impl-step h4{color:var(--primary-700);margin-bottom:16px;font-size:1rem;}
    .impl-step.warning{border-left-color:#f59e0b;}
    .es-config{display:grid;grid-template-columns:220px 1fr;gap:10px;font-size:0.85rem;background:white;padding:16px;border-radius:6px;margin-top:12px;}
    .es-config dt{font-weight:600;color:var(--gray-700);}
    .es-config dd{color:var(--gray-600);margin:0;font-family:'JetBrains Mono',monospace;font-size:0.8rem;}
    .tuning-table{width:100%;font-size:0.8rem;margin-top:12px;border-collapse:collapse;}
    .tuning-table th{background:var(--gray-100);padding:10px;text-align:left;border:1px solid var(--gray-200);}
    .tuning-table td{padding:10px;border:1px solid var(--gray-200);}
    .fp-table{width:100%;font-size:0.8rem;margin-top:12px;border-collapse:collapse;}
    .fp-table th{background:#fef3c7;padding:10px;text-align:left;border:1px solid #fde68a;}
    .fp-table td{padding:10px;border:1px solid var(--gray-200);}
  </style>
</head>
<body>
  <div class="app-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <a href="../../index.html" style="display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit;">
            <div class="sidebar-logo-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            </div>
            <div class="sidebar-logo-text">
              <h1>Splunk Reference</h1>
              <span>Log & Detection Engineering</span>
            </div>
          </a>
        </div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">WAF Use Cases</div>
          <a href="uc1-volume.html" class="nav-item">UC1: Volume Anomaly</a>
          <a href="uc2-single-ip.html" class="nav-item">UC2: Single IP Flood</a>
          <a href="uc3-auth.html" class="nav-item">UC3: Auth Attack</a>
          <a href="uc4-sqli.html" class="nav-item">UC4: SQLi/XSS</a>
          <a href="uc5-distributed.html" class="nav-item">UC5: Distributed</a>
          <a href="uc6-geo.html" class="nav-item">UC6: Geo Anomaly</a>
          <a href="uc7-bypass.html" class="nav-item">UC7: WAF Bypass</a>
          <a href="uc8-bot.html" class="nav-item">UC8: Bot Detection</a>
          <a href="uc9-api.html" class="nav-item">UC9: API Abuse</a>
          <a href="uc10-path.html" class="nav-item">UC10: Path Traversal</a>
          <a href="uc13-methods.html" class="nav-item active">UC13: Rare Methods</a>
          <a href="uc14-errors.html" class="nav-item">UC14: Error Rate</a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Navigation</div>
          <a href="../waf-usecases.html" class="nav-item">‚Üê Back to WAF Overview</a>
          <a href="../../index.html" class="nav-item">‚Üê Command Center</a>
        </div>
      </nav>
    </aside>

    <main class="main-content">
      <header class="header">
        <div class="breadcrumb">
          <a href="../../index.html" class="breadcrumb-item">Home</a>
          <span class="breadcrumb-separator">/</span>
          <a href="../waf-usecases.html" class="breadcrumb-item">WAF Use Cases</a>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-item current">UC13: Rare HTTP Methods</span>
        </div>
        <span class="badge warning">Medium Priority</span>
      </header>

      <div class="page-content">
        <!-- OBJECTIVE -->
        <div class="section">
          <h1 class="section-title">WAF-UC13: Rare HTTP Methods / Protocol Abuse</h1>
          <div class="callout info" style="margin-top:16px;">
            <div class="callout-content">
              <div class="callout-title">üéØ Objective</div>
              <div class="callout-body">
                Detect attackers using unusual HTTP methods (TRACE, OPTIONS, CONNECT, PROPFIND, etc.) that are rarely used by legitimate applications but commonly used for reconnaissance and exploitation.
              </div>
            </div>
          </div>
        </div>

        <!-- THREAT CONTEXT -->
        <div class="section">
          <h2 class="subsection-title">Threat Context</h2>
          <div class="card" style="padding:20px;">
            <h4 style="margin-top:0;">What Attackers Are Doing</h4>
            <ul style="margin:12px 0 0 20px;">
              <li><strong>TRACE:</strong> Cross-Site Tracing (XST) attacks to steal cookies/credentials</li>
              <li><strong>OPTIONS:</strong> Enumeration of allowed methods, CORS misconfig probing</li>
              <li><strong>CONNECT:</strong> Proxy tunneling attempts, bypassing security controls</li>
              <li><strong>PROPFIND/PROPPATCH:</strong> WebDAV exploitation, file system enumeration</li>
              <li><strong>DEBUG:</strong> ASP.NET debugging endpoint exposure</li>
              <li><strong>TRACK:</strong> Similar to TRACE, HTTP debugging</li>
            </ul>
            <h4 style="margin-top:20px;">MITRE ATT&CK Mapping</h4>
            <table style="width:100%;margin-top:8px;">
              <tr><td style="width:120px;font-weight:600;">Tactic:</td><td>Discovery, Initial Access</td></tr>
              <tr><td style="font-weight:600;">Technique:</td><td>T1595 (Active Scanning), T1190 (Exploit Public-Facing App)</td></tr>
            </table>
          </div>
        </div>

        <!-- PREREQUISITES -->
        <div class="section">
          <h2 class="subsection-title">Prerequisites</h2>
          <div class="card" style="padding:20px;">
            <table class="tuning-table">
              <tr><th>Requirement</th><th>Details</th><th>Validation</th></tr>
              <tr>
                <td>Data Source</td>
                <td>Akamai WAF (akamai:siem)</td>
                <td><code>index=akamai sourcetype=akamai:siem | head 5</code></td>
              </tr>
              <tr>
                <td>Required Field</td>
                <td>httpMessage.method (HTTP method)</td>
                <td><code>| stats count by httpMessage.method</code></td>
              </tr>
              <tr>
                <td>CIM Mapping</td>
                <td>Web datamodel - http_method field</td>
                <td><code>| tstats count FROM datamodel=Web BY Web.http_method</code></td>
              </tr>
            </table>
          </div>
        </div>

        <!-- DETECTION SPL -->
        <div class="section">
          <h2 class="subsection-title">Detection SPL</h2>
          
          <div class="impl-step">
            <h4>Option 1: CIM/tstats (Recommended for Performance)</h4>
            <div style="background:#1e293b;color:#e2e8f0;padding:16px;border-radius:8px;overflow-x:auto;">
              <pre style="margin:0;font-family:'JetBrains Mono',monospace;font-size:0.8rem;">
| tstats count FROM datamodel=Web 
  WHERE Web.http_method IN ("TRACE","OPTIONS","CONNECT","PROPFIND","PROPPATCH","DEBUG","TRACK","COPY","MOVE","LOCK","UNLOCK","MKCOL")
  BY Web.src, Web.dest, Web.http_method, _time span=5m
| rename Web.* AS *
| stats sum(count) AS request_count, 
    dc(http_method) AS method_variety,
    values(http_method) AS methods_used
  BY src, dest
| where request_count >= 5 OR method_variety >= 2
| eval urgency = case(
    match(methods_used, "TRACE|CONNECT"), "high",
    method_variety >= 3, "high",
    request_count >= 20, "high",
    1=1, "medium"
)
| eval rule_name = "WAF-UC13 - Rare HTTP Methods from " . src</pre>
            </div>
          </div>

          <div class="impl-step">
            <h4>Option 2: Raw Index (Fallback)</h4>
            <div style="background:#1e293b;color:#e2e8f0;padding:16px;border-radius:8px;overflow-x:auto;">
              <pre style="margin:0;font-family:'JetBrains Mono',monospace;font-size:0.8rem;">
index=akamai sourcetype=akamai:siem
| spath path=httpMessage.method output=http_method
| spath path=attackData.clientIP output=src
| spath path=httpMessage.host output=dest
| where http_method IN ("TRACE","OPTIONS","CONNECT","PROPFIND","PROPPATCH","DEBUG","TRACK","COPY","MOVE","LOCK","UNLOCK","MKCOL")
| stats count AS request_count,
    dc(http_method) AS method_variety,
    values(http_method) AS methods_used,
    latest(_time) AS last_seen
  BY src, dest
| where request_count >= 5 OR method_variety >= 2
| eval urgency = case(
    match(methods_used, "TRACE|CONNECT"), "high",
    method_variety >= 3, "high",
    request_count >= 20, "high",
    1=1, "medium"
)
| eval rule_name = "WAF-UC13 - Rare HTTP Methods"</pre>
            </div>
          </div>
        </div>

        <!-- ES CONFIGURATION -->
        <div class="section">
          <h2 class="subsection-title">ES Correlation Search Configuration</h2>
          <div class="card" style="padding:20px;">
            <dl class="es-config">
              <dt>Search Name:</dt>
              <dd>Threat - WAF Rare HTTP Methods - Rule</dd>
              <dt>Schedule:</dt>
              <dd>*/10 * * * * (every 10 minutes)</dd>
              <dt>Time Range:</dt>
              <dd>earliest=-15m latest=-5m</dd>
              <dt>Throttle Field:</dt>
              <dd>src</dd>
              <dt>Throttle Window:</dt>
              <dd>3600 seconds (1 hour)</dd>
              <dt>Notable Title:</dt>
              <dd>$urgency$ - Rare HTTP Methods from $src$ targeting $dest$</dd>
              <dt>Notable Severity:</dt>
              <dd>Dynamic based on urgency field</dd>
              <dt>Security Domain:</dt>
              <dd>network</dd>
              <dt>Drilldown Search:</dt>
              <dd>index=akamai "httpMessage.method" IN ("TRACE","OPTIONS","CONNECT") src=$src$ earliest=$info_min_time$ latest=$info_max_time$</dd>
            </dl>
          </div>
        </div>

        <!-- SUPPRESSION GUIDANCE -->
        <div class="section">
          <h2 class="subsection-title">Suppression Guidance</h2>
          <div class="card" style="padding:20px;">
            <p><strong>When to Suppress:</strong></p>
            <ul style="margin:8px 0 0 20px;">
              <li>Legitimate CORS preflight (OPTIONS only, from known frontend domains)</li>
              <li>Monitoring tools that use OPTIONS for health checks</li>
              <li>WebDAV servers that legitimately use PROPFIND</li>
            </ul>
            <p style="margin-top:16px;"><strong>Suppression Rule Example:</strong></p>
            <code style="display:block;background:#f1f5f9;padding:12px;border-radius:6px;margin-top:8px;">
              src IN ("monitoring-system.corp.com", "10.0.0.0/8") AND http_method="OPTIONS"
            </code>
          </div>
        </div>

        <!-- TUNING -->
        <div class="section">
          <h2 class="subsection-title">Tuning Knobs</h2>
          <div class="card" style="padding:20px;">
            <table class="tuning-table">
              <tr>
                <th>Parameter</th>
                <th>Default</th>
                <th>Tune When</th>
                <th>Range</th>
              </tr>
              <tr>
                <td>request_count threshold</td>
                <td>‚â• 5</td>
                <td>Too many alerts from OPTIONS</td>
                <td>5-50</td>
              </tr>
              <tr>
                <td>method_variety threshold</td>
                <td>‚â• 2</td>
                <td>Multiple methods = higher confidence</td>
                <td>2-4</td>
              </tr>
              <tr>
                <td>Methods list</td>
                <td>TRACE, OPTIONS, CONNECT, etc.</td>
                <td>Remove OPTIONS if too noisy</td>
                <td>Custom list</td>
              </tr>
            </table>
          </div>
        </div>

        <!-- FALSE POSITIVES -->
        <div class="section">
          <h2 class="subsection-title">Common False Positives</h2>
          <div class="card" style="padding:20px;">
            <table class="fp-table">
              <tr>
                <th>Pattern</th>
                <th>Identification</th>
                <th>Action</th>
              </tr>
              <tr>
                <td>CORS preflight requests</td>
                <td>OPTIONS only, from browser user agents, to API endpoints</td>
                <td>Allowlist or increase threshold for OPTIONS-only alerts</td>
              </tr>
              <tr>
                <td>WebDAV clients (SharePoint, etc.)</td>
                <td>PROPFIND/PROPPATCH from known office IPs</td>
                <td>Allowlist corporate IP ranges</td>
              </tr>
              <tr>
                <td>Monitoring/health checks</td>
                <td>OPTIONS from monitoring tool IPs</td>
                <td>Suppress by source IP</td>
              </tr>
            </table>
          </div>
        </div>

        <!-- TRIAGE RUNBOOK -->
        <div class="section">
          <h2 class="subsection-title">Triage Runbook</h2>
          <div class="card" style="padding:20px;">
            <h4 style="margin-top:0;">Initial Assessment (5 min)</h4>
            <ol style="margin:8px 0 16px 20px;">
              <li>Check source IP reputation (threat intel, geo)</li>
              <li>Verify which methods were used - TRACE/CONNECT are higher priority</li>
              <li>Check if target application legitimately uses WebDAV or CORS</li>
              <li>Review User-Agent for automation indicators</li>
            </ol>
            
            <h4>Investigation Query</h4>
            <div style="background:#1e293b;color:#e2e8f0;padding:12px;border-radius:6px;margin-bottom:16px;">
              <pre style="margin:0;font-size:0.8rem;">index=akamai sourcetype=akamai:siem attackData.clientIP="$src$" earliest=-24h
| spath path=httpMessage.method output=method
| spath path=httpMessage.path output=path
| spath path=httpMessage.status output=status
| stats count, values(method) AS methods, values(path) AS paths BY status
| sort - count</pre>
            </div>
            
            <h4>Response Actions</h4>
            <table class="tuning-table">
              <tr><th>Finding</th><th>Action</th></tr>
              <tr><td>TRACE requests succeeded (200)</td><td>üî¥ Escalate - potential XST vulnerability</td></tr>
              <tr><td>CONNECT to external hosts</td><td>üî¥ Escalate - proxy abuse attempt</td></tr>
              <tr><td>OPTIONS only, legitimate CORS</td><td>üü¢ False positive - allowlist</td></tr>
              <tr><td>Mixed methods from scanner</td><td>üü° Block IP, continue monitoring</td></tr>
            </table>
          </div>
        </div>

        <!-- VALIDATION -->
        <div class="section">
          <h2 class="subsection-title">Validation Steps</h2>
          <div class="card" style="padding:20px;">
            <h4 style="margin-top:0;">Test Before Production</h4>
            <ol style="margin:8px 0 0 20px;">
              <li>Run detection SPL against 7+ days of historical data</li>
              <li>Verify rare methods exist in your data: <code>| stats count by httpMessage.method | where NOT method IN ("GET","POST","HEAD")</code></li>
              <li>Review expected volume and false positive patterns</li>
              <li>Test throttling by checking for duplicate notables</li>
            </ol>
          </div>
        </div>

        <!-- OWNER -->
        <div class="section">
          <h2 class="subsection-title">Owner & Change History</h2>
          <div class="card" style="padding:20px;">
            <table class="tuning-table">
              <tr><th>Field</th><th>Value</th></tr>
              <tr><td>Owner</td><td>Detection Engineering Team</td></tr>
              <tr><td>Created</td><td>2026-02-02</td></tr>
              <tr><td>Last Updated</td><td>2026-02-02</td></tr>
              <tr><td>Version</td><td>1.0</td></tr>
              <tr><td>Status</td><td>Ready for UAT</td></tr>
            </table>
          </div>
        </div>

        <!-- NAVIGATION -->
        <div style="display:flex;justify-content:space-between;margin-top:32px;">
          <a href="uc12-rate.html" class="btn btn-secondary">‚Üê Previous: UC12 Rate Limits</a>
          <a href="uc14-errors.html" class="btn btn-primary">Next: UC14 Error Rate ‚Üí</a>
        </div>

      
        <!-- SITE FOOTER -->
        <footer style="margin-top:48px;padding:24px;background:var(--gray-100);border-radius:8px;text-align:center;font-size:0.85rem;color:var(--gray-600);">
          <div style="margin-bottom:8px;">
            <strong>Splunk Detection Engineering Reference</strong> | Version 2.0 | Last Updated: February 2, 2026
          </div>
          <div>
            Internal Use Only | Detection Engineering Team
          </div>
        </footer>

      </div>
    </main>
  </div>
</body>
</html>
