<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WAF Use Cases | myfirstpro Detection Engineering</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <div class="app-container">
                                    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <a href="../index.html" style="display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit;">
            <div class="sidebar-logo-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            </div>
            <div class="sidebar-logo-text">
              <h1>myfirstpro</h1>
              <span>Detection Engineering</span>
            </div>
          </a>
        </div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Getting Started</div>
          <a href="../index.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg><span>Command Center</span></a>
          <a href="day1.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/></svg><span>Day 1 Checklist</span></a>
          <a href="client-comm.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg><span>Client Communication</span></a>
          <a href="professional-excellence.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg><span>Professional Excellence</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Splunk Fundamentals</div>
          <a href="splunk-fundamentals.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg><span>Splunk Basics (Start Here)</span></a>
          <a href="splunk-es.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><span>Enterprise Security (ES)</span></a>
          <a href="event-hub.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg><span>Event Hub & Data Flow</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Data Sources</div>
          <a href="vendor-akamai.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg><span>Akamai WAF</span></a>
          <a href="vendor-cyberark.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg><span>CyberArk Identity</span></a>
          <a href="vendor-entra.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg><span>Entra ID</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Splunk Operations</div>
          <a href="waf-onboarding.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg><span>Log Onboarding</span></a>
          <a href="parsing-cim.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg><span>Parsing & CIM</span></a>
          <a href="lookups.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg><span>Lookups Deep Dive</span></a>
          <a href="splunk-ops.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg><span>Splunk Cloud Ops</span></a>
          <a href="spl-reference.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg><span>SPL Reference</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">WAF/DDoS Project</div>
          <a href="waf-overview.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span>Project Overview</span></a>
          <a href="waf-usecases.html" class="nav-item active"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>Use Cases (UC1-8)</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">MFA Project</div>
          <a href="mfa-overview.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg><span>Project Overview</span></a>
          <a href="mfa-usecases.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>Use Cases (UC1-5)</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Response & Support</div>
          <a href="decision-trees.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="5" r="3"/><line x1="12" y1="8" x2="12" y2="14"/><circle cx="6" cy="19" r="3"/><circle cx="18" cy="19" r="3"/></svg><span>Decision Trees</span></a>
          <a href="troubleshooting.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><span>Troubleshooting</span></a>
          <a href="runbooks.html" class="nav-item"><svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6"/></svg><span>SOC Runbooks</span></a>
        </div>
      </nav>
      <div class="sidebar-footer"><p>Detection Engineering v2.0</p></div>
    </aside>

    <main class="main-content">
      <header class="header">
        <div class="header-left">
          <button class="menu-toggle" aria-label="Toggle menu">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
          </button>
          <div class="breadcrumb">
            <a href="../index.html" class="breadcrumb-item">Home</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-item">WAF Project</span>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-item current">Use Cases</span>
          </div>
        </div>
        <span class="badge akamai">8 Detections</span>
      </header>

      <div class="page-content">
        <div class="section">
          <h1 class="section-title">WAF/DDoS Detection Use Cases</h1>
          <p class="section-subtitle">Complete detection library for Akamai Kona Site Defender</p>
        </div>


        <!-- WAF Detection Matrix -->
        <div class="section">
          <h2 class="subsection-title">Detection Coverage Matrix</h2>
          <div class="card" style="padding:24px;background:var(--gray-50);overflow-x:auto;">
            <div class="mermaid">
flowchart TD
    subgraph Tier1["Tier 1: Foundation"]
        UC1[UC1: Volume Anomaly]
        UC2[UC2: Single Source]
        UC3[UC3: Auth Endpoint]
        UC4[UC4: SQLi/XSS]
    end
    subgraph Tier2["Tier 2: Advanced"]
        UC5[UC5: Low-Slow DDoS]
        UC6[UC6: Geo Anomaly]
        UC7[UC7: WAF+Backend]
        UC8[UC8: Bot Detection]
    end
    
    Tier1 --> Tier2
    
    style UC4 fill:#f8d7da,stroke:#dc3545
    style UC1 fill:#fff3cd,stroke:#ffc107
            </div>
          </div>
        </div>


        <!-- Quick Nav -->
        <div class="section">
          <div class="grid grid-4">
            <a href="#waf-uc1" class="card clickable" style="text-align:center;">
              <span class="badge warning">Medium</span>
              <h4 style="margin-top:8px;">UC1</h4>
              <p style="font-size:0.75rem;color:var(--gray-500);">Block Volume Anomaly</p>
            </a>
            <a href="#waf-uc2" class="card clickable" style="text-align:center;">
              <span class="badge error">High</span>
              <h4 style="margin-top:8px;">UC2</h4>
              <p style="font-size:0.75rem;color:var(--gray-500);">Single Source Flood</p>
            </a>
            <a href="#waf-uc3" class="card clickable" style="text-align:center;">
              <span class="badge error">High</span>
              <h4 style="margin-top:8px;">UC3</h4>
              <p style="font-size:0.75rem;color:var(--gray-500);">Auth Endpoint Attack</p>
            </a>
            <a href="#waf-uc4" class="card clickable" style="text-align:center;">
              <span class="badge critical">Critical</span>
              <h4 style="margin-top:8px;">UC4</h4>
              <p style="font-size:0.75rem;color:var(--gray-500);">SQLi/XSS Campaign</p>
            </a>
          </div>
          <div class="grid grid-4" style="margin-top:16px;">
            <a href="#waf-uc5" class="card clickable" style="text-align:center;">
              <span class="badge error">High</span>
              <h4 style="margin-top:8px;">UC5</h4>
              <p style="font-size:0.75rem;color:var(--gray-500);">Distributed Low-Slow</p>
            </a>
            <a href="#waf-uc6" class="card clickable" style="text-align:center;">
              <span class="badge warning">Medium</span>
              <h4 style="margin-top:8px;">UC6</h4>
              <p style="font-size:0.75rem;color:var(--gray-500);">Geo Anomaly</p>
            </a>
            <a href="#waf-uc7" class="card clickable" style="text-align:center;">
              <span class="badge error">High</span>
              <h4 style="margin-top:8px;">UC7</h4>
              <p style="font-size:0.75rem;color:var(--gray-500);">WAF + Backend Error</p>
            </a>
            <a href="#waf-uc8" class="card clickable" style="text-align:center;">
              <span class="badge warning">Medium</span>
              <h4 style="margin-top:8px;">UC8</h4>
              <p style="font-size:0.75rem;color:var(--gray-500);">Bot Behavior</p>
            </a>
          </div>
        </div>

        <!-- WAF-UC1 -->
        <div class="section" id="waf-uc1">
          <h2 class="subsection-title">WAF-UC1: Block Volume Anomaly</h2>
          <div class="grid grid-3" style="margin-bottom:16px;">
            <div class="card bordered-left warning">
              <h4>Severity</h4>
              <p style="font-size:1.25rem;font-weight:700;color:var(--warning-600);">Medium</p>
            </div>
            <div class="card bordered-left info">
              <h4>MITRE ATT&CK</h4>
              <p><code>T1190</code> - Exploit Public-Facing App</p>
            </div>
            <div class="card bordered-left primary">
              <h4>Tier</h4>
              <p style="font-size:1.25rem;font-weight:700;">Tier 1</p>
            </div>
          </div>
          <div class="callout info">
            <div class="callout-content">
              <div class="callout-title">Detection Goal</div>
              <div class="callout-body">Detect statistically significant spikes in WAF block volume that deviate from normal baseline patterns, indicating potential attack or scanning activity.</div>
            </div>
          </div>
          <div class="code-block">
            <div class="code-header">
              <span class="code-title">WAF-UC1 SPL - Block Volume Anomaly</span>
              <span class="code-lang">Production Ready</span>
            </div>
            <div class="code-body">
              <pre><code>index=akamai sourcetype=akamai:siem earliest=-10m
| spath path=attackData.rules{}.ruleAction output=action
| where action="deny"
| bin _time span=5m
| stats count as block_count 
        dc(attackData.clientIP) as unique_ips 
        values(httpMessage.requestHeaders.Host) as hosts
        BY _time
| eventstats avg(block_count) as baseline stdev(block_count) as stdev
| eval threshold = baseline + (2 * stdev)
| eval threshold = if(threshold < 50, 50, threshold)  ``` Minimum threshold floor
| where block_count > threshold AND block_count > 10
| eval deviation = round((block_count - baseline) / stdev, 2)
| eval severity = case(
    deviation >= 5, "CRITICAL",
    deviation >= 3, "HIGH",
    1=1, "MEDIUM"
)
| table _time block_count baseline threshold deviation unique_ips hosts severity</code></pre>
            </div>
          </div>
          <div class="table-container" style="margin-top:16px;">
            <table>
              <thead><tr><th>Parameter</th><th>Value</th><th>Rationale</th></tr></thead>
              <tbody>
                <tr><td>Time Window</td><td>5 minutes</td><td>Balance between detection speed and noise reduction</td></tr>
                <tr><td>Threshold Method</td><td>2-sigma (mean + 2√óstdev)</td><td>95th percentile, industry standard</td></tr>
                <tr><td>Minimum Floor</td><td>50 blocks</td><td>Prevents alerting on low-volume anomalies</td></tr>
                <tr><td>Schedule</td><td>Every 5 minutes</td><td>Matches time window for contiguous coverage</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- WAF-UC2 -->
        <div class="section" id="waf-uc2">
          <h2 class="subsection-title">WAF-UC2: Single Source Flood</h2>
          <div class="grid grid-3" style="margin-bottom:16px;">
            <div class="card bordered-left error"><h4>Severity</h4><p style="font-size:1.25rem;font-weight:700;color:var(--error-600);">High</p></div>
            <div class="card bordered-left info"><h4>MITRE ATT&CK</h4><p><code>T1498</code> - Network DoS</p></div>
            <div class="card bordered-left primary"><h4>Tier</h4><p style="font-size:1.25rem;font-weight:700;">Tier 1</p></div>
          </div>
          <div class="code-block">
            <div class="code-header"><span class="code-title">WAF-UC2 SPL - Single Source Flood</span></div>
            <div class="code-body">
              <pre><code>index=akamai sourcetype=akamai:siem earliest=-5m
| bin _time span=1m
| stats count as total_requests 
        count(eval('attackData.rules{}.ruleAction'="deny")) as blocked
        values(httpMessage.path) as paths
        values(httpMessage.requestHeaders.Host) as hosts
        BY _time attackData.clientIP geo.country
| where total_requests > 500 OR blocked > 50
| eval block_ratio = round(blocked/total_requests*100, 1)."%"
| eval severity = case(
    total_requests > 2000, "CRITICAL",
    total_requests > 1000, "HIGH",
    1=1, "MEDIUM"
)
| sort - total_requests
| table _time attackData.clientIP geo.country total_requests blocked block_ratio paths hosts severity</code></pre>
            </div>
          </div>
        </div>

        <!-- WAF-UC3 -->
        <div class="section" id="waf-uc3">
          <h2 class="subsection-title">WAF-UC3: Authentication Endpoint Attack</h2>
          <div class="grid grid-3" style="margin-bottom:16px;">
            <div class="card bordered-left error"><h4>Severity</h4><p style="font-size:1.25rem;font-weight:700;color:var(--error-600);">High</p></div>
            <div class="card bordered-left info"><h4>MITRE ATT&CK</h4><p><code>T1110</code> - Brute Force</p></div>
            <div class="card bordered-left primary"><h4>Tier</h4><p style="font-size:1.25rem;font-weight:700;">Tier 1</p></div>
          </div>
          <div class="code-block">
            <div class="code-header"><span class="code-title">WAF-UC3 SPL - Auth Endpoint Attack</span></div>
            <div class="code-body">
              <pre><code>index=akamai sourcetype=akamai:siem earliest=-10m
| spath path=attackData.rules{}.ruleAction output=action
| where action="deny"
| where match(httpMessage.path, "(?i)(login|auth|signin|oauth|token|session|password|forgot|reset|register)")
| bin _time span=5m
| stats count as blocked 
        dc(attackData.clientIP) as unique_attackers
        values(attackData.clientIP) as attacker_ips
        values(attackData.rules{}.ruleTag) as attack_types
        BY _time httpMessage.path httpMessage.requestHeaders.Host
| where blocked > 20 OR (blocked > 5 AND unique_attackers > 3)
| eval severity = case(
    blocked > 100, "CRITICAL",
    blocked > 50 OR unique_attackers > 10, "HIGH",
    1=1, "MEDIUM"
)
| table _time httpMessage.requestHeaders.Host httpMessage.path blocked unique_attackers attack_types severity</code></pre>
            </div>
          </div>
        </div>

        <!-- WAF-UC4 -->
        <div class="section" id="waf-uc4">
          <h2 class="subsection-title">WAF-UC4: SQLi/XSS Campaign</h2>
          <div class="grid grid-3" style="margin-bottom:16px;">
            <div class="card bordered-left critical"><h4>Severity</h4><p style="font-size:1.25rem;font-weight:700;color:var(--critical-600);">Critical</p></div>
            <div class="card bordered-left info"><h4>MITRE ATT&CK</h4><p><code>T1190</code> - Exploit Public App</p></div>
            <div class="card bordered-left primary"><h4>Tier</h4><p style="font-size:1.25rem;font-weight:700;">Tier 1</p></div>
          </div>
          <div class="code-block">
            <div class="code-header"><span class="code-title">WAF-UC4 SPL - SQLi/XSS Campaign Detection</span></div>
            <div class="code-body">
              <pre><code>index=akamai sourcetype=akamai:siem earliest=-10m
| spath path=attackData.rules{}.ruleAction output=action
| spath path=attackData.rules{}.ruleTag output=category
| where action="deny" AND category IN ("SQLI", "XSS", "CMD", "LFI", "RFI")
| bin _time span=5m
| stats count as attack_count
        dc(attackData.clientIP) as unique_attackers
        values(attackData.clientIP) as attacker_ips
        values(category) as attack_types
        values(httpMessage.requestHeaders.Host) as targets
        values(httpMessage.path) as paths
        BY _time
| where attack_count > 15
| eval severity = case(
    attack_count > 100 OR unique_attackers > 20, "CRITICAL",
    attack_count > 50 OR unique_attackers > 10, "HIGH",
    1=1, "MEDIUM"
)
| eval attack_summary = mvjoin(attack_types, ", ")
| table _time attack_count unique_attackers attack_summary targets attacker_ips severity</code></pre>
            </div>
          </div>
        </div>

        <!-- WAF-UC5 -->
        <div class="section" id="waf-uc5">
          <h2 class="subsection-title">WAF-UC5: Distributed Low-and-Slow Attack</h2>
          <div class="grid grid-3" style="margin-bottom:16px;">
            <div class="card bordered-left error"><h4>Severity</h4><p style="font-size:1.25rem;font-weight:700;color:var(--error-600);">High</p></div>
            <div class="card bordered-left info"><h4>MITRE ATT&CK</h4><p><code>T1499</code> - Endpoint DoS</p></div>
            <div class="card bordered-left primary"><h4>Tier</h4><p style="font-size:1.25rem;font-weight:700;">Tier 2</p></div>
          </div>
          <div class="code-block">
            <div class="code-header"><span class="code-title">WAF-UC5 SPL - Distributed Low-Slow Detection</span></div>
            <div class="code-body">
              <pre><code>index=akamai sourcetype=akamai:siem earliest=-30m
| spath path=attackData.rules{}.ruleAction output=action
| where action="deny"
| bin _time span=10m
| stats count as total_blocks
        dc(attackData.clientIP) as unique_sources
        dc(geo.country) as unique_countries
        values(attackData.rules{}.ruleTag) as attack_types
        BY _time httpMessage.requestHeaders.Host
| where unique_sources > 50 AND total_blocks > 100
| eval blocks_per_source = round(total_blocks / unique_sources, 1)
| where blocks_per_source < 10  ``` Low per-source = distributed
| eval severity = case(
    unique_sources > 200, "CRITICAL",
    unique_sources > 100, "HIGH",
    1=1, "MEDIUM"
)
| eval pattern = "Distributed attack: ".unique_sources." sources, ".blocks_per_source." blocks/source"
| table _time httpMessage.requestHeaders.Host total_blocks unique_sources unique_countries blocks_per_source pattern severity</code></pre>
            </div>
          </div>
        </div>

        <!-- WAF-UC6 -->
        <div class="section" id="waf-uc6">
          <h2 class="subsection-title">WAF-UC6: Geographic Anomaly</h2>
          <div class="grid grid-3" style="margin-bottom:16px;">
            <div class="card bordered-left warning"><h4>Severity</h4><p style="font-size:1.25rem;font-weight:700;color:var(--warning-600);">Medium</p></div>
            <div class="card bordered-left info"><h4>MITRE ATT&CK</h4><p><code>T1190</code></p></div>
            <div class="card bordered-left primary"><h4>Tier</h4><p style="font-size:1.25rem;font-weight:700;">Tier 2</p></div>
          </div>
          <div class="code-block">
            <div class="code-header"><span class="code-title">WAF-UC6 SPL - Geographic Anomaly</span></div>
            <div class="code-body">
              <pre><code>index=akamai sourcetype=akamai:siem earliest=-1h
| spath path=attackData.rules{}.ruleAction output=action
| where action="deny"
| stats count as blocks BY geo.country
| eventstats sum(blocks) as total_blocks
| eval percentage = round(blocks/total_blocks*100, 1)
| lookup high_risk_countries.csv country AS geo.country OUTPUT risk_level
| where risk_level="high" AND percentage > 10
| eval alert = geo.country." accounts for ".percentage."% of blocks"
| table geo.country blocks percentage risk_level alert</code></pre>
            </div>
          </div>
        </div>

        <!-- WAF-UC7 -->
        <div class="section" id="waf-uc7">
          <h2 class="subsection-title">WAF-UC7: WAF Block + Backend Error Correlation</h2>
          <div class="grid grid-3" style="margin-bottom:16px;">
            <div class="card bordered-left error"><h4>Severity</h4><p style="font-size:1.25rem;font-weight:700;color:var(--error-600);">High</p></div>
            <div class="card bordered-left info"><h4>MITRE ATT&CK</h4><p><code>T1190</code></p></div>
            <div class="card bordered-left primary"><h4>Tier</h4><p style="font-size:1.25rem;font-weight:700;">Tier 2</p></div>
          </div>
          <div class="code-block">
            <div class="code-header"><span class="code-title">WAF-UC7 SPL - WAF + Backend Error Correlation</span></div>
            <div class="code-body">
              <pre><code>index=akamai sourcetype=akamai:siem earliest=-15m
| spath path=attackData.rules{}.ruleAction output=action
| eval is_blocked = if(action="deny", 1, 0)
| eval is_5xx = if(httpMessage.status >= 500, 1, 0)
| bin _time span=5m
| stats sum(is_blocked) as waf_blocks
        sum(is_5xx) as backend_errors
        count as total_requests
        BY _time httpMessage.requestHeaders.Host
| where waf_blocks > 50 AND backend_errors > 10
| eval correlation = "WAF blocks + backend stress detected"
| eval severity = if(backend_errors > 50, "CRITICAL", "HIGH")
| table _time httpMessage.requestHeaders.Host waf_blocks backend_errors total_requests severity correlation</code></pre>
            </div>
          </div>
        </div>

        <!-- WAF-UC8 -->
        <div class="section" id="waf-uc8">
          <h2 class="subsection-title">WAF-UC8: Bot Behavior Detection</h2>
          <div class="grid grid-3" style="margin-bottom:16px;">
            <div class="card bordered-left warning"><h4>Severity</h4><p style="font-size:1.25rem;font-weight:700;color:var(--warning-600);">Medium</p></div>
            <div class="card bordered-left info"><h4>MITRE ATT&CK</h4><p><code>T1595</code> - Active Scanning</p></div>
            <div class="card bordered-left primary"><h4>Tier</h4><p style="font-size:1.25rem;font-weight:700;">Tier 2</p></div>
          </div>
          <div class="code-block">
            <div class="code-header"><span class="code-title">WAF-UC8 SPL - Bot Behavior Detection</span></div>
            <div class="code-body">
              <pre><code>index=akamai sourcetype=akamai:siem earliest=-15m
| spath path=attackData.rules{}.ruleTag output=category
| spath path=attackData.rules{}.ruleAction output=action
| where category="BOT" OR action IN ("deny", "challenge")
| bin _time span=5m
| stats count as events
        dc(attackData.clientIP) as unique_bots
        count(eval(action="deny")) as blocked
        count(eval(action="challenge")) as challenged
        values(httpMessage.requestHeaders.User-Agent) as user_agents
        BY _time httpMessage.requestHeaders.Host
| where unique_bots > 10 OR blocked > 50
| eval bot_ratio = round(blocked/(blocked+challenged+0.01)*100, 1)."%"
| eval severity = case(
    unique_bots > 50, "HIGH",
    blocked > 100, "HIGH",
    1=1, "MEDIUM"
)
| table _time httpMessage.requestHeaders.Host unique_bots blocked challenged bot_ratio severity</code></pre>
            </div>
          </div>
        </div>

      
        <!-- EDGE CASES & TUNING DECISIONS -->
        <div class="section" style="margin-top:48px;border-top:2px solid var(--gray-200);padding-top:32px;">
          <h2 class="subsection-title" style="color:var(--warning-600);">‚ö†Ô∏è Detection Tuning & Edge Cases</h2>
          
          <div class="card" style="padding:24px;background:var(--gray-50);overflow-x:auto;margin-bottom:24px;">
            <div class="mermaid">
flowchart TD
    A[Detection Issue] --> B{What's wrong?}
    B -->|Too many FPs| C[Threshold too LOW]
    B -->|Missing attacks| D[Threshold too HIGH]
    C --> E{FP Pattern?}
    E -->|Specific IPs| F[Add to whitelist]
    E -->|Time-based| G[Add time filter]
    E -->|General noise| H[Increase threshold]
    D --> I[Lower threshold<br/>Accept more FPs]
    style F fill:#d4edda,stroke:#28a745
    style G fill:#d4edda,stroke:#28a745
    style I fill:#fff3cd,stroke:#ffc107
            </div>
          </div>

          <h3 style="font-size:1rem;margin-bottom:12px;">Threshold Setting Methods</h3>
          <div class="table-container">
            <table>
              <thead><tr><th>Data Pattern</th><th>Method</th><th>Starting Point</th></tr></thead>
              <tbody>
                <tr><td class="highlight">Normal distribution</td><td>Mean + N√óStdDev</td><td>Mean + 2œÉ (catches 95% outliers)</td></tr>
                <tr><td class="highlight">High variance/spiky</td><td>Percentile</td><td>P95 or P99</td></tr>
                <tr><td class="highlight">Time patterns</td><td>Hour/Day baseline</td><td>Compare to same time last week</td></tr>
                <tr><td class="highlight">Binary events</td><td>Fixed count</td><td>X events in Y minutes</td></tr>
              </tbody>
            </table>
          </div>

          <h3 style="font-size:1rem;margin:24px 0 12px;">Common Detection Challenges</h3>
          <div class="table-container">
            <table>
              <thead><tr><th>Challenge</th><th>Solution</th><th>Trade-off</th></tr></thead>
              <tbody>
                <tr><td class="highlight">FP rate &gt;20%</td><td>Increase threshold, add exclusions</td><td>May miss some attacks</td></tr>
                <tr><td class="highlight">No baseline data</td><td>Use industry benchmarks, start high</td><td>Conservative initially</td></tr>
                <tr><td class="highlight">Scanner traffic</td><td>Scanner whitelist lookup with expiry</td><td>Must maintain whitelist</td></tr>
                <tr><td class="highlight">Weekend/holiday FPs</td><td>Day-of-week thresholds</td><td>More complex logic</td></tr>
                <tr><td class="highlight">Pentest flooding alerts</td><td>Time-bound whitelist with ticket#</td><td>Review monthly</td></tr>
              </tbody>
            </table>
          </div>

          <div class="callout critical" style="margin-top:16px;">
            <div class="callout-content">
              <div class="callout-title">FP Storm Response</div>
              <div class="callout-body">
                If detection generates 100+ FPs overnight:<br>
                1. <strong>Disable alert action</strong> (not the search)<br>
                2. <strong>Communicate</strong>: "Aware, investigating"<br>
                3. <strong>Analyze</strong>: Find pattern<br>
                4. <strong>Fix</strong>: Add exclusion or adjust threshold<br>
                5. <strong>Test</strong>: Run against historical data<br>
                6. <strong>Re-enable</strong>: With monitoring
              </div>
            </div>
          </div>

          <h3 style="font-size:1rem;margin:24px 0 12px;">Scanner Whitelist Template</h3>
          <div class="code-block">
            <div class="code-header"><span class="code-title">scanner_whitelist.csv</span></div>
            <div class="code-body">
              <pre><code>ip_address,scanner_name,owner,approved_date,expiry_date,ticket
10.1.50.100,Qualys,Security,2024-01-15,2025-01-15,CHG001
192.168.100.0/24,Pentest-Vendor,External,2024-06-01,2024-06-30,CHG002</code></pre>
            </div>
          </div>
        </div>

      
        <!-- TECHNICAL DEEP DIVE - BE READY TO EXPLAIN EVERYTHING -->
        <div class="section" style="margin-top:48px;border-top:2px solid var(--gray-200);padding-top:32px;">
          <h2 class="subsection-title" style="color:var(--primary-600);">üìö Technical Deep Dive: Know Everything</h2>
          <p style="font-size:0.875rem;color:var(--gray-600);margin-bottom:16px;">Be ready to explain any of these concepts when asked. Never say "I don't know" ‚Äî use this reference.</p>
          
          <h3 style="font-size:1rem;margin-bottom:12px;">How Thresholds Are Calculated (Explain Like a Pro)</h3>
          <div class="code-block" style="margin-bottom:16px;">
            <div class="code-header"><span class="code-title">Statistical Threshold Methodology</span></div>
            <div class="code-body">
              <pre><code>``` Step 1: Collect 14 days of baseline data
index=akamai earliest=-14d latest=-1d
| bucket _time span=1h
| stats count as events_per_hour by _time
| stats avg(events_per_hour) as mean, stdev(events_per_hour) as std_dev

``` Step 2: Calculate threshold using statistical method
| eval threshold_2sigma = mean + (2 * std_dev)   ``` Catches 95% of outliers
| eval threshold_3sigma = mean + (3 * std_dev)   ``` Catches 99.7% of outliers

``` Step 3: Validate threshold against historical attacks
index=akamai earliest=-30d action=deny 
| bucket _time span=1h | stats count by _time
| where count > [your_threshold]
``` Should show known attack periods but not normal traffic

``` Why 2 sigma?
``` - Normal distribution: 95.4% of values within 2œÉ of mean
``` - Balance between catching anomalies and avoiding FPs
``` - Industry standard for SIEM detection engineering
``` - Can adjust to 2.5œÉ or 3œÉ based on FP rate</code></pre>
            </div>
          </div>

          <h3 style="font-size:1rem;margin:24px 0 12px;">MITRE ATT&CK Mapping (Know Your Coverage)</h3>
          <div class="table-container">
            <table>
              <thead><tr><th>Use Case</th><th>MITRE Technique</th><th>Tactic</th><th>What It Detects</th></tr></thead>
              <tbody>
                <tr><td class="highlight">WAF-UC1</td><td>T1498 - Network DoS</td><td>Impact</td><td>Volumetric attacks overwhelming infrastructure</td></tr>
                <tr><td class="highlight">WAF-UC2</td><td>T1499.001 - Endpoint DoS Flood</td><td>Impact</td><td>Single source flooding specific endpoint</td></tr>
                <tr><td class="highlight">WAF-UC3</td><td>T1110 - Brute Force</td><td>Credential Access</td><td>Authentication endpoint attacks</td></tr>
                <tr><td class="highlight">WAF-UC4</td><td>T1190 - Exploit Public-Facing</td><td>Initial Access</td><td>SQLi, XSS, RCE attempts</td></tr>
                <tr><td class="highlight">WAF-UC5</td><td>T1595 - Active Scanning</td><td>Reconnaissance</td><td>Automated vulnerability scanning</td></tr>
                <tr><td class="highlight">WAF-UC6</td><td>T1071 - Application Layer Protocol</td><td>C2</td><td>Suspicious API/bot behavior</td></tr>
              </tbody>
            </table>
          </div>

          <h3 style="font-size:1rem;margin:24px 0 12px;">Why These Detections Work (Explain the Logic)</h3>
          <div class="table-container">
            <table>
              <thead><tr><th>Detection</th><th>Signal</th><th>Why It Indicates Attack</th><th>Potential FP Sources</th></tr></thead>
              <tbody>
                <tr>
                  <td class="highlight">Block Volume Anomaly</td>
                  <td>Blocked requests > threshold</td>
                  <td>Normal traffic rarely triggers WAF rules; spikes indicate malicious activity</td>
                  <td>New security rule deployment, legitimate scanner, bot traffic</td>
                </tr>
                <tr>
                  <td class="highlight">Single Source Flood</td>
                  <td>High volume from one IP</td>
                  <td>Legitimate users don't send 1000+ requests/minute; this is automation</td>
                  <td>Load balancer IP, corporate proxy, CDN node</td>
                </tr>
                <tr>
                  <td class="highlight">Auth Endpoint Attack</td>
                  <td>Failed logins > threshold</td>
                  <td>Credential stuffing/brute force produces predictable failure patterns</td>
                  <td>Password reset day, new SSO rollout, forgot password feature</td>
                </tr>
                <tr>
                  <td class="highlight">SQLi Campaign</td>
                  <td>SQLi rule triggers from same source</td>
                  <td>SQL injection attempts have distinct signatures; multiple from one source = targeted attack</td>
                  <td>Security scanner (whitelist it), penetration test</td>
                </tr>
              </tbody>
            </table>
          </div>

          <h3 style="font-size:1rem;margin:24px 0 12px;">Detection Performance Metrics (Know Your Numbers)</h3>
          <div class="code-block">
            <div class="code-header"><span class="code-title">Calculate and Report These Metrics</span></div>
            <div class="code-body">
              <pre><code>``` Overall FP Rate Calculation
index=notable sourcetype=stash earliest=-7d
| stats count(eval(status="false_positive")) as FP, 
        count(eval(status="true_positive")) as TP,
        count as Total
| eval FP_Rate = round((FP/Total)*100, 1)."%"

``` Per-Detection FP Rate
index=notable sourcetype=stash earliest=-7d
| stats count(eval(status="false_positive")) as FP, count as Total by rule_name
| eval FP_Rate = round((FP/Total)*100, 1)
| sort - FP_Rate

``` Mean Time to Detect (MTTD) - for known incidents
``` Compare incident start time vs first alert time

``` Alert Volume Trend
index=notable sourcetype=stash
| timechart span=1d count by severity</code></pre>
            </div>
          </div>

          <div class="callout success" style="margin-top:16px;">
            <div class="callout-content">
              <div class="callout-title">Always Have These Numbers Ready</div>
              <div class="callout-body">
                Before any meeting, know:<br>
                ‚Ä¢ <strong>Total alerts last 7 days:</strong> ___<br>
                ‚Ä¢ <strong>FP rate:</strong> ___% (target <10%)<br>
                ‚Ä¢ <strong>TP rate:</strong> ___%<br>
                ‚Ä¢ <strong>Top alerting detection:</strong> ___<br>
                ‚Ä¢ <strong>Detections in production:</strong> ___ / 13
              </div>
            </div>
          </div>
        </div>

      </div>
    </main>
  </div>
  <script src="../js/app.js"></script>
  <script>mermaid.initialize({startOnLoad:true, theme:'neutral'});</script>
</body>
</html>
