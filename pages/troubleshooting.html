<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Troubleshooting Guide | Splunk Reference</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <style>
    .diagram-container {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 2px solid #e2e8f0;
      border-radius: 16px;
      padding: 40px;
      margin: 24px 0;
      overflow-x: auto;
      min-height: 400px;
    }
    .diagram-container .mermaid {
      min-width: 900px;
    }
    .diagram-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: #64748b;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .diagram-scroll-hint {
      font-size: 0.75rem;
      color: #94a3b8;
      text-align: right;
      margin-top: 8px;
    }
    .code-box {
      background: #1e293b;
      color: #e2e8f0;
      border-radius: 12px;
      padding: 20px;
      margin-top: 16px;
      overflow-x: auto;
    }
    .code-box h4 { color: #f8fafc; margin-top: 0; font-size: 0.875rem; }
    .code-box pre { margin: 0; font-size: 0.8125rem; line-height: 1.6; }
  </style>
</head>
<body>
  <div class="app-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <a href="../index.html" style="display:flex;align-items:center;gap:12px;text-decoration:none;color:inherit;">
            <div class="sidebar-logo-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            </div>
            <div class="sidebar-logo-text">
              <h1>Splunk Reference</h1>
              <span>Detection Engineering</span>
            </div>
          </a>
        </div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Getting Started</div>
          <a href="../index.html" class="nav-item">Command Center</a>
          <a href="day1.html" class="nav-item">Day 1 Checklist</a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Active Projects</div>
          <a href="waf-overview.html" class="nav-item">WAF/DDoS Project</a>
          <a href="mfa-overview.html" class="nav-item">MFA Project</a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Operations</div>
          <a href="splunk-ops.html" class="nav-item">Splunk Cloud Admin</a>
          <a href="troubleshooting.html" class="nav-item active">Troubleshooting</a>
          <a href="decision-trees.html" class="nav-item">Decision Trees</a>
          <a href="runbooks.html" class="nav-item">SOC Runbooks</a>
        </div>
      </nav>
    </aside>
    
    <main class="main-content">
      <header class="header">
        <div class="header-left">
          <button class="menu-toggle" aria-label="Toggle menu">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/>
            </svg>
          </button>
          <div class="breadcrumb">
            <a href="../index.html" class="breadcrumb-item">Home</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-item current">Troubleshooting</span>
          </div>
        </div>
        <span class="badge warning">Reference</span>
      </header>

      <div class="page-content">
        <div class="section">
          <h1 class="section-title">Troubleshooting Guide</h1>
          <p class="section-subtitle">Comprehensive decision trees for diagnosing and resolving Splunk issues</p>
        </div>

        <!-- ============================================ -->
        <!-- MASTER TROUBLESHOOTING TREE -->
        <!-- ============================================ -->
        <div class="section">
          <h2 class="subsection-title">üîç Master Troubleshooting Decision Tree</h2>
          <p>Start here when something isn't working. Follow the decision tree to identify your issue category.</p>
          
          <div class="diagram-container">
            <div class="diagram-label">Master Problem Identification Flow</div>
            <pre class="mermaid">
%%{init: {'theme': 'base', 'themeVariables': {'fontSize': '14px', 'fontFamily': 'Inter, sans-serif'}}}%%
flowchart TB
    A["üîç What's the Problem?"]
    
    A --> B{"Is it a<br/>DATA issue?"}
    A --> C{"Is it a<br/>SEARCH issue?"}
    A --> D{"Is it a<br/>DETECTION issue?"}
    
    subgraph DATA["üìä DATA ISSUES"]
        B -->|"Yes"| B1{"Is data arriving<br/>at all?"}
        B1 -->|"No data"| B2["üî¥ Go to:<br/>No Data Arriving"]
        B1 -->|"Data arriving"| B3{"What's wrong<br/>with it?"}
        B3 -->|"Wrong timestamp"| B4["üü† Go to:<br/>Timestamp Issues"]
        B3 -->|"Fields missing"| B5["üü° Go to:<br/>Field Extraction"]
        B3 -->|"Events merged/split"| B6["üü° Go to:<br/>Event Breaking"]
        B3 -->|"Wrong sourcetype"| B7["üü° Go to:<br/>Sourcetype Issues"]
    end
    
    subgraph SEARCH["üîé SEARCH ISSUES"]
        C -->|"Yes"| C1{"What's happening?"}
        C1 -->|"Too slow"| C2["üü£ Go to:<br/>Search Performance"]
        C1 -->|"Errors"| C3["üü£ Go to:<br/>Search Errors"]
        C1 -->|"Wrong results"| C4["üü£ Go to:<br/>Search Logic"]
    end
    
    subgraph DETECT["üö® DETECTION ISSUES"]
        D -->|"Yes"| D1{"What's happening?"}
        D1 -->|"No alerts"| D2["üü¢ Go to:<br/>Detection Not Firing"]
        D1 -->|"Too many alerts"| D3["üü¢ Go to:<br/>False Positives"]
        D1 -->|"Delayed alerts"| D4["üü¢ Go to:<br/>Alert Timing"]
    end

    style A fill:#3b82f6,color:#fff,stroke:#1d4ed8,stroke-width:3px
    style B2 fill:#ef4444,color:#fff
    style B4 fill:#f59e0b,color:#fff
    style B5 fill:#eab308,color:#fff
    style B6 fill:#eab308,color:#fff
    style B7 fill:#eab308,color:#fff
    style C2 fill:#8b5cf6,color:#fff
    style C3 fill:#8b5cf6,color:#fff
    style C4 fill:#8b5cf6,color:#fff
    style D2 fill:#10b981,color:#fff
    style D3 fill:#10b981,color:#fff
    style D4 fill:#10b981,color:#fff
            </pre>
            <div class="diagram-scroll-hint">‚Üê Scroll horizontally if needed ‚Üí</div>
          </div>
        </div>

        <!-- ============================================ -->
        <!-- NO DATA ARRIVING -->
        <!-- ============================================ -->
        <div class="section">
          <h2 class="subsection-title">üî¥ No Data Arriving</h2>
          <p>Complete troubleshooting flow when no data is appearing in your index.</p>
          
          <div class="diagram-container">
            <div class="diagram-label">Complete No Data Troubleshooting Flow</div>
            <pre class="mermaid">
%%{init: {'theme': 'base', 'themeVariables': {'fontSize': '14px', 'fontFamily': 'Inter, sans-serif'}}}%%
flowchart TB
    A["üî¥ No Data in Index"]
    A --> B{"What input<br/>method?"}
    
    subgraph HEC["üåê HEC PATH"]
        B -->|"HEC"| C["Check HEC Token"]
        C --> C1{"Token enabled<br/>in Splunk?"}
        C1 -->|"No"| C2["‚úÖ Enable token in<br/>Settings ‚Üí Data Inputs<br/>‚Üí HTTP Event Collector"]
        C1 -->|"Yes"| C3{"Test with curl<br/>returns success?"}
        C3 -->|"No"| C4{"What error code?"}
        C3 -->|"Yes"| C5["‚úÖ Source system<br/>not sending - check<br/>source configuration"]
        
        C4 -->|"401/403"| C6["‚úÖ Token invalid<br/>or wrong - regenerate<br/>and update source"]
        C4 -->|"Connection refused"| C7["‚úÖ HEC endpoint<br/>unreachable - check<br/>firewall/URL/port"]
        C4 -->|"SSL error"| C8["‚úÖ Certificate issue<br/>verify SSL config or<br/>use -k flag for test"]
    end
    
    subgraph UF["üì¶ FORWARDER PATH"]
        B -->|"Universal Forwarder"| D["Check Forwarder"]
        D --> D1{"Forwarder service<br/>running?"}
        D1 -->|"No"| D2["‚úÖ Start forwarder:<br/>./splunk start"]
        D1 -->|"Yes"| D3{"outputs.conf<br/>configured correctly?"}
        D3 -->|"No"| D4["‚úÖ Fix server address<br/>and port in<br/>outputs.conf"]
        D3 -->|"Yes"| D5{"inputs.conf<br/>configured correctly?"}
        D5 -->|"No"| D6["‚úÖ Fix monitor path<br/>or input stanza in<br/>inputs.conf"]
        D5 -->|"Yes"| D7{"Network connectivity<br/>to indexer?"}
        D7 -->|"No"| D8["‚úÖ Check firewall<br/>rules - port 9997<br/>must be open"]
        D7 -->|"Yes"| D9["‚úÖ Check _internal<br/>logs for errors:<br/>index=_internal host=UF"]
    end
    
    subgraph SYSLOG["üì° SYSLOG PATH"]
        B -->|"Syslog"| E["Check Syslog"]
        E --> E1{"Syslog daemon<br/>running on HF?"}
        E1 -->|"No"| E2["‚úÖ Start syslog<br/>input on HF"]
        E1 -->|"Yes"| E3{"Correct port and<br/>protocol (UDP/TCP)?"}
        E3 -->|"No"| E4["‚úÖ Match UDP/TCP<br/>and port number<br/>with source device"]
        E3 -->|"Yes"| E5{"Source device<br/>sending to correct IP?"}
        E5 -->|"No"| E6["‚úÖ Update source<br/>device syslog<br/>destination"]
        E5 -->|"Yes"| E7["‚úÖ Check HF<br/>inputs.conf and<br/>network path"]
    end

    style A fill:#ef4444,color:#fff,stroke:#dc2626,stroke-width:3px
    style C2 fill:#10b981,color:#fff
    style C5 fill:#10b981,color:#fff
    style C6 fill:#10b981,color:#fff
    style C7 fill:#10b981,color:#fff
    style C8 fill:#10b981,color:#fff
    style D2 fill:#10b981,color:#fff
    style D4 fill:#10b981,color:#fff
    style D6 fill:#10b981,color:#fff
    style D8 fill:#10b981,color:#fff
    style D9 fill:#10b981,color:#fff
    style E2 fill:#10b981,color:#fff
    style E4 fill:#10b981,color:#fff
    style E6 fill:#10b981,color:#fff
    style E7 fill:#10b981,color:#fff
            </pre>
            <div class="diagram-scroll-hint">‚Üê Scroll horizontally if needed ‚Üí</div>
          </div>

          <div class="code-box">
            <h4>üìã Diagnostic Commands for No Data</h4>
            <pre><code># Check if ANY data is arriving
index=your_index earliest=-24h | stats count

# Check HEC token status
| rest /services/data/inputs/http | table name disabled index sourcetype

# Test HEC endpoint (replace with your values)
curl -k "https://http-inputs-STACK.splunkcloud.com:443/services/collector/event" \
  -H "Authorization: Splunk YOUR_TOKEN" \
  -d '{"event": "test", "sourcetype": "test"}'

# Check forwarder connections (run on indexer)
index=_internal sourcetype=splunkd group=tcpin_connections 
| stats latest(version) by hostname, sourceIp

# Check for HEC ingestion errors
index=_internal sourcetype=splunkd log_level=ERROR component=HttpInputDataHandler

# Check forwarder internal logs
index=_internal host=YOUR_FORWARDER sourcetype=splunkd log_level=ERROR</code></pre>
          </div>
        </div>

        <!-- ============================================ -->
        <!-- TIMESTAMP ISSUES -->
        <!-- ============================================ -->
        <div class="section">
          <h2 class="subsection-title">üü† Timestamp Issues</h2>
          <p>Complete troubleshooting flow for timestamp parsing problems.</p>
          
          <div class="diagram-container">
            <div class="diagram-label">Complete Timestamp Troubleshooting Flow</div>
            <pre class="mermaid">
%%{init: {'theme': 'base', 'themeVariables': {'fontSize': '14px', 'fontFamily': 'Inter, sans-serif'}}}%%
flowchart TB
    A["üü† Timestamp Problem"]
    A --> B{"What's the symptom?"}
    
    subgraph CURRENT["‚è∞ SHOWS CURRENT TIME"]
        B -->|"Shows current time<br/>instead of event time"| C["Timestamp not<br/>being extracted"]
        C --> C1{"Is TIME_FORMAT<br/>set in props.conf?"}
        C1 -->|"No"| C2["‚úÖ Add TIME_FORMAT<br/>to props.conf for<br/>this sourcetype"]
        C1 -->|"Yes"| C3{"Is TIME_PREFIX<br/>set?"}
        C3 -->|"No"| C4["‚úÖ Add TIME_PREFIX<br/>regex pattern that<br/>appears before timestamp"]
        C3 -->|"Yes"| C5{"Does TIME_PREFIX<br/>regex match?"}
        C5 -->|"No"| C6["‚úÖ Fix TIME_PREFIX<br/>regex to match<br/>your log format"]
        C5 -->|"Yes"| C7["‚úÖ Increase<br/>MAX_TIMESTAMP_LOOKAHEAD<br/>default is 128 bytes"]
    end
    
    subgraph WRONG["‚ùå WRONG TIME"]
        B -->|"Time is parsed<br/>but wrong"| D["Timestamp parsed<br/>incorrectly"]
        D --> D1{"Check TIME_FORMAT<br/>strptime codes"}
        D1 --> D2{"Does format match<br/>actual timestamp?"}
        D2 -->|"No"| D3["‚úÖ Fix strptime<br/>format codes to<br/>match timestamp"]
        D2 -->|"Yes"| D4{"Microseconds<br/>issue?"}
        D4 -->|"Yes"| D5["‚úÖ Use %6N for<br/>microseconds or<br/>%3N for milliseconds"]
        D4 -->|"No"| D6["‚úÖ Check for<br/>locale issues<br/>(month names, etc)"]
    end
    
    subgraph TZ["üåç TIMEZONE ISSUES"]
        B -->|"Events off by<br/>hours"| E["Timezone issue"]
        E --> E1{"Is TZ in the<br/>timestamp itself?"}
        E1 -->|"No"| E2["‚úÖ Add TZ = UTC<br/>or correct zone<br/>to props.conf"]
        E1 -->|"Yes"| E3{"Is TZ being<br/>parsed correctly?"}
        E3 -->|"No"| E4["‚úÖ Add %Z or %z<br/>to TIME_FORMAT"]
        E3 -->|"Yes"| E5["‚úÖ Check if source<br/>system TZ config<br/>is correct"]
        
        B -->|"Events appear<br/>in future"| F["Clock sync issue"]
        F --> F1["‚úÖ Check source<br/>system clock and<br/>NTP configuration"]
    end

    style A fill:#f59e0b,color:#fff,stroke:#d97706,stroke-width:3px
    style C2 fill:#10b981,color:#fff
    style C4 fill:#10b981,color:#fff
    style C6 fill:#10b981,color:#fff
    style C7 fill:#10b981,color:#fff
    style D3 fill:#10b981,color:#fff
    style D5 fill:#10b981,color:#fff
    style D6 fill:#10b981,color:#fff
    style E2 fill:#10b981,color:#fff
    style E4 fill:#10b981,color:#fff
    style E5 fill:#10b981,color:#fff
    style F1 fill:#10b981,color:#fff
            </pre>
            <div class="diagram-scroll-hint">‚Üê Scroll horizontally if needed ‚Üí</div>
          </div>

          <div class="card" style="padding:20px;margin-top:20px;background:#fffbeb;border-left:4px solid #f59e0b;">
            <h4 style="color:#92400e;margin-top:0;">Common TIME_FORMAT Examples</h4>
            <table style="width:100%;font-size:0.8125rem;border-collapse:collapse;">
              <thead>
                <tr style="border-bottom:2px solid #fcd34d;">
                  <th style="text-align:left;padding:8px;">Timestamp Example</th>
                  <th style="text-align:left;padding:8px;">TIME_FORMAT Value</th>
                </tr>
              </thead>
              <tbody>
                <tr><td style="padding:8px;"><code>2024-01-15T14:30:00Z</code></td><td style="padding:8px;"><code>TIME_FORMAT = %Y-%m-%dT%H:%M:%S%Z</code></td></tr>
                <tr><td style="padding:8px;"><code>2024-01-15T14:30:00.123456Z</code></td><td style="padding:8px;"><code>TIME_FORMAT = %Y-%m-%dT%H:%M:%S.%6N%Z</code></td></tr>
                <tr><td style="padding:8px;"><code>Jan 15 14:30:00</code></td><td style="padding:8px;"><code>TIME_FORMAT = %b %d %H:%M:%S</code></td></tr>
                <tr><td style="padding:8px;"><code>1705329000</code> (epoch)</td><td style="padding:8px;"><code>TIME_FORMAT = %s</code></td></tr>
                <tr><td style="padding:8px;"><code>1705329000.123</code> (epoch.ms)</td><td style="padding:8px;"><code>TIME_FORMAT = %s.%3N</code></td></tr>
                <tr><td style="padding:8px;"><code>15/01/2024 14:30:00</code></td><td style="padding:8px;"><code>TIME_FORMAT = %d/%m/%Y %H:%M:%S</code></td></tr>
                <tr><td style="padding:8px;"><code>01-15-2024 02:30:00 PM</code></td><td style="padding:8px;"><code>TIME_FORMAT = %m-%d-%Y %I:%M:%S %p</code></td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- ============================================ -->
        <!-- FIELD EXTRACTION ISSUES -->
        <!-- ============================================ -->
        <div class="section">
          <h2 class="subsection-title">üü° Field Extraction Issues</h2>
          <p>Complete troubleshooting flow for field extraction problems.</p>
          
          <div class="diagram-container">
            <div class="diagram-label">Complete Field Extraction Troubleshooting Flow</div>
            <pre class="mermaid">
%%{init: {'theme': 'base', 'themeVariables': {'fontSize': '14px', 'fontFamily': 'Inter, sans-serif'}}}%%
flowchart TB
    A["üü° Fields Not Extracting"]
    A --> B{"What is your<br/>data format?"}
    
    subgraph JSON["üìã JSON FORMAT"]
        B -->|"JSON"| C["JSON Data"]
        C --> C1{"Is KV_MODE = json<br/>set in props.conf?"}
        C1 -->|"No"| C2["‚úÖ Add to props.conf:<br/>[your_sourcetype]<br/>KV_MODE = json"]
        C1 -->|"Yes"| C3{"Are fields nested<br/>in JSON structure?"}
        C3 -->|"Yes"| C4["‚úÖ Use spath command<br/>in search:<br/>| spath path=parent.child"]
        C3 -->|"No"| C5{"Field names have<br/>special characters?"}
        C5 -->|"Yes"| C6["‚úÖ Use spath to<br/>rename fields or<br/>add SEDCMD"]
        C5 -->|"No"| C7["‚úÖ Check JSON<br/>validity - malformed<br/>JSON won't parse"]
    end
    
    subgraph KV["üîë KEY=VALUE FORMAT"]
        B -->|"Key=Value pairs"| D["Key=Value Data"]
        D --> D1{"Is KV_MODE = auto<br/>set in props.conf?"}
        D1 -->|"No"| D2["‚úÖ Add to props.conf:<br/>[your_sourcetype]<br/>KV_MODE = auto"]
        D1 -->|"Yes"| D3{"Non-standard<br/>delimiters?"}
        D3 -->|"Yes"| D4["‚úÖ Set custom:<br/>KV_MODE = auto<br/>FIELD_DELIMITER = ,<br/>VALUE_DELIMITER = :"]
        D3 -->|"No"| D5{"Values have<br/>spaces/quotes?"}
        D5 -->|"Yes"| D6["‚úÖ May need<br/>custom EXTRACT<br/>with regex"]
        D5 -->|"No"| D7["‚úÖ Check for<br/>field name conflicts<br/>with reserved names"]
    end
    
    subgraph CUSTOM["‚öôÔ∏è CUSTOM FORMAT"]
        B -->|"Custom/Other"| E["Custom Format"]
        E --> E1["Need regex<br/>extraction"]
        E1 --> E2["‚úÖ Create EXTRACT<br/>in props.conf:<br/>EXTRACT-myfield = regex"]
        E2 --> E3{"Single field or<br/>multiple fields?"}
        E3 -->|"Single"| E4["‚úÖ Use named group:<br/>EXTRACT-user = user=(?<user>\w+)"]
        E3 -->|"Multiple"| E5["‚úÖ Multiple groups:<br/>EXTRACT-fields = <br/>user=(?<user>\w+).*ip=(?<ip>\S+)"]
    end

    style A fill:#eab308,color:#fff,stroke:#ca8a04,stroke-width:3px
    style C2 fill:#10b981,color:#fff
    style C4 fill:#10b981,color:#fff
    style C6 fill:#10b981,color:#fff
    style C7 fill:#10b981,color:#fff
    style D2 fill:#10b981,color:#fff
    style D4 fill:#10b981,color:#fff
    style D6 fill:#10b981,color:#fff
    style D7 fill:#10b981,color:#fff
    style E4 fill:#10b981,color:#fff
    style E5 fill:#10b981,color:#fff
            </pre>
            <div class="diagram-scroll-hint">‚Üê Scroll horizontally if needed ‚Üí</div>
          </div>
        </div>

        <!-- ============================================ -->
        <!-- DETECTION NOT FIRING -->
        <!-- ============================================ -->
        <div class="section">
          <h2 class="subsection-title">üü¢ Detection Not Firing</h2>
          <p>Complete troubleshooting flow when alerts aren't being generated.</p>
          
          <div class="diagram-container">
            <div class="diagram-label">Complete Detection Troubleshooting Flow</div>
            <pre class="mermaid">
%%{init: {'theme': 'base', 'themeVariables': {'fontSize': '14px', 'fontFamily': 'Inter, sans-serif'}}}%%
flowchart TB
    A["üü¢ Detection Not Firing"]
    A --> B{"Is the alert<br/>enabled?"}
    
    subgraph ENABLED["‚öôÔ∏è ALERT CONFIGURATION"]
        B -->|"No"| B1["‚úÖ Enable alert in<br/>Settings ‚Üí Searches<br/>‚Üí Your Alert ‚Üí Enable"]
        B -->|"Yes"| C{"Is data arriving<br/>for the search?"}
        C -->|"No"| C1["‚úÖ Fix data issue<br/>first - see No Data<br/>Arriving section"]
        C -->|"Yes"| D{"Does SPL return<br/>results manually?"}
    end
    
    subgraph SPL["üîé SPL VALIDATION"]
        D -->|"No"| E{"What's wrong<br/>with SPL?"}
        E -->|"Syntax error"| E1["‚úÖ Fix SPL syntax<br/>Run in search bar<br/>to see error"]
        E -->|"No matching data"| E2{"Time range<br/>correct?"}
        E2 -->|"No"| E3["‚úÖ Adjust time range<br/>to when data exists"]
        E2 -->|"Yes"| E4{"Threshold too<br/>high?"}
        E4 -->|"Yes"| E5["‚úÖ Lower threshold<br/>or remove for testing"]
        E4 -->|"No"| E6["‚úÖ Check field names<br/>and filter conditions"]
        D -->|"Yes"| F{"Alert action<br/>configured?"}
    end
    
    subgraph ACTION["üìß ALERT ACTIONS"]
        F -->|"No"| F1["‚úÖ Add alert action:<br/>Email, webhook,<br/>or Notable Event"]
        F -->|"Yes"| G{"Throttle/Suppression<br/>blocking?"}
        G -->|"Yes"| G1["‚úÖ Check suppression<br/>settings - may be<br/>throttled by field"]
        G -->|"No"| H{"Schedule running<br/>correctly?"}
        H -->|"No"| H1["‚úÖ Check scheduler<br/>logs in _internal<br/>for errors"]
        H -->|"Yes"| I["‚úÖ Check trigger<br/>conditions - may need<br/>'Number of results > 0'"]
    end

    style A fill:#10b981,color:#fff,stroke:#059669,stroke-width:3px
    style B1 fill:#10b981,color:#fff
    style C1 fill:#f59e0b,color:#fff
    style E1 fill:#10b981,color:#fff
    style E3 fill:#10b981,color:#fff
    style E5 fill:#10b981,color:#fff
    style E6 fill:#10b981,color:#fff
    style F1 fill:#10b981,color:#fff
    style G1 fill:#10b981,color:#fff
    style H1 fill:#10b981,color:#fff
    style I fill:#10b981,color:#fff
            </pre>
            <div class="diagram-scroll-hint">‚Üê Scroll horizontally if needed ‚Üí</div>
          </div>

          <div class="code-box">
            <h4>üìã Detection Diagnostic Commands</h4>
            <pre><code># Check if alert is enabled and scheduled
| rest /services/saved/searches 
| search title="Your Alert Name" 
| table title is_scheduled disabled cron_schedule

# Check scheduler status for your alert
index=_internal sourcetype=scheduler savedsearch_name="Your Alert Name"
| stats count by status, run_time
| sort -run_time

# Check for scheduler errors
index=_internal sourcetype=scheduler status=error
| table _time, savedsearch_name, status, message

# Test SPL manually (copy search, run with explicit time)
YOUR_SEARCH_HERE earliest=-24h latest=now | stats count

# Check alert action logs
index=_internal sourcetype=splunkd component=AlertNotifier
| table _time, action, status, message</code></pre>
          </div>
        </div>

        <!-- ============================================ -->
        <!-- FALSE POSITIVES -->
        <!-- ============================================ -->
        <div class="section">
          <h2 class="subsection-title">üîµ Too Many False Positives</h2>
          <p>Complete workflow for reducing false positive alerts.</p>
          
          <div class="diagram-container">
            <div class="diagram-label">False Positive Reduction Flow</div>
            <pre class="mermaid">
%%{init: {'theme': 'base', 'themeVariables': {'fontSize': '14px', 'fontFamily': 'Inter, sans-serif'}}}%%
flowchart TB
    A["üîµ Too Many FPs"]
    A --> B{"What's causing<br/>the false positives?"}
    
    subgraph KNOWN["‚úÖ KNOWN GOOD SOURCES"]
        B -->|"Known good<br/>IPs/Users"| C["Add allowlist<br/>filtering"]
        C --> C1["Create lookup CSV<br/>with known good<br/>sources"]
        C1 --> C2["Add to SPL:<br/>| lookup allowlist.csv<br/>ip AS src OUTPUT allowed<br/>| where isnull(allowed)"]
        C2 --> C3["‚úÖ Schedule lookup<br/>refresh if dynamic"]
    end
    
    subgraph TIME["‚è∞ TIME-BASED PATTERNS"]
        B -->|"Time-based<br/>pattern"| D["Add time filtering"]
        D --> D1{"Business hours<br/>only?"}
        D1 -->|"Yes"| D2["‚úÖ Add filter:<br/>| eval hour=strftime(_time,'%H')<br/>| where hour>=8 AND hour<=18"]
        D1 -->|"No"| D3{"Exclude maintenance<br/>windows?"}
        D3 -->|"Yes"| D4["‚úÖ Add filter:<br/>| search NOT<br/>(date_hour>=2 AND date_hour<=4)"]
        D3 -->|"No"| D5["‚úÖ Consider different<br/>thresholds for<br/>different time periods"]
    end
    
    subgraph THRESHOLD["üìä THRESHOLD TUNING"]
        B -->|"Threshold<br/>too low"| E["Tune thresholds<br/>using baseline"]
        E --> E1["Run baseline query<br/>to understand normal"]
        E1 --> E2["Calculate statistics:<br/>| eventstats avg(count) as avg<br/>stdev(count) as stdev"]
        E2 --> E3["‚úÖ Set threshold at<br/>avg + 3*stdev for<br/>statistical anomaly"]
        
        B -->|"Noisy field<br/>values"| F["Add value-based<br/>exclusions"]
        F --> F1["Identify noisy<br/>field values"]
        F1 --> F2["‚úÖ Add NOT filter:<br/>| search NOT<br/>(user=service_* OR<br/>src=10.0.0.*)"]
    end

    style A fill:#3b82f6,color:#fff,stroke:#2563eb,stroke-width:3px
    style C3 fill:#10b981,color:#fff
    style D2 fill:#10b981,color:#fff
    style D4 fill:#10b981,color:#fff
    style D5 fill:#10b981,color:#fff
    style E3 fill:#10b981,color:#fff
    style F2 fill:#10b981,color:#fff
            </pre>
            <div class="diagram-scroll-hint">‚Üê Scroll horizontally if needed ‚Üí</div>
          </div>

          <div class="code-box">
            <h4>üìã FP Reduction SPL Patterns</h4>
            <pre><code># 1. Allowlist lookup filter
| lookup ip_allowlist.csv ip AS src OUTPUT is_allowed
| where isnull(is_allowed) OR is_allowed!="true"

# 2. Exclude service accounts
| search NOT [| inputlookup service_accounts.csv | fields user]

# 3. Business hours filter
| eval hour = strftime(_time, "%H")
| eval day = strftime(_time, "%w")
| where hour >= 8 AND hour <= 18 AND day >= 1 AND day <= 5

# 4. Statistical baseline (alert on anomalies only)
| eventstats avg(count) as avg_count, stdev(count) as stdev_count by user
| where count > (avg_count + 3*stdev_count)

# 5. Exclude known noisy sources
| search NOT (
    src_ip IN ("10.0.0.1", "10.0.0.2") OR
    user IN ("svc_*", "admin_scanner") OR
    app="health_check"
)

# 6. Require multiple conditions (reduce single-factor alerts)
| where failed_count > 5 AND unique_sources > 3</code></pre>
          </div>
        </div>

        <!-- ============================================ -->
        <!-- QUICK REFERENCE -->
        <!-- ============================================ -->
        <div class="section">
          <h2 class="subsection-title">üìã Quick Diagnostic Commands</h2>
          
          <div class="table-container">
            <table style="width:100%;">
              <thead>
                <tr>
                  <th>Issue</th>
                  <th>Diagnostic Command</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Check data arrival</td>
                  <td><code>index=X earliest=-1h | stats count by sourcetype</code></td>
                </tr>
                <tr>
                  <td>Check HEC tokens</td>
                  <td><code>| rest /services/data/inputs/http | table name disabled index</code></td>
                </tr>
                <tr>
                  <td>Check forwarder connections</td>
                  <td><code>index=_internal group=tcpin_connections | stats count by hostname</code></td>
                </tr>
                <tr>
                  <td>Check field extraction</td>
                  <td><code>index=X | fieldsummary | where count > 0 | table field count</code></td>
                </tr>
                <tr>
                  <td>Check timestamp parsing</td>
                  <td><code>index=X | eval lag=_indextime-_time | stats avg(lag) min(lag) max(lag)</code></td>
                </tr>
                <tr>
                  <td>Check alert schedule</td>
                  <td><code>index=_internal sourcetype=scheduler | stats count by savedsearch_name status</code></td>
                </tr>
                <tr>
                  <td>Check correlation searches</td>
                  <td><code>| rest /services/saved/searches | search action.correlationsearch.enabled=1 | table title</code></td>
                </tr>
                <tr>
                  <td>Check data model acceleration</td>
                  <td><code>| rest /services/datamodel/acceleration | table title acceleration.enabled</code></td>
                </tr>
                <tr>
                  <td>Check license usage</td>
                  <td><code>index=_internal source=*license_usage* type=Usage | stats sum(b) as bytes by idx</code></td>
                </tr>
                <tr>
                  <td>Check Splunk errors</td>
                  <td><code>index=_internal log_level=ERROR earliest=-1h | stats count by component message</code></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Navigation -->
        <div class="section" style="margin-top:48px;">
          <div class="grid grid-2">
            <a href="splunk-ops.html" class="card" style="padding:20px;text-decoration:none;">
              <div style="color:var(--gray-500);font-size:14px;">‚Üê Previous</div>
              <div style="color:var(--primary-700);font-weight:600;">Splunk Cloud Admin</div>
            </a>
            <a href="decision-trees.html" class="card" style="padding:20px;text-decoration:none;text-align:right;">
              <div style="color:var(--gray-500);font-size:14px;">Next ‚Üí</div>
              <div style="color:var(--primary-700);font-weight:600;">Decision Trees</div>
            </a>
          </div>
        </div>

      </div>
    </main>
  </div>
  <script src="../js/app.js"></script>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: 'base',
      themeVariables: {
        fontSize: '14px',
        fontFamily: 'Inter, sans-serif',
        primaryColor: '#3b82f6',
        primaryTextColor: '#ffffff',
        primaryBorderColor: '#1d4ed8',
        lineColor: '#475569',
        secondaryColor: '#f1f5f9',
        tertiaryColor: '#e2e8f0'
      },
      flowchart: {
        htmlLabels: true,
        curve: 'basis',
        nodeSpacing: 30,
        rankSpacing: 40,
        padding: 12,
        useMaxWidth: false
      }
    });
  </script>
</body>
</html>
