<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WAF-UC1: Block Volume Anomaly | Sobeys Detection Engineering</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script>mermaid.initialize({startOnLoad:true, theme:'neutral'});</script>
</head>
<body>
  <div class="app-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <div class="sidebar-logo-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          </div>
          <div class="sidebar-logo-text">
            <h1>Sobeys Detection</h1>
            <span>Engineering Command Center</span>
          </div>
        </div>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Overview</div>
          <a href="../index.html" class="nav-item">Command Center</a>
          <a href="day1.html" class="nav-item">Day 1</a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">WAF/DDoS Project</div>
          <a href="waf-overview.html" class="nav-item">Overview</a>
          <a href="waf-uc1.html" class="nav-item active">UC1: Block Volume</a>
          <a href="waf-uc2-4.html" class="nav-item">UC2-4: Tier 1</a>
          <a href="waf-uc5-8.html" class="nav-item">UC5-8: Tier 2</a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">MFA Project</div>
          <a href="mfa-overview.html" class="nav-item">Overview</a>
          <a href="mfa-uc1.html" class="nav-item">UC1: MFA Fatigue</a>
          <a href="mfa-uc2-5.html" class="nav-item">UC2-5</a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Operations</div>
          <a href="splunk-operations.html" class="nav-item">Splunk Ops</a>
          <a href="notable-events.html" class="nav-item">Notable Events</a>
          <a href="runbooks.html" class="nav-item">Runbooks</a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Reference</div>
          <a href="vendor-akamai.html" class="nav-item">Akamai Reference</a>
          <a href="spl-reference.html" class="nav-item">SPL Library</a>
        </div>
      </nav>
    </aside>

    <main class="main-content">
      <header class="header">
        <div class="header-left">
          <div class="breadcrumb">
            <a href="../index.html" class="breadcrumb-item">Home</a>
            <span class="breadcrumb-separator">/</span>
            <a href="waf-overview.html" class="breadcrumb-item">WAF Project</a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-item current">UC1</span>
          </div>
        </div>
        <span class="badge warning">Tier 1</span>
      </header>

      <div class="page-content">
        <div class="section">
          <h1 class="section-title">WAF-UC1: Block Volume Anomaly</h1>
          <p class="section-subtitle">Detect sudden spikes in WAF blocks indicating active attack campaigns</p>
        </div>

        <!-- Metadata -->
        <div class="grid grid-4" style="margin-bottom:20px">
          <div class="card bordered-left warning"><div style="font-size:0.7rem;color:var(--gray-500)">Severity</div><strong>MEDIUM</strong></div>
          <div class="card bordered-left primary"><div style="font-size:0.7rem;color:var(--gray-500)">MITRE ATT&CK</div><strong>T1190</strong></div>
          <div class="card bordered-left akamai"><div style="font-size:0.7rem;color:var(--gray-500)">Data Source</div><strong>Akamai SIEM</strong></div>
          <div class="card bordered-left info"><div style="font-size:0.7rem;color:var(--gray-500)">Index</div><strong>akamai</strong></div>
        </div>

        <!-- WHAT -->
        <div class="section">
          <h2 class="subsection-title">‚ùì WHAT ‚Äî Detection Description</h2>
          <p>This detection identifies statistical anomalies in WAF block volume that exceed the normal baseline by more than 2 standard deviations, indicating potential attack activity.</p>
          <div class="card" style="margin-top:16px">
            <div class="mermaid">
flowchart LR
    A[Normal Traffic<br/>Baseline] --> B{Current Volume}
    B -->|Within 2œÉ| C[Normal - No Alert]
    B -->|Above 2œÉ| D[üü° Anomaly Detected]
    B -->|Above 3œÉ| E[üî¥ HIGH Anomaly]
    D --> F[Generate Alert]
    E --> F
    style E fill:#dc2626,color:#fff
            </div>
          </div>
        </div>

        <!-- WHY -->
        <div class="section">
          <h2 class="subsection-title">üéØ WHY ‚Äî Threat Intent</h2>
          <div class="grid grid-2">
            <div class="card">
              <h4 style="color:var(--error-600)">Attack Indicators</h4>
              <ul style="font-size:0.875rem;margin-left:16px">
                <li>Scanning/reconnaissance activity</li>
                <li>Exploitation attempts (SQLi, XSS)</li>
                <li>Credential stuffing campaigns</li>
                <li>DDoS application layer attacks</li>
              </ul>
            </div>
            <div class="card">
              <h4 style="color:var(--primary-700)">Sobeys Business Impact</h4>
              <ul style="font-size:0.875rem;margin-left:16px">
                <li>Voil√† e-commerce degradation</li>
                <li>Customer data exposure risk</li>
                <li>Brand reputation damage</li>
                <li>PCI compliance concerns</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- WHEN -->
        <div class="section">
          <h2 class="subsection-title">‚è∞ WHEN ‚Äî Thresholds & Timing</h2>
          <div class="table-container">
            <table>
              <thead><tr><th>Condition</th><th>Threshold</th><th>Rationale</th></tr></thead>
              <tbody>
                <tr><td>Time Window</td><td>5 minutes</td><td>Balance speed vs noise</td></tr>
                <tr><td>Statistical Method</td><td>mean + 2œÉ</td><td>95th percentile anomaly</td></tr>
                <tr><td>Minimum Floor</td><td>10 events</td><td>Avoid low-volume false positives</td></tr>
                <tr><td>Baseline Period</td><td>14+ days</td><td>Capture weekly patterns</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- WHERE -->
        <div class="section">
          <h2 class="subsection-title">üìç WHERE ‚Äî Data Sources</h2>
          <div class="table-container">
            <table>
              <thead><tr><th>Component</th><th>Value</th></tr></thead>
              <tbody>
                <tr><td>Index</td><td><code>akamai</code></td></tr>
                <tr><td>Sourcetype</td><td><code>akamai:siem</code></td></tr>
                <tr><td>Key Field (Action)</td><td><code>attackData.rules{}.ruleAction</code></td></tr>
                <tr><td>Key Field (Source)</td><td><code>attackData.clientIP</code></td></tr>
                <tr><td>CIM Model</td><td>Web (src, action, status)</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- HOW -->
        <div class="section">
          <h2 class="subsection-title">üîß HOW ‚Äî Detection SPL</h2>
          <div class="code-block">
            <div class="code-header"><span class="code-title">WAF-UC1: Block Volume Anomaly (Akamai)</span></div>
            <div class="code-body"><pre><code>index=akamai sourcetype=akamai:siem earliest=-1h
| spath path=attackData.rules{}.ruleAction output=action
| where action="deny"
| bin _time span=5m
| stats count as block_count 
    dc(attackData.clientIP) as unique_ips 
    values(httpMessage.host) as hosts
    BY _time
| eventstats avg(block_count) as baseline stdev(block_count) as stdev
| eval threshold = baseline + (2 * stdev)
| eval min_floor = 10
| where block_count > threshold AND block_count > min_floor
| eval deviation = round((block_count - baseline) / stdev, 2)
| eval severity = case(
    deviation > 5, "CRITICAL",
    deviation > 3, "HIGH",
    1=1, "MEDIUM"
)
| table _time block_count baseline threshold deviation unique_ips severity hosts</code></pre></div>
          </div>
        </div>

        <!-- False Positives -->
        <div class="section">
          <h2 class="subsection-title">‚ö†Ô∏è Known False Positives</h2>
          <div class="table-container">
            <table>
              <thead><tr><th>FP Source</th><th>Mitigation</th></tr></thead>
              <tbody>
                <tr><td>Vulnerability Scanners (Qualys, Tenable)</td><td>Allowlist scanner IPs in lookup</td></tr>
                <tr><td>Marketing Campaign Traffic Spikes</td><td>Coordinate with marketing, adjust during events</td></tr>
                <tr><td>WAF Rule Updates</td><td>Monitor after rule changes, tune if needed</td></tr>
                <tr><td>Partner API Integrations</td><td>Allowlist partner IP ranges</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Notable Event Config -->
        <div class="section">
          <h2 class="subsection-title">üìã Notable Event Configuration (Splunk ES)</h2>
          <div class="code-block">
            <div class="code-header"><span class="code-title">savedsearches.conf</span></div>
            <div class="code-body"><pre><code>[WAF-UC1 Block Volume Anomaly]
search = index=akamai sourcetype=akamai:siem ... (SPL above)
cron_schedule = */5 * * * *
dispatch.earliest_time = -10m
dispatch.latest_time = now
alert.severity = 3
alert.suppress = 1
alert.suppress.period = 15m
alert.suppress.fields = hosts
action.notable = 1
action.notable.param.rule_title = WAF Block Volume Anomaly
action.notable.param.rule_description = Detected statistical anomaly in WAF block volume
action.notable.param.security_domain = network
action.notable.param.severity = medium
action.notable.param.drilldown_search = index=akamai sourcetype=akamai:siem earliest=-1h | stats count by attackData.clientIP</code></pre></div>
          </div>
        </div>

        <!-- Response Actions -->
        <div class="section">
          <h2 class="subsection-title">üö® Response Actions</h2>
          <div class="grid grid-2">
            <div class="card bordered-left warning">
              <h4>Immediate (SOC Tier 1)</h4>
              <ol style="font-size:0.875rem;margin-left:16px">
                <li>Validate alert is not scanner/FP</li>
                <li>Identify top source IPs</li>
                <li>Check attack categories in logs</li>
                <li>Escalate if coordinated attack</li>
              </ol>
            </div>
            <div class="card bordered-left error">
              <h4>Escalation (Tier 2/IR)</h4>
              <ol style="font-size:0.875rem;margin-left:16px">
                <li>Block malicious IPs at edge</li>
                <li>Enable stricter rate limiting</li>
                <li>Notify application owners</li>
                <li>Document for threat intel</li>
              </ol>
            </div>
          </div>
        </div>

      </div>
    </main>
  </div>
  <script src="../js/app.js"></script>
</body>
</html>
